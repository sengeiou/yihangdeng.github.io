<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="yhd">
    
    <title>
        
            Mybatis3 |
        
        DyhBlog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/MyLogo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"yoursite.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/MyLogo.svg","article_img_align":"left","left_side_width":"230px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.jpeg"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.1"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.1.1"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                DyhBlog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Mybatis3</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">yhd</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-08-24 18:28:47
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6/">应用框架</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/ORM%E6%A1%86%E6%9E%B6/">ORM框架</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>26.7k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>117 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p><strong>引言</strong>：本文主要介绍了Mybatis基础背景，基于Mybais3的官方文档说明了Mybatis的配置文件标签、SQL映射文件标签、动态SQL语句的编写，以及Mybatis的缓存机制，含一级二级缓存说明。其中补充了SSM的整合基础示例，Mybatis的逆向工程、以及Mybatis使用批量操作、调用存储过程、以及自定义类型处理器内容。</p>
<h1 id="Mybatis概述">Mybatis概述</h1>
<h2 id="背景历史">背景历史</h2>
<p>原是Apache的一个开源项目<strong>iBatis</strong>, 2010年6月这 个项目由Apache Software Foundation <strong>迁移到了 Google Code</strong>，随着开发团队转投Google Code 旗下， iBatis3.x正式更名为MyBatis ，代码于 2013年11月迁移到<a class="link"   target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3" >Github<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="Mybatis的优势">Mybatis的优势</h2>
<p>java领域中，对比最常见的三种数据库编程。</p>
<h3 id="相关工具对比">相关工具对比</h3>
<ul>
<li>
<p>相关工具：JDBC—&gt;Dbutils(QueryRunner)—&gt;JdbcTemplate(Spring)</p>
</li>
<li>
<p>SQL夹在Java代码块里，<strong>耦合度高导致硬编码</strong>，维护不易且实际开发需求中sql是有变化，频繁修改的情况多见。</p>
<blockquote>
<p>若改动一下数据库或改变一下sql语句，则整个项目需要重新打包构建部署</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322161214.png"
                      alt=""
                ></p>
</li>
</ul>
<h3 id="Hibernate">Hibernate</h3>
<p>Hibernate：<strong>全自动</strong>ORM（Object Relation Mapping）框架</p>
<ul>
<li><strong>全黑箱操作</strong>，想优化sql，必须再学习Hibernate的HQL定制sql语句，开发者希望sql语句交给开发人员编写，不失去其灵活性。</li>
<li><strong>只能全自动全映射</strong>，数据表有100个列，则即使只查询某一个字段都需要把全部列映射过来。导致数据库性能下降</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322161239.png"
                      alt=""
                ></p>
<h2 id="Mybatis">Mybatis</h2>
<ul>
<li>MyBatis将<strong>需定制化 SQL</strong>部分抽取出来，以XML方式配置，实现<strong>可定制化SQL</strong>。</li>
<li>因此Mybatis是<strong>半自动</strong>，<strong>轻量级</strong>的持久层框架。</li>
<li>MyBatis 避免了几乎所有的JDBC代码和手动设置参数以及获取结果集。</li>
<li>MyBatis可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO(Plain Old Java  Objects，普通的Java对象)映射成数据库中的记录</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322161329.png"
                      alt=""
                ></p>
<h1 id="Mybatis下载">Mybatis下载</h1>
<h2 id="下载步骤">下载步骤</h2>
<ol>
<li><strong>进入GitHub页面</strong>，<a class="link"   target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3" >Mybatis-Github<i class="fas fa-external-link-alt"></i></a></li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210321111234.png"
                      alt=""
                ></p>
<ol start="2">
<li><strong>选的特定版本下载</strong></li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210321111420.png"
                      alt=""
                ></p>
<h2 id="基本资料介绍">基本资料介绍</h2>
<ul>
<li>解压mybatis-3.4.1，<u>使用mybatis</u><strong>只需要导入mybatis-3.4.1.jar</strong>即可</li>
<li>lib目录下的jar包是mybatis需要<strong>添加其他功能</strong>才需要选择性导入的包</li>
</ul>
<h1 id="HelloWorld">HelloWorld</h1>
<h2 id="快速开始">快速开始</h2>
<ol>
<li>
<p><a class="link"   target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/getting-started.html" >打开<i class="fas fa-external-link-alt"></i></a>，mybatis在线官方文档。操作基本按照官方文档进行</p>
</li>
<li>
<p><strong>准备jar包</strong></p>
<ul>
<li><strong>mybatis-3.4.1.jar</strong>：mybatis核心jar包</li>
<li>mysql-connector-java-5.1.37-bin.jar：数据库连接jar包</li>
</ul>
</li>
<li>
<p><strong>创建测试数据库</strong>：本例数据库名为 mybatis，创建测试数据表tbl_employee</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210321163228.png"
                      alt=""
                ></p>
</li>
<li>
<p>新建一个基于maven的java项目，并<strong>建立对应的JavaBean</strong></p>
</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210813153712.png"
                      alt=""
                ></p>
<ol>
<li><strong>依据mybatis官方文档从XML中构建SqlSessionFactory</strong></li>
<li>本例是<strong>直接在类路径下</strong>（maven项目在java或resources目录下）创建名为<strong>mybatis-config.xml</strong> (全局配置)文件，从<u>官方文档中复制</u>如下内容</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- tips：数据源信息(需修改部分) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 将写好的sql映射文件注册到全局配置文件中。文件创建在全类路径下，因此直接写即可 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;EmployeeMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>修改XML中的<strong>数据源信息</strong>：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 驱动 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span><span class="comment">&lt;!-- 数据库地址 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span><span class="comment">&lt;!-- 用户名 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span><span class="comment">&lt;!-- 密码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="8">
<li>同样在<strong>类路径下</strong>（maven项目在java或resources目录下）创建映射的<strong>EmployeeMapper.xml</strong>文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="comment">&lt;!-- sql映射文件 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 名称空间：暂时来说名字可以随便起，一般映射哪个实体对象就起名为 xxxMapper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.bean.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- id：唯一标识，一般起名为[操作类型 + 操作对象]selectXxx --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resultTupe：返回类型，若返回是一个对象，则填入这个类的全类名 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- #&#123;id&#125;：从传递过来的参数中取出id指，类似java占位符&#x27;?&#x27; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmp&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">      	select id,last_Name lastName,gender,email from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="9">
<li><strong>执行查询操作</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.company.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-08-13 14:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1、从mybatis-config.xml 中构建SqlSessionFactory</span></span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        SqlSessionFactory build = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、获取 SqlSession对象</span></span><br><span class="line">        SqlSession sqlSession = build.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、开始执行查询操作，能查询已映射的 SQL语句</span></span><br><span class="line">        <span class="comment">//形参1：sql映射XML文件的唯一标识符，可直接填入XML的id(若存在重名)</span></span><br><span class="line">        <span class="comment">//	但建议使用XML中 namespace.id 的方式唯一标识</span></span><br><span class="line">        <span class="comment">//形参2：执行sql语句的传入参数，如下查询id=1的员工信息</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String id = <span class="string">&quot;com.company.bean.EmployeeMapper.selectEmp&quot;</span>;</span><br><span class="line">            Employee employee = (Employee) sqlSession.selectOne(id, <span class="number">1</span>);</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li><strong>最终效果</strong></li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210813153946.png"
                      alt=""
                ></p>
<ol start="11">
<li>
<p>小结</p>
</li>
<li>
<p>根据xml全局配置文件创建一个SqlSessionFactrory</p>
</li>
<li>
<p>创建sql映射文件，配置了每一个sql，以及sql的 封装规则等</p>
</li>
<li>
<p>将sql映射文件注册在全局配置文件中</p>
</li>
<li>
<p>代码部分</p>
<ol>
<li>
<p>根据全局配置文件得到SqlSessionFactory</p>
</li>
<li>
<p>使用sqlSession工厂，获得sqlSession对象来执行增删改查</p>
<p>一个sqlSession就是代表和数据库的一次会话，用完关闭</p>
</li>
<li>
<p>使用sql的唯一标志来告诉Mybatis执行哪个sql，sqk均保存在sql映射文件中</p>
</li>
</ol>
</li>
</ol>
<h2 id="接口式编程">接口式编程</h2>
<ul>
<li>
<p>对于上述方式执行sql操作，mybatis还提供了一种更为智能，受众面更广的实现方式。</p>
</li>
<li>
<p>即<strong>接口与配置文件</strong>进行动态<strong>绑定</strong>。以后使用mybatis均使用这种方式操作</p>
</li>
</ul>
<h3 id="操作步骤">操作步骤</h3>
<ol>
<li>
<p>如日常开发首先需<strong>创建dao操作对应的接口</strong>，EmployeeMapper.java</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322154338.png"
                      alt=""
                ></p>
</li>
<li>
<p><strong>规范化</strong>sql映射文件中的<strong>namespace</strong>与<strong>id</strong>的值，形成如下<strong>对应关系</strong></p>
<ul>
<li><strong>namespace</strong> ：对应dao操作的<strong>接口的全类名</strong></li>
<li><strong>id 值</strong>：对应接口中的<strong>抽象方法名</strong>（方法返回类型与传入参数也要对应sql语句本身）
<ul>
<li>resultType：对应抽象方法的返回类型的全类名</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322154725.png"
                      alt=""
                ></p>
<ol start="3">
<li>使用自动生成的接口<strong>代理对象替代mybatis的session</strong>对象进行数据库操作
<ul>
<li>通过调用<code>session.getMapper();</code>方法，传入<strong>接口的类型</strong>，使其自动创建一个<strong>代理对象</strong></li>
<li>随后通过这个代理对象<strong>实现类</strong>去执行增删改查（与之前的开发更贴切）</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//旧：不再直接使用session对象进行数据库操作</span></span><br><span class="line">    <span class="comment">//String id = &quot;com.test.mybatis.bean.EmployeeMapper.selectEmp&quot;;</span></span><br><span class="line">    <span class="comment">//Employee employee = (Employee) session.selectOne(id, 1);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//新：获取代理类对象直接进行抽象方法对应的配置文件信息进行调用</span></span><br><span class="line">    EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);</span><br><span class="line">    Employee employee = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(employee);</span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="优势">优势</h3>
<ul>
<li>
<p>代码<strong>更清晰</strong></p>
</li>
<li>
<p>不用担心<strong>传入类型安全</strong>，由接口的抽象方法规范化了（selectOne()方法传入的1是Object类型）</p>
</li>
<li>
<p>减少字符串字面值使用，减低出错率（id的填入）。返回类型不需要考虑类型转换安全</p>
</li>
</ul>
<h2 id="小结">小结</h2>
<h3 id="原生比较">原生比较</h3>
<ul>
<li><strong>原生开发</strong>（不使用Mybatis）： Dao	     ====&gt;   DaoImpl</li>
<li><strong>Mybatis</strong>（接口式编程）：Mapper    ===&gt;    xxMapper.xml</li>
</ul>
<h3 id="SqlSession">SqlSession</h3>
<ul>
<li><strong>SqlSession</strong>代表和数据库的<strong>一次会话，用完必须关闭</strong>（底层就是connection对象）</li>
<li><strong>SqlSession</strong>和connection一样是<strong>非线程安全</strong>。<strong>每次使用</strong>都应该去<strong>获取新的对象</strong></li>
</ul>
<h3 id="代理对象">代理对象</h3>
<ul>
<li>自定义的Dao接口是<strong>没有实现类对象</strong>，是由mybatis为接口生成一个代理对象(将接口和xml进行绑定)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EmployeeMapper empMapper =	sqlSession.getMapper(EmployeeMapper.class);</span><br></pre></td></tr></table></figure>
<h3 id="配置文件">配置文件</h3>
<ul>
<li>
<p><strong>全局配置文件</strong>（非必须）：包含数据库<strong>连接池信息</strong>，事务管理器信息等…<strong>系统运行环境信息</strong></p>
</li>
<li>
<p><strong>sql映射文件</strong>（必须）：保存了<strong>每一个sql语句</strong>的映射信息(将sql抽取出来)</p>
</li>
</ul>
<h1 id="配置文件标签">配置文件标签</h1>
<h2 id="标签书写提示检查">标签书写提示检查</h2>
<p>若配置文件书写中无法弹出mybatis标签的提示，可以进行如下操作，一般IDE都有</p>
<ol>
<li>
<p>准备mybatis-3-config.dtd文件</p>
<ol>
<li>联网状态下可以点击xml文件中链接下载：<a class="link"   target="_blank" rel="noopener" href="http://mybatis.org/dtd/mybatis-3-config.dtd" >http://mybatis.org/dtd/mybatis-3-config.dtd<i class="fas fa-external-link-alt"></i></a></li>
<li>或者在mybatis-3,4,1.jar包中ibatis.builder.xml中解压出来</li>
</ol>
</li>
<li>
<p>进入eclipse 进行如下设置</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322161143.png"
                      alt=""
                ></p>
<ol start="3">
<li>最后在IDE中关闭所有xml文件，再打开测试即可</li>
</ol>
</li>
</ol>
<blockquote>
<p>以下介绍均为最基本，最常用的使用方式。详细使用与功能介绍可参详<a class="link"   target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/getting-started.html" >官方文档<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<h2 id="标签编写顺序">标签编写顺序</h2>
<p>mybatis配置文件的标签编<strong>写顺序有严格要求</strong>，必须按照以下顺序编写，不能打乱</p>
<ul>
<li>properties, <strong>settings</strong>, typeAliases, typeHandlers, objectFactory,</li>
<li>objectWrapperFactory, reflectorFactory, plugins, <strong>environments</strong>,</li>
<li>databaseIdProvider, mappers?</li>
</ul>
<h2 id="properties">properties</h2>
<h3 id="说明">说明</h3>
<p>mybatis可以使用properties标签引入外部 .properties配置文件的内容，主要使用在数据源信息上。</p>
<ul>
<li><strong>resource</strong>（二选一）：引入<strong>类路径</strong>下的资源</li>
<li><strong>url</strong>（二选一）：引入<strong>网络路径</strong>或者<strong>磁盘路径</strong>下的资源</li>
</ul>
<h3 id="示例">示例</h3>
<ol>
<li>如在类路径已经存在一个<strong>dbconfig.properties文件</strong>，用于存放数据源信息，内容如下</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>通过<code>properties</code>标签<strong>引入dbconfig.properties文件</strong></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引入properties文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 若不在类路径下，则按包名斜杠的格式定位到，如com/test/dbconfig.properties --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;dbconfig.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 对引入的properties文件的内容进行引用$&#123;properties键&#125; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;EmployeeMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>最终效果</strong></li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322171530.png"
                      alt=""
                ></p>
<h2 id="settings">settings</h2>
<h3 id="说明-2">说明</h3>
<p><strong>初步认识</strong>：这是 MyBatis中极为重要的调整设置，它们会<strong>改变MyBatis的运行时行为</strong>。一般使用默认即可，不需要配置，需要再<a class="link"   target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/getting-started.html" >查看文档<i class="fas fa-external-link-alt"></i></a>进行相应的配置。</p>
<ul>
<li><strong>name</strong>为要设置对应的<strong>配置信息</strong>，</li>
<li><strong>value</strong>就是配置的<strong>值</strong></li>
</ul>
<h3 id="示例-2">示例</h3>
<p>例如：选取官方文档其中一个设置<strong>mapUnderscoreToCamelCase</strong></p>
<table>
<thead>
<tr>
<th>设置名</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>mapUnderscoreToCamelCase</td>
<td>是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn</td>
<td>true|false</td>
<td>False</td>
</tr>
</tbody>
</table>
<p>默认是false。若开启后，数据库列名为 <strong>last_Name</strong> 可直接映射java属性名<strong>lastName</strong>，而无需使用别名修改为lastName进行映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="typeAliases">typeAliases</h2>
<h3 id="自定义类别名">自定义类别名</h3>
<h4 id="说明-3">说明</h4>
<p>typeAliases<code>[ˈeɪlɪæsɪz]</code>为别名处理器、为某个Java类的全类名起别名。此后在mybatis配置文件中可<strong>用别名替代全类名</strong></p>
<ul>
<li><strong>type</strong>：指定<strong>待取别名的类的全类名</strong>（默认别名为类名小写，不分大小写)</li>
<li><strong>alias</strong>：指定<strong>新的别名</strong></li>
</ul>
<h4 id="示例-3">示例</h4>
<ul>
<li>
<p><strong>方式1.1</strong>：使用默认别名（默认别名为类名小写但不区分大小写，即employee、EmPloyee等）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.test.mybatis.bean.Employee&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>方式1.2</strong>：在方式1的基础上，使用<strong>alias属性自定义别名</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.test.mybatis.bean.Employee&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;emp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>方式2.1</strong>：为指定<strong>包下所有类</strong>起别名，此时只能<strong>使用默认别名</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.test.mybatis.bean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>方式2.2</strong>：若指定某包名或其子包下存在两个同名的类，则使用<code>@Alias(&quot;Name&quot;)</code>注解直接起别名以区分</p>
<ul>
<li>XML文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：需要指明使用别名注解的包是什么，即要保留方式2.1的package标签，否则会报错 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.test.mybatis.bean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Java文件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;ABC&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>示例方式1.2效果如下</strong>，在sql映射文件中的resultType直接使用别名替代全类名</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210322222457.png"
                      alt=""
                ></p>
</li>
</ul>
<h3 id="默认别名">默认别名</h3>
<p><strong>Mybatis官方已默认</strong>为java常用的一些<strong>基本数据类型，包装类型，集合</strong>操作等起了别名。<u>自定义别名时注意不要于其发生冲突</u>。别名的规律大致可分为以下两种</p>
<ul>
<li><strong>基本数据类型</strong>：基本数据类型前加下划线’’_’’</li>
<li>Java类：类名的小写</li>
</ul>
<table>
<thead>
<tr>
<th>别名</th>
<th>原Java类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>_byte</td>
<td>byte</td>
</tr>
<tr>
<td>_long</td>
<td>long</td>
</tr>
<tr>
<td>_short</td>
<td>short</td>
</tr>
<tr>
<td>_int</td>
<td>int</td>
</tr>
<tr>
<td>_integer</td>
<td>int</td>
</tr>
<tr>
<td>_double</td>
<td>double</td>
</tr>
<tr>
<td>_float</td>
<td>float</td>
</tr>
<tr>
<td>_boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>string</td>
<td>String</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
</tr>
<tr>
<td>integer</td>
<td>Integer</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
</tr>
<tr>
<td>boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
</tr>
<tr>
<td>decimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>bigdecimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>object</td>
<td>Object</td>
</tr>
<tr>
<td>map</td>
<td>Map</td>
</tr>
<tr>
<td>hashmap</td>
<td>HashMap</td>
</tr>
<tr>
<td>list</td>
<td>List</td>
</tr>
<tr>
<td>arraylist</td>
<td>ArrayList</td>
</tr>
<tr>
<td>collection</td>
<td>Collection</td>
</tr>
<tr>
<td>iterator</td>
<td>Iterator</td>
</tr>
</tbody>
</table>
<h2 id="typeHandlers">typeHandlers</h2>
<p><strong>初步认识</strong>：类型处理器，主要用于架起<strong>java类型和数据库类型转换的桥梁</strong>。比如，如何将java中String类型变量存储在数据库兼容适配成char，varchar等。反之，从数据库中查出的Integer如何转换成java使用的Integer。</p>
<h2 id="plugins">plugins</h2>
<p><strong>初步认识</strong>：MyBatis 允许在映射语句执行过程中的某一点进行拦截调用。默认情况下，使用插件机制来实现拦截。对应以下对象方法执行前后进行拦截，动态代理，可以改变mybatis的一些默认行为，达到自定义的效果。（底层使用动态代理实现）</p>
<ul>
<li>Executor（update、query、flushStatement、commit、rollback、getTransaction、close、isClosed）</li>
<li>ParameterHandler（getParameterObject、setParameters）</li>
<li>ResultSetHandler（handleResultSets、handleOutputParameters）</li>
<li>StatementHandler（prepare、parameterize、batch、update、query）</li>
</ul>
<h2 id="environments">environments</h2>
<ul>
<li>MyBatis 可以<strong>配置成适应多种环境</strong>，这种机制有助于将 SQL 映射应用于<strong>多种数据库之中</strong></li>
<li>现实情况下有多种理由需要这么做。例如，<strong>开发、测试和生产环境</strong>都需要有不同的配置</li>
<li>或者想在具有相同 Schema的多个生产数据库中使用相同的 SQL 映射。还有许多类似的使用场景</li>
</ul>
<h3 id="说明-4">说明</h3>
<ul>
<li>
<p><strong>environments</strong>：“环境们”，mybatis可以配置多种环境，即<code>environment</code>标签。<strong>default属性</strong>指明当前使用的环境，即<code>environment</code>标签的<strong>id属性值</strong></p>
</li>
<li>
<p><strong>environment</strong>：配置一个具体的环境信息，<u>必须含以下两个标签</u>；<strong>id属性</strong>代表当前环境的唯一标识</p>
</li>
<li>
<p><strong>transactionManager</strong>：事务管理器标签（了解、一般使用Spring做事务控制）</p>
<ul>
<li><strong>type属性</strong>指定<u>事务管理器的类型</u>，可选项有<strong>JDBC</strong>|<strong>MANAGED</strong>|<strong>自定义</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>JDBC</strong>指使用<u>JDBC</u>来进行事务控制，<strong>MANAGED</strong>是使用<u>JEE容器</u>来控制事务</p>
<blockquote>
<p>JDBC与MANAGED其实是别名，实际对应操作类在Configuration.class中注JDBC(<strong>JdbcTransactionFactory</strong>)|MANAGED(<strong>ManagedTransactionFactory</strong>)</p>
</blockquote>
</li>
<li>
<p>自定义事务管理器：实现<strong>TransactionFactory</strong>接口，type指定为实现类的全类名</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p><strong>dataSource</strong>：<strong>type属性</strong>指定数据源类型，可选项为 <strong>UNPOOLED</strong> | <strong>POOLED</strong> | <strong>JNDI</strong> | <strong>自定义</strong>（了解，常在Spring中进行配置）</p>
<ul>
<li><strong>UNPOOLED</strong> ：不适用连接池技术，每次数据库操作都与数据库建立一次新的连接。</li>
<li><strong>POOLED</strong> ：适用连接池技术（默认自带）</li>
<li><strong>JNDI</strong> ：略，有兴趣再了解</li>
<li><strong>自定义数据源</strong>：如想使用C3P0等，实现<strong>DataSourceFactory</strong>接口，<strong>type属性</strong>填入<u>实现类的全类名</u></li>
</ul>
<blockquote>
<p>别名说明：</p>
<ul>
<li>UNPOOLED(UnpooledDataSourceFactory.java)</li>
<li>POOLED(PooledDataSourceFactory.java)</li>
<li>JNDI(JndiDataSourceFactory.java)</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="示例-4">示例</h3>
<ul>
<li>配置两个数据库环境示例，Mysql与Oracle</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过default属性指定使用某个环境 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 环境1：mysql数据库环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 环境2：Oracle数据库环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev_oracle&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="databaseldProvider">databaseldProvider</h2>
<ul>
<li><em><strong>databaseldProvider</strong></em>，译为“数据库供应商”。</li>
<li>利用该标签，可以为某些SQL操作的运行加上数据库厂商的约束。<u>即只有当前数据库环境符合设置的数据库厂商，才能够被执行</u>。</li>
<li>MyBatis可根据不同的数据库厂商(MySQL、Oracle…)，去执行对应产商格式的语句，也就是mybatis在移植性的支持。</li>
</ul>
<h3 id="说明-5">说明</h3>
<ul>
<li>
<p><strong>databaseIdProvider</strong>： <strong>type</strong>属性<strong>使用固定默认值</strong><code>type=&quot;DB_VENDOR&quot;</code></p>
<blockquote>
<p>DB_VENDOR也是别名，对应操作类为VendorDatabaseIdProvider，该操作类就是通过得到数据库厂商的标识(调用JDBC驱动的getDatabaseProductName()方法获取)，来区分执行不同的sql语句</p>
</blockquote>
</li>
<li>
<p><strong>property</strong>：可通过该标签为某个数据<strong>库厂商标识起别名</strong></p>
<ul>
<li><strong>name</strong>：数据库厂商标识</li>
<li><strong>value</strong>：自定义数据库厂商标识别名</li>
</ul>
</li>
<li>
<p><strong>常见数据库厂商标识</strong>：</p>
<ul>
<li>MySQL标识：<strong>MySQL</strong></li>
<li>Oracle标识：<strong>Oracle</strong></li>
<li>SQL Server标识：<strong>SQL Server</strong></li>
</ul>
</li>
</ul>
<h3 id="示例-5">示例</h3>
<p><strong>使用方式</strong>：若想为某一条数据库操作添加上两种不同数据库环境下的完整操作，需以下步骤</p>
<ol>
<li>
<p>准备好不同数据库的数据源信息：</p>
<ol>
<li>通过<strong>environment</strong>标签创建拟操作数据库对应数据源信息</li>
<li>修改<strong>environments</strong>标签的default属性指定使用指定的数据源</li>
</ol>
</li>
<li>
<p>启用<strong>databaseldProvider</strong>标签，并为数据库厂商标识<strong>起别名</strong></p>
</li>
<li>
<p>在sql映射xml文件中，</p>
<ol>
<li>按需创建多个<strong>id相同</strong>的不同环境下的sql语句操作</li>
<li>为这些sql语句操作添加<strong>databaseId属性</strong>，指定在哪个数据库厂商标识<strong>别名</strong>对应的环境下执行</li>
</ol>
<blockquote>
<p>相同id而没有添加<strong>databaseId属性</strong>的标签任何数据库环境下均被匹配，当存在多个相同id标签被匹配时，最终默认匹配更精确的标签（如有databaseId属性描述的标签）</p>
</blockquote>
</li>
</ol>
<h4 id="不同数据源准备">不同数据源准备</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过default属性指定使用某个环境 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 环境1：mysql数据库环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 环境2：Oracle数据库环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev_oracle&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;orcl.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="启用并为数据库厂商标识起别名">启用并为数据库厂商标识起别名</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 为不同的数据库厂商起别名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;SQL Server&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlserver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="指明sql语句的执行厂商">指明sql语句的执行厂商</h4>
<ul>
<li>在sql映射配置文件中指明每条<strong>相同id</strong>的sql语句执行的数据库厂商的别名，对应<code>databaseIdProvider</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta"> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.mybatis.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- mysql数据库环境执行 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">databaseId</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">		select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Oracle数据库环境执行 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">		select EMPLOYEE_ID id,LAST_NAME	lastName,EMAIL email </span><br><span class="line">		from employees where EMPLOYEE_ID=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>个文件id对照关系</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210323161647.png"
                      alt=""
                ></p>
<h2 id="mappers">mappers</h2>
<p><strong>mappers</strong>标签用于将<u>sql映射xml文件</u><strong>注册</strong>到<u>全局配置文件中</u>，而实现注册有以下<strong>三种不同的方式</strong></p>
<h3 id="普通注册方式">普通注册方式</h3>
<ul>
<li>
<p><strong>resource属性</strong>（三选一）：引用<strong>类路径</strong>下的sql映射文件，</p>
<blockquote>
<p>若不在类路径下，则按包名斜杠的格式定位到，如<code>com/test/dbconfig.properties</code></p>
</blockquote>
</li>
<li>
<p><strong>url属性</strong>（三选一）：引用<strong>网络路径</strong>或者<strong>磁盘路径</strong>下的sql映射文件</p>
</li>
<li>
<p><strong>class属性</strong>（三选一）：通过配置匹配映射文件的映射<strong>接口全类名</strong>来实现注册（配置需有前提）</p>
<ul>
<li>方式1（推荐）：将sql映射文件与接口<strong>同一目录下</strong>，且<u>映射文件</u>名必须与<u>接口</u><strong>同名</strong></li>
<li>方式2：没有sql映射文件，sql操作直接写在<strong>接口抽象方法的注解</strong>上，如<code>@Select(&quot;select...&quot;)</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapperAnnotation</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Select(&quot;select * from tbl_employee where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="function">Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ul>
<li>重要且复杂的Dao接口（sql），建议写sql映射文件实现（mybatis就是为了将sql抽取出xml文件里）</li>
<li>不重要，简单的Dao（sql）接口为了开发快速可以使用注解；</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mybatis/mapper/EmployeeMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;mapper class=&quot;com.company.mybatis.dao.EmployeeMapperAnnotation&quot;/&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>tips：eclipse下可采用在不同文件夹下建立与接口同包名的文件夹存放接口对应的sql映射文件，达到方便管理的要求（最终都会被合并到同一个目录下）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210813182524.png"
                      alt=""
                ></p>
</blockquote>
<h3 id="批量注册方式">批量注册方式</h3>
<ul>
<li>批量注册使用<code>package</code>子标签，是<strong>基于使用class属性注册上的一种方式</strong>。</li>
<li>因此使用package标签对<strong>包名</strong>进行注册时，必须<u>满足class属性注册</u>的<strong>两个前提之一</strong>（有映射文件必须同名同目录，无映射文件必须使用注解方式）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.company.mybatis.dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="objectFactory">objectFactory</h2>
<ul>
<li>了解，objectFactory用于配置对象工程，即mybatis查询数据后封装成java对象的工厂类，一般不用修改，即不用配置，了解即可</li>
</ul>
<h1 id="映射文件标签">映射文件标签</h1>
<h2 id="CRUD基础">CRUD基础</h2>
<ul>
<li><em><strong>CRUD</strong></em>即<strong>增加</strong>(Create)、<strong>查询</strong>/检索(Retrieve<code>[rɪˈtriːv]</code>)、<strong>更新</strong>(Update)、<strong>删除</strong>(Delete)四个单词的首字母缩写</li>
</ul>
<h3 id="CRUD标签">CRUD标签</h3>
<ul>
<li>Mybatis中<strong>CRUD</strong>操作分别对应，<strong>insert、select、update、delete</strong>标签</li>
<li>注意，标签内填写的SQL语句末尾<strong>不要带分号</strong><code>;</code></li>
</ul>
<h3 id="传入参数设置">传入参数设置</h3>
<h4 id="单个参数传入">单个参数传入</h4>
<ul>
<li><strong>基本数据类型</strong>：则占位参数名<u>无要求</u></li>
</ul>
<blockquote>
<p>因此传入参数类型parameterType设置是可选，由于并不是关键匹配因素</p>
</blockquote>
<ul>
<li><strong>Java对象类型</strong>： 要求设置传入的<strong>占位参数名</strong>必须和传入对象<strong>类型的属性名对应</strong>，即<code>#&#123;属性名&#125;</code>取值</li>
<li><strong>数组与集合类型</strong>：同多个参数设定，也会将其包装成一个Map类型
<ul>
<li>Collection类型（List、Set）
<ul>
<li>key：“collection”（如果是List类型、还可使用&quot;list&quot;）</li>
<li>value：集合对象本身</li>
</ul>
</li>
<li>Array类型：
<ul>
<li>key：“array”</li>
<li>value：数组对象本身</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="多个参数传入">多个参数传入</h4>
<h5 id="默认行为">默认行为</h5>
<ul>
<li>无论参数类型由哪些构成，一旦传入多个参数，都会被MyBatis<strong>包装成一个Map</strong></li>
<li>其中每一个参数的Map的<strong>key</strong>是<u>param<strong>1</strong>…param**N **</u>或 <u>索引从0开始，1，2…</u>。<strong>值</strong>就是<u>传入参数的值</u></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  public Employee getEmpByIdAndLastName(Integer id,String lastName);--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;param1&#125; and last_name=#&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="Param">@Param</h5>
<ul>
<li>由于默认的Map封装的Key不便于开发识别</li>
<li>Mybatis提供**@Param**注解对接口的抽象方法的形参在映射文件中所表示的占位参数名而命名</li>
</ul>
<hr>
<ul>
<li><strong>Dao接口</strong>：为接口的形参绑定命名</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeDao</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id,<span class="meta">@Param(&quot;lastName&quot;)</span>String lastName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>映射文件</strong>：此时就可以使用注解设定的名字</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="传入Map">传入Map</h5>
<ul>
<li>由于无论哪种方式，Mybatis都会将其封装成一个Map，然后编写SQL语句时用Map的Key作为占位符。</li>
<li>因此用户可以选择直接<strong>将抽象方法</strong>的<strong>形参设置为Map类型</strong>，传入操作参数时就一并<strong>设置好键</strong>和值</li>
<li>此时xml文件中编写SQL语句使用的参数占位符名就为传入时Map的键名</li>
</ul>
<h5 id="自封装TO">自封装TO</h5>
<ul>
<li><em><strong>TO</strong></em>，（Transfer Object）数据传输对象</li>
<li>如果多个参数不是业务模型中的数据，但是经常要使用，推荐封装成一个类用于传输数据，即为TO</li>
</ul>
<h4 id="特殊传入场景">特殊传入场景</h4>
<ul>
<li>
<p><strong>示例1</strong>：</p>
<ul>
<li><code>public Employee getEmp(@Param(&quot;id&quot;)Integer id,String lastName);</code></li>
<li>取值：<code>id==&gt;#&#123;id/param1&#125;   lastName==&gt;#&#123;param2&#125;</code></li>
</ul>
</li>
<li>
<p><strong>示例2</strong>：</p>
<ul>
<li><code>public Employee getEmp(Integer id,@Param(&quot;e&quot;)Employee emp);</code></li>
<li>取值：<code>id==&gt;#&#123;param1&#125;    lastName===&gt;#&#123;param2.lastName/e.lastName&#125;</code></li>
</ul>
</li>
<li>
<p><strong>示例3</strong>：</p>
<ul>
<li><code>public Employee getEmpById(List&lt;Integer&gt; ids);</code><br>
取值：取出第一个id的值， <code>#&#123;list[0]&#125;</code></li>
</ul>
</li>
</ul>
<h4 id="传入源码分析">传入源码分析</h4>
<p>（略）、教学视频中由讲解</p>
<h3 id="传入参数获取">传入参数获取</h3>
<p>Mybatis在映射文件中获取map中的值或者pojo对象属性的值时，可通过<code>#&#123;&#125;</code>或#<code>$&#123;&#125;</code>方式获取</p>
<ul>
<li><code>#&#123;&#125;</code>：是以预编译的形式，将参数设置到sql语句中（PreparedStatement）防止sql注入</li>
<li><code>$&#123;&#125;</code>：取出的值直接拼装在sql语句中；会有安全问题</li>
</ul>
<h4 id="方式">#{}方式</h4>
<ul>
<li>基于安全因素，一般普通情况下，建议都使用<code>#&#123;&#125;</code>方式，特殊情况才使用${}方式</li>
<li>其次，<code>#&#123;&#125;</code>方式支持在获取参数时<strong>指定一些特殊属性</strong>，使用上更丰富。常用的为jdbcType和mode</li>
</ul>
<table>
<thead>
<tr>
<th>参数规则</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>javaType</td>
<td></td>
</tr>
<tr>
<td><strong>jdbcType</strong></td>
<td></td>
</tr>
<tr>
<td><strong>mode</strong></td>
<td>存储过程</td>
</tr>
<tr>
<td>numericScale</td>
<td>设置获取的数字类型小数点保留</td>
</tr>
<tr>
<td>resultMap</td>
<td></td>
</tr>
<tr>
<td>typeHandler</td>
<td></td>
</tr>
<tr>
<td>jdbcTypeName</td>
<td></td>
</tr>
<tr>
<td>expression</td>
<td>表达式、未来准备支持的功能</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>jdbcType</strong>：用于处理不能传入null值进行SQL操作的数据库环境</p>
<ul>
<li>当进行SQL语句操作，而传入的数据存在null时，有些数据库可能不能识别Mybatis对null值的默认处理而直接报错</li>
<li>Mybatis默认将null值处理为OTHER类型。比如Oracle数据库则会因无法识别OTHER类型直接报错</li>
</ul>
<hr>
<ul>
<li>因此需设置Mybatis<strong>遇到null值</strong>时<strong>不以OTHER类型处理</strong>而是<strong>以NULL类型处理</strong>（Mysql和Oracle都支持）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;email,jdbcType=NULL&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>还有一种解决方案就是通过在<code>&lt;settings&gt;</code>标签中设置Mybatis当遇到null值时以NULL类型处理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;NULL&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h4 id="方式-2">${}方式</h4>
<ul>
<li>在某些原生jdbc不支持使用占位符的位置（表名、排序规则）就可以使用<code>$&#123;&#125;</code>进行取值</li>
<li>比如分表需改变表名时、排序需改变排序顺序时、或按照年份分表拆分，此时只能使用拼接方式</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> $&#123;<span class="keyword">year</span>&#125;_salary <span class="keyword">where</span> xxx;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_employee <span class="keyword">order</span> <span class="keyword">by</span> $&#123;f_name&#125; $&#123;<span class="keyword">order</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="影响条数返回">影响条数返回</h3>
<ul>
<li>Mybatis对<strong>增删改</strong>操作都封装其返回值，<strong>无需在xml配置</strong>，仅需在<u>接口方法定义其返回值类型</u>即可</li>
<li>默认支持<strong>Integer</strong>、<strong>Long</strong>(影响行数)和<strong>Boolean</strong>(大于一行返回true)三种包装类型</li>
</ul>
<h3 id="获取自增主键">获取自增主键</h3>
<p>在实际操作中，常常需要获取insert操作后的由数据库产生的自增主键</p>
<h4 id="Mysql">Mysql</h4>
<ul>
<li>
<p>由于Mysql本身就支持自增主键的获取，Mybatis自然可以将其封装后提供用户使用</p>
</li>
<li>
<p>Mybatis对于<strong>增删改</strong>的，<strong>获取自增的主键</strong>操作也给予了实现。在增删改操作标签中添加如下属性</p>
<ul>
<li><strong>useGeneratedKeys</strong>：默认为false、<u>设置为true启用</u>自增主键获取功能</li>
<li><strong>keyProperty</strong>：指定获取到的自增主键值，存储到<u>javaBean的哪个属性</u></li>
</ul>
</li>
</ul>
<blockquote>
<p>mysql也是使用原生的JDBC提供的statement.getGenreatedKeys()方法实现</p>
</blockquote>
<h4 id="Oracle（了解）">Oracle（了解）</h4>
<ul>
<li>
<p>某种需求或某些数据库<strong>插入的主键需要从其他地方获取</strong></p>
</li>
<li>
<p>如Oracle本身不支持数据插入主键自增。而需要在插入前<strong>先获取下一个序列值</strong>作为主键去<strong>模拟插入自增</strong></p>
</li>
<li>
<p>此时需要在CRUD标签内设置，<code>&lt;selectKey&gt;</code>子标签，用于描述获取插入数据的主键值</p>
<ul>
<li>
<p><strong>标签体</strong>：编写获取插入数据主键值的SQL语句</p>
</li>
<li>
<p><strong>keyProperty</strong>：指定获取到的自增主键值，存储到<u>javaBean的哪个属性</u></p>
</li>
<li>
<p><strong>order</strong>：选择selectKey子标签相对于CRUD标签的SQL语句执行顺序</p>
<ul>
<li>
<p><strong>BEFORE</strong>：当前sql在插入sql之前运行（建议使用）</p>
<blockquote>
<ol>
<li>查出序列的<strong>下一个id</strong>值封装给javaBean的id属性，并封装到bean的属性内</li>
<li>将查出的id值一并插入到数据库中；</li>
</ol>
</blockquote>
</li>
<li>
<p><strong>AFTER</strong>：当前sql在插入sql之后运行（同时插入多条数据有可能出现问题）</p>
<blockquote>
<ol>
<li>即先运行插入的sql（从序列中自动取出新值作为id），</li>
<li>再运行selectKey查询当前序列中的id值（即步骤1插入数据时的新值）封装到bean属性内</li>
</ol>
</blockquote>
</li>
</ul>
</li>
<li>
<p><strong>resultType</strong>：查出的数据的返回值类型</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">        select EMPLOYEES_SEQ.nextval from dual </span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span><br><span class="line">    values(#&#123;id&#125;,#&#123;lastName&#125;,#&#123;email&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="CRUD基础示例">CRUD基础示例</h3>
<h4 id="DAO接口">DAO接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.company.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeDao</span> </span>&#123;</span><br><span class="line">    <span class="function">Employee <span class="title">getEmployeeById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function">Integer <span class="title">addEmployee</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line">    <span class="function">Integer <span class="title">updateEmployee</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line">    <span class="function">Integer <span class="title">deleteEmployeeById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="CRUD配置">CRUD配置</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 查询，返回类型需用resultType属性指明 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 增加，parameterType可选 主要占位参数名与传入对象属性名要对应 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认就配置了修改操作(增删改)的影响条数返回值 --&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!-- useGeneratedKeys与keyProperty返回新增数据的自增主键并注入bean的id属性中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmployee&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">        insert into tbl_employee(last_name,email,gender)</span><br><span class="line">        values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改：同理增加操作 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmployee&quot;</span>&gt;</span></span><br><span class="line">        update tbl_employee</span><br><span class="line">        set last_name=#&#123;lastName&#125;,gender=#&#123;gender&#125;,email=#&#123;email&#125;</span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 删除：同理增加操作 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteEmployeeById&quot;</span>&gt;</span></span><br><span class="line">        delete from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="测试">测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        <span class="comment">//openSession()无参，默认自动提交session</span></span><br><span class="line">        SqlSession sqlSession = builder.build(inputStream).openSession();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            EmployeeDao mapper = sqlSession.getMapper(EmployeeDao.class);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//查找</span></span><br><span class="line">            Employee employee = mapper.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">            System.out.println(employee);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//增加</span></span><br><span class="line">            Employee deny = <span class="keyword">new</span> Employee(<span class="string">&quot;Deny&quot;</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;333@qq.com&quot;</span>);</span><br><span class="line">            mapper.addEmployee(deny);</span><br><span class="line">            System.out.println(deny.getId());  <span class="comment">//能返回新增数据的数据库自增主键</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//修改</span></span><br><span class="line">            deny.setGender(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">            mapper.updateEmployee(deny);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//删除</span></span><br><span class="line">            mapper.deleteEmployeeById(<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="select详解">select详解</h2>
<h3 id="返回类型">返回类型</h3>
<h4 id="对象类型">对象类型</h4>
<ul>
<li>直接设置resultType为返回类型的全类名、若为基本数据类型则使用对应包装类</li>
</ul>
<h4 id="集合类型">集合类型</h4>
<p>如果返回的是一个集合，<code>resultType</code>属性要写集合中元素的类型</p>
<ul>
<li>接口方法返回类型：<code>List&lt;Employee&gt;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByLastNameLike</span><span class="params">(String lastName)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>映射文件返回类型：<code>Employee</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByLastNameLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where last_name like #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Map类型">Map类型</h4>
<h5 id="返回一条记录">返回一条记录</h5>
<p>将查询的一条数据对应的POJO封装对象，以Map的形式返回，即对象中的每个属性按键值对方式返回</p>
<ul>
<li><strong>key</strong>：某条记录对应POJO对象的属性名</li>
<li><strong>value</strong>：POJO对象属性名对应的属性值</li>
</ul>
<hr>
<ul>
<li>抽象方法返回类型：<code>Map&lt;String, Object&gt;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getEmpByIdReturnMap</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>映射文件返回类型：<code>Map</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdReturnMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span><span class="comment">&lt;!-- 使用了默认别名 --&gt;</span></span><br><span class="line">    select * from tbl_employee where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="返回多条记录">返回多条记录</h5>
<ul>
<li>查询多条记录返回，将多条数据封装到Map集合中</li>
<li>设置返回类型
<ul>
<li><strong>key</strong>：每条记录的主键</li>
<li><strong>value</strong>：主键对应的每条记录</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>抽象方法返回类型：<code>Map&lt;Integer, Employee&gt;</code>，并通过<code>@MapKey</code>注解指明由Bean的<strong>哪个属性充当主键</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指明为当前bean（Employee）的id属性作为主键</span></span><br><span class="line"><span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;Integer, Employee&gt; <span class="title">getEmpByLastNameLikeReturnMap</span><span class="params">(String lastName)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>映射文件返回类型：<code>Employee</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByLastNameLikeReturnMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where last_name like #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="resultMap属性">resultMap属性</h2>
<h3 id="引言">引言</h3>
<h4 id="自动映射">自动映射</h4>
<ul>
<li>
<p><strong>autoMappingBehavior</strong>默认是<strong>PARTIAL</strong>，开启自动映射的功能</p>
<ul>
<li>唯一的要求是列名和javaBean属性名一致</li>
<li>如果autoMappingBehavior设置为<strong>null</strong>则会取消自动映射</li>
</ul>
</li>
<li>
<p>若数据库字段命名规范，POJO属性符合<strong>驼峰命名法</strong>，如 <code>A_COLUMN ——&gt; aColumn</code></p>
<ul>
<li>可以开启自动驼峰命名规则映射功能，<code>mapUnderscoreToCamelCase=true</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>除上述两种方法外，第三种就是通过resultMap属性自定义bean属性和数据库字段的映射关系</p>
</blockquote>
<h4 id="手动映射">手动映射</h4>
<ul>
<li><strong>resultMap</strong>属性可以<strong>自定义结果集映射规则</strong>，即查询字段名与bean属性名之间的映射关系</li>
<li>resultMap属性和resultType属性只能二选一使用</li>
</ul>
<h3 id="定义映射规则">定义映射规则</h3>
<p><code>&lt;resultMap&gt;</code>标签：用于自定义结果集映射规则</p>
<ul>
<li>
<p><strong>type</strong>属性：自定义数据库数据拟映射的Java类型</p>
</li>
<li>
<p><strong>id</strong>属性：用于唯一标识当前resultMap标签的映射规则，方便后续引用</p>
</li>
<li>
<p><code>&lt;id/&gt;</code>与<code>&lt;result/&gt;</code>子标签：一般主键字段用id标签定义（底层有优化），非主键字段用result标签定义</p>
<ul>
<li><strong>column</strong>属性：指定映射的数据库字段名</li>
<li><strong>property</strong>属性：指定被字段映射的Bean属性名</li>
</ul>
<blockquote>
<p>可以只指定部分字段的映射规则，其他不指定的列会自动封装。但建议只要使用resultMap就把全部的映射规则都写上</p>
</blockquote>
</li>
<li>
<p>最后，在select标签的resultMap属性上<strong>引用</strong>自定义的resultMap<strong>映射规则的id名</strong>，表示使用该映射规则</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta"> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.mybatis.dao.EmployeeMapperPlus&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 自定义映射规则 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public Employee getEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">		select * from tbl_employee where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="关联查询对象">关联查询对象</h3>
<h4 id="需求场景">需求场景</h4>
<ul>
<li>在查询Employee的同时查询员工所在部门（对象）的数据并封装到Employee内</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210819113700.png"
                      alt=""
                ></p>
<h4 id="级联属性方式">级联属性方式</h4>
<h5 id="查询所有字段">查询所有字段</h5>
<ul>
<li>通过原生sql的级联查询（多表查询），查询<strong>封装Employee</strong>对象需要的<strong>所有属性值</strong>（含Eepartment）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tbl_employee e,tbl_dept d </span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`d_id`</span> = d.<span class="string">`id`</span> </span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`id`</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查询结果字段：<strong>id</strong>  last_name  gender  email  d_id      <strong>id</strong>  dept_name</p>
<p>注意在resultMap设置映射不能够出现同名字段，因此需<strong>起别名</strong>或者直接用employee的d_id封装到Department id（建议先建立外键保持一致性）</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.*,dept_name <span class="keyword">FROM</span> tbl_employee e,tbl_dept d </span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`d_id`</span> = d.<span class="string">`id`</span> </span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`id`</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查询结果字段：    id  last_name  gender  email   <u>d_id  dept_name</u> (Department对象封装)</p>
</blockquote>
<h5 id="映射规则">映射规则</h5>
<ul>
<li>Employee对象内部的Department对象通过<code>属性名.内部属性名</code>的方式为bean中的对象中的属性赋值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--sql语句查询结果字段: id  last_name  gender  email d_id  dept_name   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;employeeMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 直接为department属性的id、name属性赋值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;department.id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;department.name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;employeeMapping&quot;</span>&gt;</span></span><br><span class="line">        SELECT e.*,dept_name FROM tbl_employee e,tbl_dept d</span><br><span class="line">        WHERE e.`d_id` = d.`id`</span><br><span class="line">        AND e.`id` = 1;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>查询结果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Employee&#123;id&#x3D;1, lastName&#x3D;&#39;Priscilla&#39;, gender&#x3D;&#39;女&#39;, email&#x3D;&#39;8888@qq.com&#39;, departmentId&#x3D;Department&#123;id&#x3D;2, name&#x3D;&#39;销售部&#39;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="嵌套对象方式">嵌套对象方式</h4>
<h5 id="查询所有字段-2">查询所有字段</h5>
<p>同上“级联熟悉方式”的sql语句</p>
<h5 id="映射规则-2">映射规则</h5>
<p>在resultMap标签内使用<code>&lt;association&gt;</code>子标签来定义引用类型数据相关的映射关系</p>
<ul>
<li><code>&lt;association&gt;</code>标签
<ul>
<li><strong>property</strong>属性：bean内嵌的引用数据类型属性名</li>
<li><strong>javaType</strong>属性：property属性所属的java类型（全类名或别名）</li>
</ul>
</li>
<li><code>&lt;id/&gt;</code>与<code>&lt;result/&gt;</code>子标签同上述“定义映射规则”用法，用于关联映射规则</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- id  last_name  gender  email d_id  dept_name   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;employeeMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 使用内嵌的联合标签定义引用类型数据映射关系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.company.bean.Department&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;employeeMapping&quot;</span>&gt;</span></span><br><span class="line">        SELECT e.*,dept_name FROM tbl_employee e,tbl_dept d</span><br><span class="line">        WHERE e.`d_id` = d.`id`</span><br><span class="line">        AND e.`id` = 1;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="分步查询方式">分步查询方式</h4>
<h5 id="普通方式">普通方式</h5>
<h6 id="sql语句">sql语句</h6>
<ul>
<li>第一步，通过员工id查询员工信息（含部门id的d_id字段）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> tbl_employee <span class="keyword">where</span> <span class="keyword">id</span> = <span class="comment">#&#123;id&#125;</span></span><br></pre></td></tr></table></figure>
<h6 id="映射规则-3">映射规则</h6>
<p>可以使用<code>&lt;association&gt;</code>标签对关联查询以分步查询的方式实现</p>
<ul>
<li><strong>property</strong>属性：bean内嵌的引用数据类型属性名</li>
<li><strong>select</strong>属性：表明当前属性是通过调用其他select标签指定的方法查出的结果赋值的。以完整的<code>[命名空间 + select标签id]</code>方式指明</li>
<li><strong>column</strong>属性：使用当前bean的哪个属性传入select标签执行调用</li>
</ul>
<hr>
<ul>
<li>通过部门id查询部门信息的sql映射文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.DepartmentDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDepartmentById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Department&quot;</span>&gt;</span></span><br><span class="line">        select id,dept_name name from tbl_dept where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在<code>&lt;association&gt;</code>标签中调用查询部门信息的select标签进行数据获取并封装</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;employeeMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 使用内嵌的联合标签通过调用其他select标签查询的结果进行属性封装 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">&quot;com.company.dao.DepartmentDao.getDepartmentById&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 仅查询employee数据表的数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;employeeMapping&quot;</span>&gt;</span></span><br><span class="line">        SELECT * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="延迟加载">延迟加载</h5>
<ul>
<li>
<p>分步查询支持延迟加载机制，即只有在程序调用相关查询步骤的数据时才执行sql查询</p>
</li>
<li>
<p>开启延迟加载，只需在主配置文件中的<code>&lt;settings&gt;</code>标签中增加以下setting标签配置信息</p>
<ul>
<li><strong>lazyLoadingEnabled</strong>：懒加载开启属性，当程序调用数据时才执行相关的sql语句，<strong>需开启为true</strong></li>
<li><strong>aggressiveLazyLoading</strong>：侵略性加载属性，即全部一次性查询结果。<strong>需关闭为false</strong></li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--显式的指定每个我们需要更改配置的值，即使他是默认的，防止版本更新带来的问题--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="关联查询集合">关联查询集合</h3>
<h4 id="需求场景-2">需求场景</h4>
<ul>
<li>如获取一个部门信息，其中部门id、名称、以及<strong>集合类型</strong>的该部门的所有员工信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210819180712.png"
                      alt=""
                ></p>
<h4 id="嵌套集合方式">嵌套集合方式</h4>
<h5 id="查询所有字段-3">查询所有字段</h5>
<ul>
<li>原生SQL查询语句，查询部门id=1的部门信息及其下所有员工信息（使用别名使字段不能重复）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.id dept_id,d.<span class="string">`dept_name`</span>,e.* <span class="keyword">FROM</span> tbl_dept d,tbl_employee e </span><br><span class="line"><span class="keyword">WHERE</span> d.id = e.<span class="string">`d_id`</span></span><br><span class="line"><span class="keyword">AND</span> d.id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回结果字段：<u>dept_id  dept_nam</u>e  <u>id  last_name  gender  email   d_id</u></p>
</blockquote>
<h5 id="映射规则-4">映射规则</h5>
<p>在resultMap标签内使用<code>&lt;collection&gt;</code>子标签来定义集合类型数据相关的映射关系</p>
<ul>
<li>
<p><code>&lt;collection&gt;</code>子标签：</p>
<ul>
<li><strong>property</strong>属性：bean内嵌的集合数据类型属性名</li>
<li><strong>ofType</strong>属性：集合中的元素所属的java类型（全类名或别名）</li>
</ul>
</li>
<li>
<p><code>&lt;id/&gt;</code>与<code>&lt;result/&gt;</code>子标签同上述“定义映射规则”用法，用于关联映射规则</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.DepartmentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- dept_id  dept_name | id  last_name  gender  email   d_id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;departmentMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Department&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;employeeList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDepartmentById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;departmentMapping&quot;</span>&gt;</span></span><br><span class="line">        SELECT d.id dept_id,d.`dept_name`,e.* FROM tbl_dept d,tbl_employee e</span><br><span class="line">        WHERE d.id = e.`d_id`</span><br><span class="line">        AND d.id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="分步查询方式-2">分步查询方式</h4>
<ul>
<li>同理“关联查询对象”的分步查询方式，支持懒加载设置</li>
</ul>
<h5 id="sql语句-2">sql语句</h5>
<ul>
<li>第一步，先通过部门id查询部门信息</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> tbl_dept <span class="keyword">where</span> <span class="keyword">id</span> = <span class="comment">#&#123;id&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="映射规则-5">映射规则</h5>
<ul>
<li><strong>property</strong>属性：bean内嵌的引用数据类型属性名</li>
<li><strong>select</strong>属性：表明当前属性是通过调用其他select标签指定的方法查出的结果赋值的。以完整的<code>[命名空间 + select标签id]</code>方式指明</li>
<li><strong>column</strong>属性：使用当前bean的哪个属性传入select标签执行调用</li>
</ul>
<hr>
<ul>
<li>通过部门id查询所有员工的映射文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeListByDeptId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where d_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在<code>&lt;collection&gt;</code>标签中调用查询部门id对应的所有员工信息的select标签进行数据获取并封装</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.DepartmentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- dept_id  dept_name | id  last_name  gender  email   d_id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;departmentMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Department&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;employeeList&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">&quot;com.company.dao.EmployeeDao.getEmployeeListByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDepartmentById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;departmentMapping&quot;</span>&gt;</span></span><br><span class="line">        SELECT * from tbl_dept where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="扩展属性使用">扩展属性使用</h3>
<h4 id="多个传入column">多个传入column</h4>
<ul>
<li>
<p>对于mybatis配置文件获取参数默认就是map方式获取，获取传入参数得名就是map键</p>
</li>
<li>
<p>因此当在<code>&lt;association&gt;</code>标签和<code>&lt;collection&gt;</code>标签中需传入多个column值时可以<strong>封装成map传入</strong></p>
</li>
<li>
<p>格式：<code>&quot;&#123;key1=value1,key2=value2&#125;&quot;</code></p>
</li>
</ul>
<hr>
<ul>
<li>被调用select标签</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeListByDeptId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where d_id = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>以map方式传入column</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;departmentMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Department&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;employeeList&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;com.company.dao.EmployeeDao.getEmployeeListByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">&quot;&#123;deptId=id&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="fetchType属性">fetchType属性</h4>
<ul>
<li>在使用分步查询中，可以<strong>针对当前sql操作进行延迟加载设置</strong>（开启或关闭），而不设置全局的延迟加载。</li>
<li>可以在<code>&lt;association&gt;</code>标签和<code>&lt;collection&gt;</code>标签中设置fetchType属性
<ul>
<li><strong>lazy</strong>：启用延迟加载，即懒加载</li>
<li><strong>eager</strong>：立即加载，即全部加载</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;departmentMapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.company.bean.Department&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;employeeList&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;com.company.dao.EmployeeDao.getEmployeeListByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">&quot;&#123;deptId=id&#125;&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;eager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="鉴别器">鉴别器</h3>
<h4 id="简介">简介</h4>
<ul>
<li>鉴别器指resultMap标签中的一个子标签<code>&lt;discriminator&gt;</code></li>
<li>鉴别器可以<strong>根据某列的值</strong>，根据该值<strong>改变封装行为</strong></li>
</ul>
<h4 id="示例-6">示例</h4>
<p><code>&lt;discriminator&gt;</code>标签</p>
<ul>
<li><strong>javaType</strong>属性：待判断列值对应的Java类型</li>
<li><strong>column</strong>：指定用于判定的列名（字段名）</li>
<li><code>&lt;case&gt;</code>子标签：相当于判断的分支语句，
<ul>
<li><strong>value</strong> 属性：当前判定条件所匹配的值</li>
<li><strong>resultType/resultMap</strong>：设置当前case语句执行sql的返回类型</li>
</ul>
</li>
</ul>
<blockquote>
<p>例：如果查出的是女生：就把部门信息查询出来，否则不查询；如果是男生，把last_name这一列的值赋值给email;</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmpDis&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 鉴别器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--女生 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;女&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">select</span>=<span class="string">&quot;com.company.mybatis.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--男生 ;如果是男生，把last_name这一列的值赋值给email; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="动态SQL">动态SQL</h1>
<h2 id="简介-2">简介</h2>
<ul>
<li>动态 SQL是MyBatis强大特性之一，可以按照特定条件执行特定sql语句，极大的简化我们<strong>拼装SQL的操作</strong></li>
<li>动态 SQL 元素和使用 JSTL 或其他类似基于 XML 的文本处理器相似</li>
<li>MyBatis 采用功能强大的基于 <strong>OGNL</strong> 的表达式来简化操作
<ul>
<li><strong>if</strong> ：单分支</li>
<li><strong>choose</strong> (when, otherwise) ：多分支，类似每个条件都带break的switch</li>
<li><strong>trim</strong> (where, set) ：拼接的SQL字符串截取</li>
<li><strong>foreach</strong>：循环</li>
</ul>
</li>
</ul>
<h2 id="OGNL表达式">OGNL表达式</h2>
<h3 id="简介-3">简介</h3>
<ul>
<li>
<p>OGNL（ Object Graph Navigation Language ）对象图导航语言</p>
</li>
<li>
<p>是一种强大的表达式语言，通过它可以非常方便的来操作对象属性。 类似EL，SpEL等</p>
</li>
</ul>
<h3 id="基础语法">基础语法</h3>
<ul>
<li>OGNL可以通过表达式的方式实现java代码般的书写，调用方法、构造器…</li>
<li>在Mybatis中的OGNL表达式使用的参数是<strong>传入参数</strong>，即如果传入对象类型则为对象的属性名</li>
</ul>
<hr>
<ul>
<li><strong>基础表达式</strong></li>
</ul>
<table>
<thead>
<tr>
<th>操作</th>
<th>语法</th>
</tr>
</thead>
<tbody>
<tr>
<td>访问对象属性</td>
<td><a class="link"   target="_blank" rel="noopener" href="http://person.name" >person.name<i class="fas fa-external-link-alt"></i></a></td>
</tr>
<tr>
<td>调用方法</td>
<td>person.getName()</td>
</tr>
<tr>
<td>调用静态属性/方法</td>
<td>@java.lang.Math@PI<br>@java.util.UUID@randomUUID()</td>
</tr>
<tr>
<td>调用构造方法</td>
<td>new com.company.bean.Person(‘admin’).name</td>
</tr>
<tr>
<td>运算符</td>
<td>+，-，*，/，%</td>
</tr>
<tr>
<td>逻辑运算符</td>
<td>in，not in，and，or，&gt;，&gt;=，&lt;，&lt;=，==，!=</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意：xml中特殊符号如，” , &gt; , &lt; '等这些都需要使用转义字符</p>
</blockquote>
<ul>
<li><strong>访问集合伪属性</strong></li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>伪属性</th>
<th>伪属性对应的Java方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>List、Set、Map</td>
<td>size、isEmpty</td>
<td>List/Set/Map.size(),List/Set/Map.isEmpty()</td>
</tr>
<tr>
<td>List、Set</td>
<td>iterator</td>
<td>List.iterator()、Set.iterator()</td>
</tr>
<tr>
<td>Map</td>
<td>keys、values</td>
<td>Map.keySet()、Map.values()</td>
</tr>
<tr>
<td>Iterator</td>
<td>next、hasNext</td>
<td>Iterator.next()、Iterator.hasNext()</td>
</tr>
</tbody>
</table>
<h2 id="if标签">if标签</h2>
<h3 id="语法格式">语法格式</h3>
<ul>
<li>if类同与编程语言中的if语句，单分支的条件判断标签</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;判断条件(OGNL表达式)&quot;</span>&gt;</span></span><br><span class="line">	符合后拼凑的SQL语句</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="示例-7">示例</h3>
<p>查询员工：要求，传入员工信息含哪个字段（不含id），查询条件就带上这个字段的值</p>
<ul>
<li>双引号<code>&quot;</code>为特殊字符，若表示字符串常量需要使用转意字符代表<code>&quot;&quot;</code>，如<code>&quot;男&quot;</code>则<code>&amp;quot;男&amp;quot; </code></li>
<li>在OGNL中，表示空串可以用单引号替代，如<code>email != '' </code></li>
<li>OGNL会自动将数值型转换为字符型后比较</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        select * from tbl_employee</span><br><span class="line">        where 1=1</span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName != null and lastName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and last_name like #&#123;lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender == <span class="symbol">&amp;quot;</span>男<span class="symbol">&amp;quot;</span> or gender == <span class="symbol">&amp;quot;</span>女<span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">            and gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and email = #&#123;email&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用if标签需注意某些条件不符合时SQL语法上的拼装问题，一般有两种解决方案</p>
<ol>
<li>如上述方式，在主要的SQL语句where条件后添加一个 <code>1 == 1</code>，后续拼凑的SQL全部带上<code>and</code></li>
<li>或使用mybatis提供的where标签将所有查询条件包括在内</li>
</ol>
</blockquote>
<h2 id="where标签">where标签</h2>
<ul>
<li>
<p>where标签用于等价替代SQL语句中的where关键字</p>
</li>
<li>
<p>作用在于避免if标签带来的SQL拼装语法问题，但也不能完全解决</p>
</li>
<li>
<p>where标签可以自动去除<strong>第一个多出的and或者or</strong></p>
<blockquote>
<p>即如果and习惯写在sql语句后的，如<code>gender = #&#123;gender&#125; and </code> 则<strong>无法去除后面多出的and</strong></p>
</blockquote>
</li>
</ul>
<hr>
<ul>
<li>示例：当lastName属性不存在时，gender多出的and关键字会被自动去除</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName != null and lastName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            last_name like #&#123;lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender == <span class="symbol">&amp;quot;</span>男<span class="symbol">&amp;quot;</span> or gender == <span class="symbol">&amp;quot;</span>女<span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">            and gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and email = #&#123;email&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="trim标签">trim标签</h2>
<h3 id="基本功能">基本功能</h3>
<ul>
<li>相较于if、where标签所出现的特定条件下字符串拼接语法错误，mybatis提供更灵活的trim标签解决</li>
<li>可以自定义从条件拼接的SQL语句中<strong>添加、删除、前缀或后缀特定字符串</strong></li>
</ul>
<h3 id="使用方式">使用方式</h3>
<ul>
<li>将所有条件标签写在trim标签内</li>
<li>trim标签有多个可选属性，分别完成拼接后的SQL语句的<strong>添加、删除、前缀或后缀特定字符串</strong>
<ul>
<li><strong>prefix</strong>属性：给拼串后的整个字符串加一个指定字符串前缀</li>
<li><strong>prefixOverrides</strong>属性：去掉整个字符串前面多余的指定字符</li>
<li><strong>suffix</strong>属性：给拼串后的整个字符串加一个指定字符串后缀</li>
<li><strong>suffixOverrides</strong>属性：去掉整个字符串后面多余的指定字符</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>例如，下述为拼接后的SQL语句添加&quot;where&quot;前缀且谈若后缀出现&quot;and&quot;删除</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义字符串的截取规则 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">        id=#&#123;id&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">        last_name like #&#123;lastName&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">        email=#&#123;email&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">        gender=#&#123;gender&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="choose标签">choose标签</h2>
<p>choose标签是一个多分支标签，而且<strong>一旦满足条件后立即退出</strong>，类似每个条件都带break的switch</p>
<ul>
<li><code>&lt;when&gt;</code>子标签：用于编写每一个条件，类似于switch的case关键字
<ul>
<li>test属性：编写判别条件，OGNL表达式</li>
</ul>
</li>
<li><code>&lt;otherwise&gt;</code>子标签：当所有<code>&lt;when&gt;</code>标签都不满足时执行，类似于switch的default关键字</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee </span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">                id=#&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null&quot;</span>&gt;</span></span><br><span class="line">                last_name like #&#123;lastName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span></span><br><span class="line">                email = #&#123;email&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                gender = 0</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="set标签">set标签</h2>
<ul>
<li>set标签和where标签同理，set标签用于替换set关键字并对可能多出的<code>,</code>进行删除</li>
<li>其中set就是sql中修改关键字update table <strong>set</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public void updateEmp(Employee employee);  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmp&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Set标签的使用 --&gt;</span></span><br><span class="line">    update tbl_employee </span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null&quot;</span>&gt;</span></span><br><span class="line">            last_name=#&#123;lastName&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span></span><br><span class="line">            email=#&#123;email&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender!=null&quot;</span>&gt;</span></span><br><span class="line">            gender=#&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="foreach标签">foreach标签</h2>
<h3 id="基本说明">基本说明</h3>
<p>当参与SQL执行的<strong>传入数据是集合类型</strong>时，可以使用foreach标签对<strong>传入的集合数据进行遍历拼凑</strong></p>
<ul>
<li><strong>collection</strong>：指定要遍历的集合，即<strong>抽象方法形参名</strong>或list类型直接key为&quot;<strong>list</strong>&quot;（list类型会被封装在map）</li>
<li><strong>item</strong>：将当前<u>遍历出的元素</u>赋值给指定的变量符合</li>
<li><strong>separator</strong>：每个元素之间的分隔符（自动拼凑在每一项之间）</li>
<li><strong>open</strong>：遍历出所有结果后拼接一个<u>开始</u>的字符</li>
<li><strong>close</strong>：遍历出所有结果后拼接一个<u>结束</u>的字符</li>
<li><strong>index</strong>：索引
<ul>
<li>遍历list的时候是index就是索引，item就是当前值</li>
<li>遍历map的时候index表示的就是map的key，item就是map的值</li>
</ul>
</li>
<li><strong>#{变量名}</strong>：取出变量的值也就是当前遍历出的元素</li>
</ul>
<h3 id="批量查询示例">批量查询示例</h3>
<p>模拟传入一个待查询id的List集合，遍历集合中的所有id并拼凑出in关键字的查询SQL语句</p>
<ul>
<li>如传入<code>getEmpsByConditionForeach(Arrays.asList(1,2,3,4));</code></li>
<li>对应转换出SQL语句为<code>select * from tbl_employee where id in(1,2,3,4)</code></li>
</ul>
<h4 id="接口方法">接口方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByConditionForeach</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="映射规则-6">映射规则</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionForeach&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from tbl_employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item_id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">open</span>=<span class="string">&quot;where id in(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;item_id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="批量保存示例">批量保存示例</h3>
<h4 id="多括号方式">多括号方式</h4>
<ul>
<li>MySQL下批量保存支持<code>values(),(),()</code>格式的语法，因此遍历拼凑的是后面的括号部分<code>()</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 批量保存 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--public void addEmps(@Param(&quot;emps&quot;)List&lt;Employee&gt; emps);  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span>&gt;</span></span><br><span class="line">    insert into tbl_employee(last_name,email,gender,d_id) </span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>&lt;include refid=&quot;insertColumn&quot;&gt;&lt;/include&gt;</code></p>
</blockquote>
<h4 id="多sql语句方式">多sql语句方式</h4>
<ul>
<li>直接拼凑多条完整的插入语句，每条语句用<code>;</code>号相隔。（也适用于批量删除和修改）</li>
<li>注意，这种方式需要在数据库连接信息中<code>jdbc.url:</code>追加<code>allowMultiQueries=true</code>，表示允许同时执行多条SQL语句</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这种方式需要数据库连接属性</span></span><br><span class="line"><span class="comment">   这种分号分隔多个sql可以用于其他的批量操作（删除，修改） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span></span><br><span class="line">        insert into tbl_employee(last_name,email,gender,d_id)</span><br><span class="line">        values(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Oracle方式，需有&quot;begin&quot;和&quot;end&quot;前后缀</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">open</span>=<span class="string">&quot;begin&quot;</span> <span class="attr">close</span>=<span class="string">&quot;end;&quot;</span>&gt;</span></span><br><span class="line">    insert into employees(employee_id,last_name,email) </span><br><span class="line">       values(employees_seq.nextval,#&#123;emp.lastName&#125;,#&#123;emp.email&#125;);</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="bind标签">bind标签</h2>
<p>在CRUD操作的标签中可以使用bind标签，可以将OGNL表达式传入的值绑定到一个变量中</p>
<ul>
<li><strong>value</strong>属性：被绑定值</li>
<li><strong>name</strong>属性：绑定后的变量名</li>
</ul>
<hr>
<ul>
<li>示例：通过bind标签实现在绑定变量同时为其变量前后加上<code>%</code>实现模糊查询功能</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsLikeName(String lastName);  --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsLikeName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将lastName传入变量添加前后缀&#x27;%&#x27;，并将其重命名为_lastName --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;_lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+lastName+&#x27;%&#x27;&quot;</span>/&gt;</span></span><br><span class="line">    select * from tbl_employee where last_name like #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>一般建议不适用该方式，还是传入参数时设置好模糊规则</p>
</blockquote>
<h2 id="内置参数">内置参数</h2>
<p>在mybatis中不只是接口方法传入的参数可以被使用，默认含有两个内置参数</p>
<ul>
<li><strong>_parameter</strong>：代表整个参数
<ul>
<li>单个参数：_parameter就是这个参数</li>
<li>多个参数：参数会被封装为一个map；_parameter就是代表这个map</li>
</ul>
</li>
<li><strong>_databaseId</strong>：代表当前使用的数据库的别名（配置的databaseIdProvider标签）</li>
</ul>
<h3 id="示例-8">示例</h3>
<ul>
<li><strong>功能1</strong>：通过获取当前使用数据库的_databaseId数值，实现不同数据库执行不同sql语句的效果</li>
<li><strong>功能2</strong>：如果传入的employee参数不为null，则加上where查询条件，此时_parameter等价于employee</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee);  --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsTestInnerParameter&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">        select * from tbl_employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">            where last_name #&#123;lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span></span><br><span class="line">        select * from employees</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">            where last_name #&#123;_parameter.lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="sql标签">sql标签</h2>
<ul>
<li>sql标签用于<strong>抽取可重用的sql片段</strong>，方便后续引用、复用</li>
<li>sql标签编写在与CRUD操作标签同级位置</li>
</ul>
<hr>
<ul>
<li><code>&lt;sql&gt;</code>标签：用于抽取sql片段
<ul>
<li><strong>id</strong>属性：用于唯一标识sql标签，被后续引用sql标签所使用</li>
</ul>
</li>
<li><code>&lt;include&gt;</code>标签：用于引用sql标签所声明的sql片段
<ul>
<li><strong>refid</strong>属性：指定引用sql标签的id</li>
<li><code>&lt;property&gt;</code>子标签：用于声明某些可被sql标签所引用的变量
<ul>
<li><strong>name</strong>属性：自定义的变量名，sql标签通过<code>$&#123;&#125;</code>引用时的key值（不能使用<code>#&#123;&#125;</code>方式）</li>
<li><strong>value</strong>属性：name变量的值</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span>&gt;</span></span><br><span class="line">    insert into tbl_employee(</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;insertColumn&quot;</span>&gt;</span>	<span class="comment">&lt;!-- 引用sql片段 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testProperty&quot;</span> <span class="attr">value</span>=<span class="string">&quot;abc&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    ) </span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;insertColumn&quot;</span>&gt;</span></span><br><span class="line">	employee_id,last_name,email,$&#123;testProperty&#125;	<span class="comment">&lt;!-- 此时$&#123;testProperty&#125; == abc --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="缓存机制">缓存机制</h1>
<h2 id="简介-4">简介</h2>
<p>对于某些数据库数据使用频率高且基本稳定的场景，可以把<u>第一次查询到的数据缓存起来，后续直接从缓存中读出数据</u>。不用每次建立数据库连接、查询、读取、封装等一系列操作。因此可以极大的<strong>提升查询效率</strong></p>
<ul>
<li>
<p>MyBatis包含一个非常强大的查询缓存特性,它可以非常方便地配置和定制。</p>
</li>
<li>
<p>MyBatis系统中默认定义了<strong>两级缓存</strong>，分别为一级缓存和二级缓存。</p>
<ul>
<li>
<p><strong>默认情况下</strong>，只有<strong>一级缓存</strong>（SqlSession级别的缓存， 也称为本地缓存）<strong>开启</strong></p>
</li>
<li>
<p>二级缓存需要手动开启和配置，他是基于namespace级别的缓存</p>
<blockquote>
<p>mybatis为了提高扩展性，定义了缓存接口Cache。通过实现该接口来自定义二级缓存</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="一级缓存">一级缓存</h2>
<h3 id="一级缓存体验">一级缓存体验</h3>
<ul>
<li>一级缓存，又称为本地缓存，基于sqlSession的缓存。<u>默认一直开启</u>（只能通过settings关闭）</li>
<li>与数据库<strong>同一次会话</strong>期间（SqlSession）<u>查询到的数据</u>会放在本地缓存中</li>
</ul>
<hr>
<ul>
<li>当在<strong>同一次SqlSession</strong>中对同一数据查询了两次，只发出了一次sql语句查询，为同一对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactory build = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">        SqlSession session = build.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            EmployeeDao mapper = session.getMapper(EmployeeDao.class);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//在同一次SqlSession中对同一数据查询了两次，只发出了一次sql语句查询</span></span><br><span class="line">            Employee employee1 = mapper.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">            Employee employee2 = mapper.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">            System.out.println(employee1 == employee2); <span class="comment">//true，同一对象</span></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="缓存失效情况">缓存失效情况</h3>
<ol>
<li>
<p><strong>sqlSession不同</strong>（重新创建新的sqlSession对象、sqlSession被关闭）</p>
</li>
<li>
<p>sqlSession相同，查询条件不同（当前一级缓存中还没有该数据）</p>
</li>
<li>
<p>sqlSession相同，两次查询之间执行了<strong>任意的增删改操作</strong>，缓存也会失效，重新获取新的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee employee1 = mapper.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">mapper.addEmployee(<span class="keyword">new</span> Employee(<span class="keyword">null</span>,<span class="string">&quot;Deny&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;333@qq.com&quot;</span>));</span><br><span class="line">Employee employee2 = mapper.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">System.out.println(employee1 == employee2);<span class="comment">//false</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>sqlSession相同，手动清理了一级缓存（只会清除当前sqlSession的一级缓存，对二级缓存没影响）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlSession.clearCache();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>一级缓存原理就是将同一个sqlSession对象中查询出来的数据都装入一个Map中，下次查询数据前先在Map中查询，如果没有则从数据库中获取，否则从Map中返回数据</p>
</blockquote>
<h2 id="二级缓存">二级缓存</h2>
<ul>
<li>二级缓存，又称为全局缓存，是基于namespace级别的缓存</li>
<li>映射文件中的一个namespace对应自己的一个二级缓存</li>
</ul>
<h3 id="工作原理">工作原理</h3>
<p>前提：开启了Mybatis的二级缓存后</p>
<ol>
<li>
<p>同一会话，查询一条数据，该数据会被存储在当前会话的一级缓存中</p>
</li>
<li>
<p><strong>当该会话关闭后</strong>，一级缓存中的数据会被保存到获取一级缓存数据时候对应的namespace中（二级缓存）</p>
<p>不同的namespace查出的数据放在自己对应的缓存中，互相独立，互不干扰</p>
</li>
</ol>
<p><strong>注</strong>：<u>查出的数据默认都会先存放在一级缓存中，只有当一级缓存的会话关闭或提交后，才会触发转存到二级缓存，否则二级缓存不工作</u></p>
<blockquote>
<p>Mybatis二级缓存中，任何时都是先从二级缓存中寻找数据，再到一级，再到数据库</p>
</blockquote>
<h3 id="开启二级缓存">开启二级缓存</h3>
<p>开启二级缓存需3个步骤：在setting配置开启二级缓存、在需要的sql映射文件中启用、POJO实现序列化接口</p>
<h4 id="setting配置">setting配置</h4>
<ul>
<li>开启二级缓存，cacheEnabled=true</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>虽然当前版本的cacheEnabled默认为true，但建议显式设置。遵循只要需设置的内容都要显式设置，避免因版本更新默认值改变导致出错</p>
</blockquote>
<h4 id="配置二级缓存">配置二级缓存</h4>
<p>在需要启用二级缓存的<strong>sql映射文件</strong>中通过<code>&lt;cache&gt;&lt;/cache&gt;</code>标签即可开启</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.company.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;LRU&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;60000&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;false&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1024&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmployeeById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.company.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>若只编写<code>&lt;cache&gt;&lt;/cache&gt; </code>则不指示任何策略均使用默认值。以下为可选配置<strong>属性</strong>、策略</p>
<ul>
<li><strong>eviction</strong>：缓存的回收策略
<ul>
<li>LRU – 最近最少使用的（默认）：移除最长时间不被使用的对象。</li>
<li>FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li>SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</li>
<li>WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</li>
</ul>
</li>
<li><strong>flushInterval</strong>：缓存刷新间隔，即缓存多长时间清空一次，单位为毫秒。默认不清空</li>
<li><strong>readOnly</strong>：是否只读
<ul>
<li>true：只读；mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改数据。<br>
mybatis为了加快获取速度，直接就会将数据在缓存中的引用交给用户。<u>不安全，速度快</u></li>
<li>false：非只读：mybatis觉得获取的数据可能会被修改。<br>
mybatis会利用序列化&amp;反序列的技术<strong>克隆一份新的数据</strong>提供。<u>安全，速度慢</u></li>
</ul>
</li>
<li><strong>size</strong>：缓存存放多少个数量的元素；</li>
<li><strong>type</strong>：指定自定义缓存的全类名（有默认的实现）。若自定义缓存则实现Cache接口，并填入缓存实现类全类名至此即可。</li>
</ul>
<h4 id="POJO实现序列化">POJO实现序列化</h4>
<p>由于二级缓存使用了<strong>序列化&amp;反序列化</strong>技术，因此参与数据库操作的Java类需<strong>实现Serializable接口</strong></p>
<h3 id="二级缓存测试">二级缓存测试</h3>
<h4 id="导入日志">导入日志</h4>
<ul>
<li>二级缓存测试<code>employee1 == employee2</code>不可能为true，因为二级缓存中提供的数据是克隆出来的</li>
<li>因此查看二级缓存的效果，需借助log4j日志查看加载信息</li>
</ul>
<h5 id="导入log4j">导入log4j</h5>
<ul>
<li>
<p>jar包：log4j.jar</p>
</li>
<li>
<p>maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="配置文件-2">配置文件</h5>
<ul>
<li>在类路径下创建名为<code>log4j.xml</code>的文件，并填写如下内容</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">log4j</span>:configuration <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%-5p %d&#123;MM-dd HH:mm:ss,SSS&#125; %m  (%F:%L) \n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="缓存测试">缓存测试</h4>
<ul>
<li>注意，无论何时都是先使用一级缓存，只要有当会话被结束才会转存到二级缓存中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactory build = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第一个会话，第一次查询id=1的数据，查询后关闭会话（数据转存到二级缓存）</span></span><br><span class="line">        SqlSession session1 = build.openSession();</span><br><span class="line">        EmployeeDao mapper1 = session1.getMapper(EmployeeDao.class);</span><br><span class="line">        Employee employee1 = mapper1.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">        session1.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取新的sqlSession对象，查询同样的数据</span></span><br><span class="line">        SqlSession session2 = build.openSession();</span><br><span class="line">        EmployeeDao mapper2 = session2.getMapper(EmployeeDao.class);</span><br><span class="line">        Employee employee2 = mapper2.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">        session2.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(employee1 == employee2); <span class="comment">//false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>日志输出：可以看到只执行了一条SQL语句，而且最后一行提示<code>Cache Hit Ratio</code>，“缓存命中”</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEBUG 08-21 12:47:37,689 Cache Hit Ratio [com.company.dao.EmployeeDao]: 0.0  (LoggingCache.java:60) </span><br><span class="line">DEBUG 08-21 12:47:38,056 &#x3D;&#x3D;&gt;  Preparing: select * from tbl_employee where id &#x3D; ?  (BaseJdbcLogger.java:137) </span><br><span class="line">DEBUG 08-21 12:47:38,113 &#x3D;&#x3D;&gt; Parameters: 1(Integer)  (BaseJdbcLogger.java:137) </span><br><span class="line">DEBUG 08-21 12:47:38,134 &lt;&#x3D;&#x3D;      Total: 1  (BaseJdbcLogger.java:137) </span><br><span class="line">WARN  08-21 12:47:38,153 As you are using functionality that deserializes object streams, it is recommended to define the JEP-290 serial filter. Please refer to https:&#x2F;&#x2F;docs.oracle.com&#x2F;pls&#x2F;topic&#x2F;lookup?ctx&#x3D;javase15&amp;id&#x3D;GUID-8296D8E8-2B93-4B9A-856E-0A65AF9B8C66  (SerialFilterChecker.java:46) </span><br><span class="line">DEBUG 08-21 12:47:38,159 Cache Hit Ratio [com.company.dao.EmployeeDao]: 0.5  (LoggingCache.java:60) </span><br><span class="line">false</span><br></pre></td></tr></table></figure>
<h3 id="缓存相关其他属性">缓存相关其他属性</h3>
<h4 id="CRUD相关">CRUD相关</h4>
<ul>
<li><strong>查询标签</strong>（select）
<ul>
<li><strong>useCache</strong>属性：默认为true。设置为<strong>false</strong>时表示当前标签操作<strong>关闭二级缓存</strong></li>
<li><strong>flushCache</strong>属性：<u>默认为false</u>，即不清除缓存</li>
</ul>
</li>
<li><strong>增删改标签</strong>（insert、delete、update）
<ul>
<li><strong>flushCache</strong>属性：<u>默认为true</u>，表示执行完增删改标签后会<strong>清除所有缓存</strong>（一级和二级）</li>
</ul>
</li>
</ul>
<h4 id="settings相关">settings相关</h4>
<p>localCacheScope设置，称为<strong>本地缓存作用域</strong>（设置只对一级缓存有效），取值如下：</p>
<ul>
<li><strong>SESSION</strong>：会话级别的一级缓存作用域，默认作用域，即sqlSession作用域</li>
<li><strong>STATEMENT</strong>：可以禁用一级缓存（一般不配置）</li>
</ul>
<h2 id="第三方缓存整合">第三方缓存整合</h2>
<ul>
<li>
<p>Mybatis自带缓存功能，但不精通缓存设计。为了扩展性设计了一个<strong>Cache接口</strong>可用于更替缓存实现类</p>
</li>
<li>
<p>下述介绍使用<strong>第三方缓存库ehcache</strong>整合到mybatis中</p>
</li>
</ul>
<h3 id="导入ehcache核心包">导入ehcache核心包</h3>
<ul>
<li>
<p>导入jar包方式</p>
<ul>
<li>ehcache-core-2.6.8.jar</li>
<li>slf4j-api-1.6.1.jar（依赖）</li>
<li>slf4j-log4j12-1.6.2.jar（依赖）</li>
</ul>
</li>
<li>
<p>maven方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="下载ehcache适配包">下载ehcache适配包</h3>
<ul>
<li>理论上，导入第三方缓存jar包后，通过调用第三方库间接实现Cache接口中所有方法就完成了整合操作</li>
<li>由于Mybatis官方还提供<strong>不同第三方缓存</strong>整合时的<strong>适配包</strong>，替代完成了上述的适配实现接口操作。更方便</li>
</ul>
<hr>
<ol>
<li>
<p>进入mybatis官方<a class="link"   target="_blank" rel="noopener" href="https://github.com/orgs/mybatis/repositories" >GitHub仓库<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li>
<p>查找整合ehcache第三方缓存的适配包</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210821160658.png"
                      alt=""
                ></p>
</li>
<li>
<p>页面滚到底部，进入<a class="link"   target="_blank" rel="noopener" href="http://mybatis.org/ehcache-cache/" >ehcache整合的mybatis官方文档<i class="fas fa-external-link-alt"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210821160813.png"
                      alt=""
                ></p>
</li>
<li>
<p>点击&quot;<strong>zip bundle</strong>&quot;下载ehcache适配器的jar包导入或选择添加maven依赖</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210821161127.png"
                      alt=""
                ></p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="引入ehcache-xml">引入ehcache.xml</h3>
<ul>
<li>在类路径下导入官方提供的ehcache.xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;../config/ehcache.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 磁盘保存路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;D:\44\ehcache&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;10000&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">maxElementsOnDisk</span>=<span class="string">&quot;10000000&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">属性说明：</span></span><br><span class="line"><span class="comment">l diskStore：指定数据在磁盘中的存储位置。</span></span><br><span class="line"><span class="comment">l defaultCache：当借助CacheManager.add(&quot;demoCache&quot;)创建Cache时，EhCache便会采用&lt;defalutCache/&gt;指定的的管理策略</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">以下属性是必须的：</span></span><br><span class="line"><span class="comment">l maxElementsInMemory - 在内存中缓存的element的最大数目 </span></span><br><span class="line"><span class="comment">l maxElementsOnDisk - 在磁盘上缓存的element的最大数目，若是0表示无穷大</span></span><br><span class="line"><span class="comment">l eternal - 设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断</span></span><br><span class="line"><span class="comment">l overflowToDisk - 设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">以下属性是可选的：</span></span><br><span class="line"><span class="comment">l timeToIdleSeconds - 当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时，这些数据便会删除，默认值是0,也就是可闲置时间无穷大</span></span><br><span class="line"><span class="comment">l timeToLiveSeconds - 缓存element的有效生命期，默认是0.,也就是element存活时间无穷大</span></span><br><span class="line"><span class="comment"> diskSpoolBufferSizeMB 这个参数设置DiskStore(磁盘缓存)的缓存区大小.默认是30MB.每个Cache都应该有自己的一个缓冲区.</span></span><br><span class="line"><span class="comment">l diskPersistent - 在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false。</span></span><br><span class="line"><span class="comment">l diskExpiryThreadIntervalSeconds - 磁盘缓存的清理线程运行间隔，默认是120秒。每个120s，相应的线程会进行一次EhCache中数据的清理工作</span></span><br><span class="line"><span class="comment">l memoryStoreEvictionPolicy - 当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出）</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置第三方缓存">配置第三方缓存</h3>
<ul>
<li>在sql映射文件中启用二级缓存时用type属性指明缓存实现类全路径即可</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.acme.FooMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>（可选、其他）引用某命名空间下所设置的缓存</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.acme.FooMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;org.acme.FooMapper&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Mybatis缓存原理">Mybatis缓存原理</h2>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/mybatis%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%8601.png"
                      alt=""
                ></p>
<h1 id="SSM整合基础">SSM整合基础</h1>
<ol>
<li>下载或导入对应版本的Mybatis适配Spring框架的适配包</li>
<li>导入Spring依赖</li>
<li>web.xml、SpringMVC、Spring配置文件编写</li>
</ol>
<h2 id="Mybatis-Spring下载">Mybatis-Spring下载</h2>
<p>Mybatis-Spring是Mybatis官方整合Spring框架的适配包名称</p>
<blockquote>
<p>Mybatis还贴心地提供了一个整合完整的SSM项目供开发人员参考，名为：jpetstore-6</p>
</blockquote>
<ol>
<li>
<p>进入Mybatis的<a class="link"   target="_blank" rel="noopener" href="https://github.com/orgs/mybatis/repositories" >GitHub仓库<i class="fas fa-external-link-alt"></i></a>中的<a class="link"   target="_blank" rel="noopener" href="https://github.com/mybatis/spring" >整合Spring框架项目<i class="fas fa-external-link-alt"></i></a>中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210822105816.png"
                      alt=""
                ></p>
</li>
<li>
<p>mybatis的spring整合GitHub页面底部，进入<a class="link"   target="_blank" rel="noopener" href="http://mybatis.org/spring/zh/index.html" >整合spring的mybatis官方文档<i class="fas fa-external-link-alt"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210822110042.png"
                      alt=""
                ></p>
</li>
<li>
<p>从官方文档中查看当前需整合的Mybatis和Spring版本所支持对应的Mybatis-Spring适配器版本是多少</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210822110351.png"
                      alt=""
                ></p>
</li>
<li>
<p>确定Mybatis-Spring版本后，回到mybatis整合Spring的GitHub仓库，进入release，下载需要的版本</p>
<p>或进入导入对应版本的<a class="link"   target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.mybatis/mybatis-spring" >maven依赖<i class="fas fa-external-link-alt"></i></a></p>
</li>
</ol>
<h2 id="配置文件编写">配置文件编写</h2>
<h3 id="web-xml">web.xml</h3>
<ol>
<li>配置使Spring的IoC容器跟随web一并启动</li>
<li>配置SpringMVC的配置文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1、Spring配置文件配置：使Spring的IoC容器跟随web一并启动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定Spring配置文件的位置（类路径下） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2、SpringMVC配置文件配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="SpringMVC">SpringMVC</h3>
<p>SpringMVC只控制网站跳转逻辑，即只负责控制器部分</p>
<ol>
<li>配置组件扫描（对应当前SpringMVC的IoC容器来说，只扫描控制器注解即可）</li>
<li>基本标签配置，处理动态资源的标签和处理静态资源的mvc标签</li>
<li>配置视图解析器：使用自带的内部资源访问视图解析器，处理jsp页面</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1、开启SpringMVC的IoC容器组件扫描，且只扫描@Controller注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2、基本标签配置，处理动态资源的标签和处理静态资源的mvc标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3、配置视图解析器：使用spring自带的内部资源访问视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Spring">Spring</h3>
<p>Spring主要用于管理所有的业务逻辑（服务逻辑、数据源、事务控制）组件</p>
<ol>
<li>
<p>配置组件扫描（对应当前Spring的IoC容器来说，与SpringMVC刚好相反，出控制器外都需要扫描）</p>
</li>
<li>
<p>配置数据源（数据库连接池，当前使用c3p0数据库连接池）</p>
</li>
<li>
<p>配置事务管理器。开启事务注解，并指明事务管理器实现类对象。</p>
<blockquote>
<p>当前使用事务管理器为DataSourceTransactionManagerg，需导入jdbcTemplate即spring-jdbc依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>整合mybatis，创建（配置）SqlSessionFactory对象</p>
<blockquote>
<ul>
<li>mybatis提供的SqlSession对象工厂类，实现了Spring的工厂bean接口。使其融合到Spring的操作逻辑中，调用工厂的getObject()方法返回sqlSession对象，提供给Spring进行持久层的访问</li>
<li><strong>SqlSessionFactory相当于mybatis配置文件的Java对象，封装了配置文件的许多信息</strong></li>
<li><strong>在mybatis-config.xml配置的标签，都可以在SqlSessionFactory找到对应的属性注入设置</strong></li>
</ul>
</blockquote>
<ul>
<li>注入数据源</li>
<li>注入mybatis全局配置文件（路径；创建sqlSession需要；属于自定义路径方式）</li>
<li>注入sql映射文件（路径；创建代理实现类对象mapper需要）</li>
<li>开启扫描所有的sql映射接口标签。使其实现类（mybatis实现的代理类）能够被以自动注入方式使用</li>
</ul>
</li>
</ol>
<ul>
<li><strong>applicationContext.xml</strong></li>
</ul>
<blockquote>
<p>注意：只要启用了&lt;mybatis-spring:scan base-package=“com.company.dao”/&gt;标签，Spring会自动将mybatis生成的sql操作代理实现类存放到IoC容器中，此时dao的java接口类不用添加@Repository，虽然IDEA会在service通过自动装配dao时候提示“无法找到该bean”但实际可以运行使用</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mybatis-spring</span>=<span class="string">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/tx/spring-tx.xsd http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1、开启组件扫描、除@Controller外扫描所有组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2、配置数据源 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入外部配置文件，获取内部的数据库连接信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:dbconfig.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3、配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启事务注解，并指明事务管理器实现类对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4、整合mybatis，实际就是创建SqlSessionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置加载sql映射文件，指定类路径的mapper目录下的所有xml文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/*.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描所有的sql映射接口，使其实现类（mybatis实现的代理类）能够被以自动注入方式使用 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 该标签需引入mybatis-spring命名空间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-spring:scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company.dao&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="逆向工程">逆向工程</h1>
<h2 id="基本概念">基本概念</h2>
<ul>
<li>
<p>MyBatis Generator，译为&quot;代码生成器&quot;：简称MBG，是一个专门为MyBatis框架使用者定制的<strong>代码生成器</strong></p>
</li>
<li>
<p>MBG可以快速的<strong>根据表生成</strong>对应的<u>映射文件，接口，以及bean类</u>（逆向操作——逆向工程）</p>
</li>
<li>
<p>支持基本的增删改查，以及QBC风格的条件查询。但是表连接、 存储过程、复杂sql定义等需要用户编写</p>
<blockquote>
<p>官方文档地址 <a class="link"   target="_blank" rel="noopener" href="http://www.mybatis.org/generator/" >http://www.mybatis.org/generator/<i class="fas fa-external-link-alt"></i></a></p>
<p>官方工程地址 <a class="link"   target="_blank" rel="noopener" href="https://github.com/mybatis/generator/releases" >https://github.com/mybatis/generator/releases<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
</li>
</ul>
<h2 id="依赖下载">依赖下载</h2>
<ul>
<li>在Mybatis <a class="link"   target="_blank" rel="noopener" href="https://github.com/mybatis/generator/releases" >Generator的Github仓库release<i class="fas fa-external-link-alt"></i></a>中下载jar包等资料（官方文档在此下载）</li>
<li>或选择导入maven依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="mbg配置文件">mbg配置文件</h2>
<ul>
<li>基于官方提供的配置文件例子编写</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      targetRuntime=</span></span><br><span class="line"><span class="comment">			&quot;MyBatis3Simple&quot;:生成简单版的CRUD</span></span><br><span class="line"><span class="comment">      		&quot;MyBatis3&quot;:豪华版，在生成CRUD基础上带复杂条件CRUD操作</span></span><br><span class="line"><span class="comment">  	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jdbcConnection：指定如何连接到目标数据库 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?allowMultiQueries=true&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- javaModelGenerator：指定javaBean的生成策略 </span></span><br><span class="line"><span class="comment">         		targetPackage=&quot;com.company.bean&quot;：设置自动生成的bean所在包名</span></span><br><span class="line"><span class="comment">         		targetProject=&quot;.\src&quot;：生成的目标工程（当前工程的src下）</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.company.bean&quot;</span> </span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">&quot;.\src&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 查看官方文档 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- sqlMapGenerator:sql映射生成策略 </span></span><br><span class="line"><span class="comment">			同理上述的javaModelGenerator标签配置的两个属性</span></span><br><span class="line"><span class="comment">			定义自动生成的sql映射文件所在包名和所在工程</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.company.dao&quot;</span>  </span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;.\conf&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- javaClientGenerator:指定mapper接口生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.company.dao&quot;</span>  </span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">&quot;.\src&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定要逆向分析的表：指定待分析表对应的javaBean类名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;tbl_dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Department&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;tbl_employee&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="生成逆向工程">生成逆向工程</h2>
<ul>
<li>官方文档提供的启用生成逆向工程方式很多，下述才有含上述配置文件方式启动生成逆向工程</li>
<li>执行代码后，将会通过表格生成对应的基础的bean、mapper接口、sql映射文件等…</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMbg</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">    File configFile = <span class="keyword">new</span> File(<span class="string">&quot;mbg.xml&quot;</span>);</span><br><span class="line">    ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">    Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">    DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">    MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config,</span><br><span class="line">                                                             callback, warnings);</span><br><span class="line">    myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="工作原理与源码分析">工作原理与源码分析</h1>
<ul>
<li>了解Mybatis底层工作原理和源码主要便于理解插件的开发</li>
</ul>
<h2 id="分层架构">分层架构</h2>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/Mybatis%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84%E5%9B%BE01.png"
                      alt=""
                ></p>
<blockquote>
<p>ParameterHandler参数处理器、SqlSource（StatementHandler 语句处理器）ResultSetHandler结果集处理器、Exeutor执行器</p>
</blockquote>
<h2 id="关键步骤">关键步骤</h2>
<p>一般源码分析都是以HelloWorld为例起步，<u>关键步骤可以总结为以下4点</u>：</p>
<ol>
<li><strong>创建SqlSessionFactory对象</strong></li>
<li><strong>创建SqlSession对象</strong></li>
<li><strong>创建接口的代理对象</strong>（MapperProxy）</li>
<li><strong>通过代理对象执行CRUD操作</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line"></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            EmployeeDao mapper = sqlSession.getMapper(EmployeeDao.class);</span><br><span class="line">            Employee employee = mapper.getEmployeeById(<span class="number">1</span>);</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建SqlSessionFactory">创建SqlSessionFactory</h2>
<p>源码起始调用代码：<code>new SqlSessionFactoryBuilder().build(is)</code></p>
<ol>
<li>创建parser解析器解析<strong>全局配置文件</strong>，并将信息<strong>保存到Configuration</strong>对象中</li>
<li>创建mapperParser解析器解析所有<strong>SQL映射文件</strong>，并封装成每一个<strong>MapperdStatement对象</strong></li>
<li>并将每一个映射文件对应的<strong>MapperdStatement</strong>对象<strong>也保存在Configuration对象</strong>中</li>
<li>将Configuration作为构造器实参，<strong>创建DefaultSqlSessionFactory对象</strong>（SqlSessionFactory接口实现类）<strong>并返回</strong></li>
</ol>
<p><strong>小结</strong>：把所有配置文件解析并保存在Configuration中并返回DefaultSqlSessionFactory对象（含MappedStatement对象）</p>
<blockquote>
<p>补充一个封装到Configuration重要属性对象——mapperRegistry，其中knownMappers属性以Map的方式存储了<strong>接口对应的代理实现类工厂</strong>（interface——MapperProxyFactory）</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/SqlSessionFactory%E5%88%9B%E5%BB%BA%E6%97%B6%E5%BA%8F%E5%9B%BE01.png"
                      alt=""
                ></p>
<h2 id="创建SqlSession对象">创建SqlSession对象</h2>
<p>源码起始调用代码：<code>sqlSessionFactory.openSession();</code></p>
<ol>
<li>
<p>从Configuration中<strong>获取默认执行器类型</strong>，并以此为实参调用openSessionFromDataSource()方法</p>
<blockquote>
<p>当前默认执行器类型在settings中可以设置defaultExecutorType，可选值为SIMPLE（简单）、REUSE（可复用）、BATCH（批量操作）</p>
</blockquote>
</li>
<li>
<p>在此创建了一个事务，并以该事务对象和监听器类型为构造器实参通过Configuration对象创建了一个Executor对象</p>
</li>
<li>
<p>根据全局配置文件的settings标签中的defaultExecutorType，<strong>创建对应类型的Executor对象</strong></p>
</li>
<li>
<p>若开启二级缓存，则以Executor为实参传入构造器创建CachingExecutor对象</p>
</li>
<li>
<p>将所有配置的拦截器（插件）包装到Executor对象中并返回</p>
</li>
<li>
<p>最后以Configuration、Executor、AutoCommit对象为实参<strong>创建DefaultSqlSession</strong>（SqlSession接口的实现类）<strong>并返回</strong></p>
</li>
</ol>
<p><strong>小结</strong>：返回一个DefaultSQLSession对象，包含Executor和Configuration</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/SqlSession%E5%88%9B%E5%BB%BA%E6%97%B6%E5%BA%8F%E5%9B%BE01.png"
                      alt=""
                ></p>
<h2 id="创建接口的代理对象">创建接口的代理对象</h2>
<p>源码起始调用代码：<code>sqlSession.getMapper(EmployeeDao.class);</code></p>
<p><strong>小结</strong>：使用创建SqlSessionFactory时已经创建的接口映射MapperProxyFactory的工厂对象创建MapperProxy的代理对象（实现InvocationHandler)，其中代理对象包含了SqlSession（DefaultSqlSession），SqlSession又包含了Excutor（执行CRUD）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/mapper%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E6%97%B6%E5%BA%8F%E5%9B%BE01.png"
                      alt=""
                ></p>
<h2 id="代理对象执行CRUD">代理对象执行CRUD</h2>
<p>源码起始调用代码：<code>mapper.getEmployeeById(1);</code>——&gt;代理对象执行方法都是调<code>invoke()</code></p>
<h3 id="执行流程总结">执行流程总结</h3>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210823163150.png"
                      alt=""
                ></p>
<h3 id="时序图（参考）">时序图（参考）</h3>
<ul>
<li>四大对象，Executor、StatementHandler、ParameterHandler、ResultSetHandler创建时都调用了拦截链进行包装</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/Mybatis-mapper%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E6%97%B6%E5%BA%8F%E5%9B%BE01.png"
                      alt=""
                ></p>
<h2 id="总结">总结</h2>
<ol>
<li>
<p>根据配置文件（全局，sql映射）初始化出Configuration对象</p>
</li>
<li>
<p>创建一个DefaultSqlSession对象，该对象含Configuration以及Executor</p>
<blockquote>
<p>根据全局配置文件中的defaultExecutorType创建出对应的Executor</p>
</blockquote>
</li>
<li>
<p>调用DefaultSqlSession.getMapper()，拿到Mapper接口对应的MapperProxy；</p>
</li>
<li>
<p>MapperProxy里面有（DefaultSqlSession）；</p>
</li>
<li>
<p>执行增删改查方法：</p>
<ol>
<li>调用DefaultSqlSession的增删改查（调用Executor）；</li>
<li>创建一个StatementHandler对象。（同时创建出ParameterHandler和ResultSetHandler）</li>
<li>调用StatementHandler预编译参数以及设置参数值（使用ParameterHandler来给sql设置参数）</li>
</ol>
</li>
<li>
<p>调用StatementHandler的增删改查方法；</p>
</li>
<li>
<p>ResultSetHandler封装结果</p>
</li>
</ol>
<p><strong>注</strong>：四大对象创建的时都会与拦截器进行包装：<code>interceptorChain.pluginAll(parameterHandler);</code></p>
<h1 id="插件开发">插件开发</h1>
<h2 id="简介-5">简介</h2>
<ul>
<li>
<p>MyBatis在<strong>四大对象的创建过程</strong>中，都有插件介入</p>
<blockquote>
<p>插件利用动态代理机制层层包装目标对象(AOP)，实现在目标对象执行目标方法之前进行拦截的效果。</p>
</blockquote>
</li>
<li>
<p>MyBatis允许在已映射语句<strong>执行过程中的某一点进行拦截调用</strong>。</p>
</li>
<li>
<p>默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<ul>
<li><strong>Executor</strong> (update, query, flushStatements, commit, rollback,  getTransaction, close, isClosed)</li>
<li><strong>ParameterHandler</strong>(getParameterObject, setParameters)</li>
<li><strong>ResultSetHandler</strong>(handleResultSets, handleOutputParameters)</li>
<li><strong>StatementHandler</strong>(prepare 预编译, parameterize 设置参数, batch, update, query)</li>
</ul>
</li>
</ul>
<blockquote>
<p>四大对象都是接口，具体操作实现有其实现类完成，一般命名未DefaultXxxx</p>
</blockquote>
<h2 id="插件运行原理">插件运行原理</h2>
<ul>
<li>
<p>在四大对象创建的时不是直接返回的，而是均调用了<code>interceptorChain.pluginAll(xxxx);</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">pluginAll</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Interceptor interceptor : interceptors) &#123;</span><br><span class="line">        target = interceptor.plugin(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>遍历所有的Interceptor（拦截器）（开发插件需实现的接口）。最后调用interceptor.plugin(target);返回包装后的target对象</p>
</li>
<li>
<p>使用插件为目标对象创建一个代理对象（AOP），利用代理对象就可以拦截到四大对象的每一个执行</p>
</li>
</ul>
<h2 id="HelloWord">HelloWord</h2>
<ol>
<li>编写插件，即编写Interceptor接口的实现类</li>
<li>使用@Intercepts注解完成插件签名</li>
</ol>
<ul>
<li>将写好的插件注册到全局配置文件中</li>
</ul>
<h3 id="插件编写">插件编写</h3>
<ul>
<li>实现mybatis的Interceptor接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-08-23 17:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截器：用于拦截目标对象的目标方法执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> invocation</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标对象的目标方法执行后的结果（返回值）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//调用proceed()方法表示执行目标方法，即放行。返回值为目标方法执行的返回值</span></span><br><span class="line">        <span class="comment">//不执行proceed()方法则表示拦截</span></span><br><span class="line">        Object proceed = invocation.proceed();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;MyFirstPlugin...intercept()拦截的方法：&quot;</span> + invocation.getMethod());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//此时拦截器返回值为目标方法执行后的返回值</span></span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插件：plugin方法用于包装传入的目标对象（四大对象）</span></span><br><span class="line"><span class="comment">     *   - 包装的本质就是为其目标对象创建代理类，从而实现调用的拦截效果</span></span><br><span class="line"><span class="comment">     *   - 即此方法中主要实现target对象的代理对象的创建。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 被包装后的对象（代理对象）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//自编写原生代理实现或利用mybatis提供的Plugin类，调用wrap()方法直接包装（创建代理类）</span></span><br><span class="line">        <span class="comment">//param1：被包装的目标对象，param2：用哪个拦截器包装（this即用当前拦截器包装）</span></span><br><span class="line">        Object wrap = Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;MyFirstPlugin...plugin()被包装的对象：&quot;</span> + target);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将插件注册时的property属性设置进来</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> properties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;插件的配置信息：&quot;</span> + properties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="插件签名">插件签名</h3>
<ul>
<li>插件签名即指明当前插件拦截<strong>四大对象的哪一个对象、哪一个方法</strong>（方法名和形参列表）</li>
<li>具体配置使用<code>@Intercepts</code>注解实现，该注解为<code>@Signature</code>注解的<strong>数组类型</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Signature &#123;</span><br><span class="line">  <span class="comment">//被拦截的四大对象的之一的Class对象</span></span><br><span class="line">  Class&lt;?&gt; type();</span><br><span class="line">  <span class="comment">//被拦截的方法名：指四大对象内置存在的方法(非自定义SQL映射接口的方法)</span></span><br><span class="line">  <span class="function">String <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="comment">//方法对应的形参列表的Class数组（防止重载）</span></span><br><span class="line">  Class&lt;?&gt;[] args();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>示例：配置拦截StatementHandler对象的<code>parameterize(Statement statement)</code>方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(</span></span><br><span class="line"><span class="meta">	&#123;</span></span><br><span class="line"><span class="meta">    	@Signature(type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">			method = &quot;parameterize&quot;,args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//省略上述插件开发代码....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="插件注册">插件注册</h3>
<ul>
<li>在mybatis全局配置文件中使用<code>&lt;plugins&gt;</code>标签注册自定义的插件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注册插件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 插件的全类名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.company.test.MyFirstPlugin&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 为使用的插件设置一些传入属性，可在插件内部setProperties()方法中被获取 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="测试结果">测试结果</h3>
<ul>
<li>注意以下测试结果配置时只拦截StatementHandler对象，即<strong>只有StatementHandler被包装</strong></li>
<li>而下述四大对象都打印了<code>&quot;将被包装的对象xxx&quot;</code>信息是由于<strong>plugin()方法无论何时都会被四大对象调用</strong></li>
<li>使用Mybatis提供的Plugin类的wrap()方法实现plugin()方法时，wrap()方法内部会根据当前插件签名定义的拦截对象创建对应的代理对象，<strong>没被插件签名定义的实际是没被包装的</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">插件的配置信息：&#123;password&#x3D;123, username&#x3D;root&#125;</span><br><span class="line">SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See http:&#x2F;&#x2F;www.slf4j.org&#x2F;codes.html#StaticLoggerBinder for further details.</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.executor.CachingExecutor@f6c48ac</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.scripting.defaults.DefaultParameterHandler@64bf3bbf</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.executor.resultset.DefaultResultSetHandler@10bdf5e5</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.executor.statement.RoutingStatementHandler@7e0b0338</span><br><span class="line">MyFirstPlugin...intercept()拦截的方法：public abstract void org.apache.ibatis.executor.statement.StatementHandler.parameterize(java.sql.Statement) throws java.sql.SQLException</span><br><span class="line">Employee&#123;id&#x3D;1, lastName&#x3D;&#39;Priscilla&#39;, gender&#x3D;&#39;女&#39;, email&#x3D;&#39;8888@qq.com&#39;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="多插件运行">多插件运行</h2>
<p>多个插件配置拦截同一对象同一方法时，会产生多重代理</p>
<ul>
<li>创建代理时，按插件配置顺序创建层层代理对象</li>
<li>执行目标时，拦截顺序按逆序执行（即先执行最大的代理对象，即最后包装的代理对象）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210824112951.png"
                      alt=""
                ></p>
<h2 id="插件开发流程">插件开发流程</h2>
<p>假如当前想通过插件，使查询id=1的员工SQL语句改变成查询id=5员工的SQL语句</p>
<ol>
<li>
<p><strong>确定四大对象</strong>：由于改变SQL参数，因此属于ParameterHandler负责的工作</p>
<blockquote>
<p>也可以选择拦截StatementHandler，因为它包含ParameterHandler</p>
</blockquote>
</li>
<li>
<p><strong>确定待操作方法及相关属性</strong>：在ParameterHandler中，负责参数设置的方法为<code>setParameters(PreparedStatement ps)</code>，其中<strong>parameterObject</strong>属性就是被设置的参数</p>
<blockquote>
<p>当前需求关键就是修改parameterObject属性</p>
</blockquote>
</li>
<li>
<p>通过确定包装的对象和拦截的方法<strong>编写插件签名</strong></p>
</li>
<li>
<p>实现插件内容，编写拦截逻辑</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.parameter.ParameterHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.SystemMetaObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-08-23 17:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Intercepts(</span></span><br><span class="line"><span class="meta">    &#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = ParameterHandler.class,method = &quot;setParameters&quot;,args = &#123;PreparedStatement.class&#125;)</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截器：用于拦截目标对象的目标方法执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> invocation</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标对象的目标方法执行后的结果（返回值）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 可通过调用Mybatis提供的SystemMetaObject.forObject()方法，传入拦截的四大对象之一</span></span><br><span class="line"><span class="comment">         * 创建MetaObject对象，该对象可以获取或修改传入的四大对象之一的所有属性</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Object target = invocation.getTarget();</span><br><span class="line">        MetaObject metaObject = SystemMetaObject.forObject(target);</span><br><span class="line">        <span class="comment">//通过调用getValue()方法，传入target对象的属性名，来获取其属性值</span></span><br><span class="line">        Object parameterObject = metaObject.getValue(<span class="string">&quot;parameterObject&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户传入的参数 = &quot;</span> + parameterObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过setValue()方法，修改指定target属性名的属性值，从而达到修改设置参数的效果</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;parameterObject&quot;</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注意，一切修改操作要在执行invocation.proceed()前才能生效</span></span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        Object wrap = Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;MyFirstPlugin...plugin()将要被包装的对象：&quot;</span> + target);</span><br><span class="line">        <span class="keyword">return</span> wrap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;插件的配置信息：&quot;</span> + properties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>输出效果：最终用户传入查询id=1，实际查询被插件修改成查询id=5的员工信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.executor.CachingExecutor@6eebc39e</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.scripting.defaults.DefaultParameterHandler@64bf3bbf</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.executor.resultset.DefaultResultSetHandler@10bdf5e5</span><br><span class="line">MyFirstPlugin...plugin()将要被包装的对象：org.apache.ibatis.executor.statement.RoutingStatementHandler@7e0b0338</span><br><span class="line">用户传入的参数 &#x3D; 1</span><br><span class="line">Employee&#123;id&#x3D;5, lastName&#x3D;&#39;Acer&#39;, gender&#x3D;&#39;男&#39;, email&#x3D;&#39;5551@qq.com&#39;&#125;</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<h2 id="PageHelper插件">PageHelper插件</h2>
<h3 id="简介-6">简介</h3>
<p>PageHelper是Mybatis的一款分页插件</p>
<ul>
<li>官方Github网址：<a class="link"   target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper" >https://github.com/pagehelper/Mybatis-PageHelper<i class="fas fa-external-link-alt"></i></a></li>
<li>使用文档：<a class="link"   target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md" >https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<h3 id="依赖下载-2">依赖下载</h3>
<ul>
<li>
<p>以下均基于<a class="link"   target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md" >官方使用文档<i class="fas fa-external-link-alt"></i></a>的<strong>其中一种操作实现</strong>，具体请查询官方文档</p>
</li>
<li>
<p>引入分页插件有下面2种方式，推荐使用 Maven 方式。</p>
</li>
</ul>
<h4 id="引入-Jar-包">引入 Jar 包</h4>
<p>你可以从下面的地址中下载最新版本的 jar 包</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://oss.sonatype.org/content/repositories/releases/com/github/pagehelper/pagehelper/" >https://oss.sonatype.org/content/repositories/releases/com/github/pagehelper/pagehelper/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/com/github/pagehelper/pagehelper/" >http://repo1.maven.org/maven2/com/github/pagehelper/pagehelper/<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>由于使用了sql 解析工具，你还需要下载 jsqlparser.jar(需要和PageHelper 依赖的版本一致) ：</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/com/github/jsqlparser/jsqlparser/" >http://repo1.maven.org/maven2/com/github/jsqlparser/jsqlparser/<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<h4 id="使用-Maven">使用 Maven</h4>
<p>在 pom.xml 中添加如下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>最新版本<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>最新版本号可以从首页查看。（当前文档使用，5.2.1）</p>
</blockquote>
<h3 id="注册插件">注册插件</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用下面的方式配置参数，后面会有所有的参数介绍 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;param1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="基础分页">基础分页</h3>
<ol>
<li>准备一个查询所有记录的接口方法（基于Mybatis）</li>
<li>在执行查询所有记录方法<strong>前</strong>调用分页插件的操作
<ol>
<li>调用PageHelper的静态方法startPage()，设置当前显示页码和每页显示的记录数</li>
<li>静态方法返回的Page对象可以获取更多分页相关的信息</li>
</ol>
</li>
<li>返回分页后的结果</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line"></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            EmployeeDao mapper = sqlSession.getMapper(EmployeeDao.class);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 在查询所有员工方法前操作：</span></span><br><span class="line"><span class="comment">             * 使用分页插件提供的PageHelper类的静态方法，param1=当前页码，param=每页的数量</span></span><br><span class="line"><span class="comment">             * 最终查询结果为分页后的结果</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">            List&lt;Employee&gt; employees = mapper.getEmployees();<span class="comment">//当前数据库总共10条记录</span></span><br><span class="line">            System.out.println(employees);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//返回的Page对象可以获取更多分页相关的信息</span></span><br><span class="line">            System.out.println(<span class="string">&quot;总记录数：&quot;</span> + page.getTotal());</span><br><span class="line">            System.out.println(<span class="string">&quot;当前页码：&quot;</span> + page.getPageNum());</span><br><span class="line">            System.out.println(<span class="string">&quot;每页的记录数：&quot;</span> + page.getPageSize());</span><br><span class="line">            System.out.println(<span class="string">&quot;总页码：&quot;</span> + page.getPages());</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PageInfo">PageInfo</h3>
<h4 id="基本使用">基本使用</h4>
<ol>
<li>在上述使用PageHelper实现的&quot;基础分页&quot;基础上，把分页后的结果作为PageInfo构造器实例化</li>
<li>PageInfo对象能获取比Page更详细的分页信息，如首页、尾页、是否存在下一页等等（详情看官方文档）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line"></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            EmployeeDao mapper = sqlSession.getMapper(EmployeeDao.class);</span><br><span class="line"></span><br><span class="line">            Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">            List&lt;Employee&gt; employees = mapper.getEmployees();<span class="comment">//当前数据库总共10条记录</span></span><br><span class="line">            System.out.println(employees);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将分页后的结果作为构造啊实参传入实例化PageInfo</span></span><br><span class="line">            PageInfo&lt;Employee&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(employees);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//PageInfo能获取Page能分页信息基础上，还封装了更为详细的分页信息</span></span><br><span class="line">            System.out.println(<span class="string">&quot;下一页页码：&quot;</span> + pageInfo.getNextPage());</span><br><span class="line">            System.out.println(<span class="string">&quot;是否存在下一页：&quot;</span> + pageInfo.isHasNextPage());</span><br><span class="line">            System.out.println(<span class="string">&quot;......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="分页导航">分页导航</h4>
<p>PageInfo除了基于Page封装的分页信息基础上，还能够获取更多信息外。还具备获取分页导航栏信息功能。省去了分页导航栏计算的麻烦</p>
<ol>
<li>
<p>在实例化PageInfo时，除了传入分页后的结果集外，还<strong>设置要显示分页导航栏的长度</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;Employee&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(employees,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>获取当前分页情况的分页导航栏页码列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] nums = pageInfo.getNavigatepageNums();</span><br><span class="line">System.out.println(Arrays.toString(nums));  <span class="comment">//[1, 2, 3]</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="其他">其他</h1>
<h2 id="Mybatis批量操作">Mybatis批量操作</h2>
<h3 id="背景">背景</h3>
<ul>
<li>使用动态SQL编写的批量操作实际并非真正的SQL批量操作，只是连续执行多条SQL语句或执行一条拼凑出来的很长的SQL语句</li>
<li>其中可以通过settings设置项中的<strong>defaultExcutorType</strong>把处理器类型设置称为<strong>BATCH</strong>来实现批量执行SQL语句。该方式会将所有项目中所有SQL语句执行都设置为批量方式执行，**因此不建议 ! **</li>
<li>Mybatis提供一种方式，可以只在某个SqlSession中启用批量执行SQL语句，<strong>建议使用这种方式！</strong></li>
</ul>
<h3 id="SqlSession批量执行">SqlSession批量执行</h3>
<ul>
<li>在调用openSession时，通过设置执行器类型，创建可执行批量操作的sqlSession</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//在调用openSession时，通过设置执行器类型，创建可执行批量操作的sqlSession</span></span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            mapper.addEmp(<span class="keyword">new</span> Employee(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>), <span class="string">&quot;b&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//提交操作</span></span><br><span class="line">        openSession.commit();</span><br><span class="line">        <span class="comment">//批量：（预编译sql一次==&gt;设置参数===&gt;10000次===&gt;执行（1次））</span></span><br><span class="line">        <span class="comment">//非批量：（预编译sql=设置参数=执行）==》10000</span></span><br><span class="line">        <span class="comment">//批量方式在10000条SQL语句执行插入时，比非批量快接近3倍</span></span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spring整合中配置批量执行">Spring整合中配置批量执行</h3>
<ul>
<li>在Spring的配置文件中配置一个可以进行批量执行的sqlSession</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--整合Mybatis：配置SqlSessionFactory对象  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis/mapper/*.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置一个可以进行批量执行的sqlSession，自定义命名为sqlSessionOfBatch  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionOfBatch&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Mybatis调用存储过程（待补充）">Mybatis调用存储过程（待补充）</h2>
<p>以Oracle实现分页操作来介绍Mybatis中如何使用存储过程</p>
<h3 id="Oracle分页原理">Oracle分页原理</h3>
<p>Oracle中不能像Mysql中使用的<code>limt</code>就可以完成分页</p>
<ul>
<li>Oracle是通过rownum，行号完成分页，即每条数据都有自己的行号</li>
<li>1~5条数据作为一页的分页查询就是查询 <code>1≤ 行号 ≤ 5</code></li>
<li>而实际操作过程中，不能直接查询大于等于1，小于等于5的行号的数据，因为数据在不断变化</li>
<li>必须分成两步进行查询，通过一个子查询先查出行号小于等于5号的数据集（静态存储），然后再查询行号大于等于1的数据集</li>
</ul>
<h3 id="调用过程">调用过程</h3>
<p>略…待补充</p>
<h2 id="自定义类型处理器">自定义类型处理器</h2>
<h3 id="背景-2">背景</h3>
<ul>
<li>
<p>Mybatis的类型处理器（TypeHandler）是四大对象之一，主要用于为数据库、后端编程语言的数据类型间搭建转换的桥梁。</p>
</li>
<li>
<p><strong>TypeHandler是一个接口</strong>，某一个Java类型对应数据库某个类型的映射关系<strong>由一个实现类完成</strong></p>
<ul>
<li>如Java中的Long类型对应数据库类型的定义和转换由<strong>LongTypeHandler</strong>负责</li>
</ul>
<hr>
</li>
<li>
<p>通常情况下很少需要自定义Mybatis的类型处理器</p>
</li>
<li>
<p>由于Mybatis目前提供的Java枚举类型处理器不能满足目前开发的要求</p>
</li>
<li>
<p>因此一般需要自定义类型处理器为<strong>Java的枚举类型</strong></p>
</li>
</ul>
<h3 id="枚举类型处理器">枚举类型处理器</h3>
<h4 id="默认类型处理器">默认类型处理器</h4>
<p>Mybatis对于Java的枚举类型默认提供了两个类型处理器</p>
<ul>
<li>
<p><strong>EnumTypeHandler</strong>（默认）：使用枚举的name属性（String）存储到数据库的String类型字段中</p>
<blockquote>
<p>Java中，若枚举类型没有显式定义name属性，则默认为枚举对象名</p>
</blockquote>
</li>
<li>
<p><strong>EnumOrdinalTypeHandler</strong>：使用枚举对象默认的索引值（Integer）存储到数据库的int类型字段中</p>
</li>
</ul>
<h4 id="更换类型处理器">更换类型处理器</h4>
<ul>
<li>在全局配置文件中，使用<code>&lt;typeHandler&gt;</code>标签为某种具体Java类型配置类型处理器
<ul>
<li><strong>handler</strong>属性：更换的类型处理器全类名</li>
<li><strong>javaType</strong>属性：被该类型处理器处理的Java类型全类名</li>
</ul>
</li>
<li>以下为将某个自定义的枚举类型使用官方提供的另一个枚举类型处理器（以枚举索引方式存储到数据库）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.EnumOrdinalTypeHandler&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.company.mybatis.bean.EmpStatus&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="枚举处理器不足">枚举处理器不足</h4>
<ul>
<li>目前Mybatis官方提供的处理枚举类型的类型处理器不能满足实际开发需要</li>
<li>通常情况下不适用枚举name属性，也不适用枚举默认索引，而是一般将枚举这种状态类型参数通过一个表示该状态的<strong>状态码表示并存储</strong>，如HTTP的状态码，404，表示&quot;找不到目标资源&quot;</li>
<li>目的的枚举类型结构如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.mybatis.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.generic.RETURN;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 希望数据库保存的是100,200这些状态码，而不是默认0,1或者枚举的Name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EmpStatus &#123;</span><br><span class="line">	LOGIN(<span class="number">100</span>,<span class="string">&quot;用户登录&quot;</span>),LOGOUT(<span class="number">200</span>,<span class="string">&quot;用户登出&quot;</span>),REMOVE(<span class="number">300</span>,<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">EmpStatus</span><span class="params">(Integer code,String msg)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">		<span class="keyword">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> code;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> msg;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//按照状态码返回枚举对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EmpStatus <span class="title">getEmpStatusByCode</span><span class="params">(Integer code)</span></span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (code) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGIN;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGOUT;	</span><br><span class="line">			<span class="keyword">case</span> <span class="number">300</span>:</span><br><span class="line">				<span class="keyword">return</span> REMOVE;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGOUT;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义枚举处理器">自定义枚举处理器</h3>
<ol>
<li>实现TypeHandler接口，或基础BaseTypeHandler</li>
<li>在全局配置文件中，使用<code>&lt;typeHandler&gt;</code>标签为某种具体Java类型配置类型处理器</li>
</ol>
<h4 id="实现枚举处理器">实现枚举处理器</h4>
<p>实现TypeHandler接口，或基础BaseTypeHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.mybatis.typehandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.CallableStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.TypeHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.company.mybatis.bean.EmpStatus;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义枚举类型处理器：枚举类型对象（java） &lt;——&gt; 状态码 (database)</span></span><br><span class="line"><span class="comment"> * 实现TypeHandler&lt;E&gt;接口：泛型E为需要处理的Java类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEnumEmpStatusTypeHandler</span> <span class="keyword">implements</span> <span class="title">TypeHandler</span>&lt;<span class="title">EmpStatus</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Java的EmpStatus枚举数据——&gt;数据库</span></span><br><span class="line"><span class="comment">	 * - 将EmpStatus枚举类的状态码，以String方式（setString()）存储到数据库中</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, EmpStatus parameter,</span></span></span><br><span class="line"><span class="function"><span class="params">			JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">&quot;要保存的状态码：&quot;</span>+parameter.getCode());</span><br><span class="line">		</span><br><span class="line">		ps.setString(i, parameter.getCode().toString());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 数据库枚举数据——&gt;Java（1 - 通过字段名方式获取）</span></span><br><span class="line"><span class="comment">	 * - 根据从数据库中拿到的枚举的状态码返回一个枚举对象</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * ResultSet rs：查询一条完整数据的结果集</span></span><br><span class="line"><span class="comment">	 * String columnName：当前要处理的数据库类型的字段名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> EmpStatus <span class="title">getResult</span><span class="params">(ResultSet rs, String columnName)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//可以通过传入字段名在结果集中获取当前字段值</span></span><br><span class="line">		<span class="keyword">int</span> code = rs.getInt(columnName);</span><br><span class="line">		System.out.println(<span class="string">&quot;从数据库中获取的状态码：&quot;</span>+code);</span><br><span class="line">		EmpStatus status = EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 数据库枚举数据——&gt;Java（2 - 通过数据库字段索引方式获取）</span></span><br><span class="line"><span class="comment">	 * - 代码结构类似</span></span><br><span class="line"><span class="comment">	 */</span>	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> EmpStatus <span class="title">getResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">int</span> code = rs.getInt(columnIndex);</span><br><span class="line">		System.out.println(<span class="string">&quot;从数据库中获取的状态码：&quot;</span>+code);</span><br><span class="line">		EmpStatus status = EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 数据库枚举数据——&gt;Java（3 - 从存储过程中通过数据库字段索引方式获取）</span></span><br><span class="line"><span class="comment">	 * - 代码结构类似</span></span><br><span class="line"><span class="comment">	 */</span>	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> EmpStatus <span class="title">getResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">int</span> code = cs.getInt(columnIndex);</span><br><span class="line">		System.out.println(<span class="string">&quot;从数据库中获取的状态码：&quot;</span>+code);</span><br><span class="line">		EmpStatus status = EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注册自定义枚举处理器">注册自定义枚举处理器</h4>
<p>在全局配置文件中，使用<code>&lt;typeHandler&gt;</code>标签为某种具体Java类型配置类型处理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1、配置我们自定义的TypeHandler  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.company.mybatis.typehandler.MyEnumEmpStatusTypeHandler&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.company.mybatis.bean.EmpStatus&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2、也可以在处理某个字段的时候告诉MyBatis用什么类型处理器</span></span><br><span class="line"><span class="comment">    保存：#&#123;empStatus,typeHandler=xxxx&#125;</span></span><br><span class="line"><span class="comment">    查询：</span></span><br><span class="line"><span class="comment">     &lt;resultMap type=&quot;com.company.mybatis.bean.Employee&quot; id=&quot;MyEmp&quot;&gt;</span></span><br><span class="line"><span class="comment">       &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;</span></span><br><span class="line"><span class="comment">       &lt;result column=&quot;empStatus&quot; property=&quot;empStatus&quot; typeHandler=&quot;&quot;/&gt;</span></span><br><span class="line"><span class="comment">      &lt;/resultMap&gt;</span></span><br><span class="line"><span class="comment">    注意：如果在参数位置修改TypeHandler，应该保证保存数据和查询数据用的TypeHandler是一样的。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：Mybatis3</li>
        <li>Post author：yhd</li>
        <li>Create time：2021-08-24 18:28:47</li>
        <li>
            Post link：https://keep.xpoet.cn/2021/08/24/Mybatis3/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/08/11/SpringMVC5/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">SpringMVC5</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">yhd</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Mybatis%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">Mybatis概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E5%8E%86%E5%8F%B2"><span class="nav-number">1.1.</span> <span class="nav-text">背景历史</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">1.2.</span> <span class="nav-text">Mybatis的优势</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94"><span class="nav-number">1.2.1.</span> <span class="nav-text">相关工具对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hibernate"><span class="nav-number">1.2.2.</span> <span class="nav-text">Hibernate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis"><span class="nav-number">1.3.</span> <span class="nav-text">Mybatis</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mybatis%E4%B8%8B%E8%BD%BD"><span class="nav-number">2.</span> <span class="nav-text">Mybatis下载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%AD%A5%E9%AA%A4"><span class="nav-number">2.1.</span> <span class="nav-text">下载步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%B5%84%E6%96%99%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.2.</span> <span class="nav-text">基本资料介绍</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HelloWorld"><span class="nav-number">3.</span> <span class="nav-text">HelloWorld</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">3.1.</span> <span class="nav-text">快速开始</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">3.2.</span> <span class="nav-text">接口式编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="nav-number">3.2.1.</span> <span class="nav-text">操作步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF"><span class="nav-number">3.2.2.</span> <span class="nav-text">优势</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">3.3.</span> <span class="nav-text">小结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%94%9F%E6%AF%94%E8%BE%83"><span class="nav-number">3.3.1.</span> <span class="nav-text">原生比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SqlSession"><span class="nav-number">3.3.2.</span> <span class="nav-text">SqlSession</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.3.3.</span> <span class="nav-text">代理对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.3.4.</span> <span class="nav-text">配置文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%87%E7%AD%BE"><span class="nav-number">4.</span> <span class="nav-text">配置文件标签</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E4%B9%A6%E5%86%99%E6%8F%90%E7%A4%BA%E6%A3%80%E6%9F%A5"><span class="nav-number">4.1.</span> <span class="nav-text">标签书写提示检查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E7%BC%96%E5%86%99%E9%A1%BA%E5%BA%8F"><span class="nav-number">4.2.</span> <span class="nav-text">标签编写顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#properties"><span class="nav-number">4.3.</span> <span class="nav-text">properties</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">4.3.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.3.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#settings"><span class="nav-number">4.4.</span> <span class="nav-text">settings</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E-2"><span class="nav-number">4.4.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="nav-number">4.4.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#typeAliases"><span class="nav-number">4.5.</span> <span class="nav-text">typeAliases</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%88%AB%E5%90%8D"><span class="nav-number">4.5.1.</span> <span class="nav-text">自定义类别名</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E-3"><span class="nav-number">4.5.1.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="nav-number">4.5.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%88%AB%E5%90%8D"><span class="nav-number">4.5.2.</span> <span class="nav-text">默认别名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#typeHandlers"><span class="nav-number">4.6.</span> <span class="nav-text">typeHandlers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugins"><span class="nav-number">4.7.</span> <span class="nav-text">plugins</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#environments"><span class="nav-number">4.8.</span> <span class="nav-text">environments</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E-4"><span class="nav-number">4.8.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-4"><span class="nav-number">4.8.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#databaseldProvider"><span class="nav-number">4.9.</span> <span class="nav-text">databaseldProvider</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E-5"><span class="nav-number">4.9.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-5"><span class="nav-number">4.9.2.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E6%BA%90%E5%87%86%E5%A4%87"><span class="nav-number">4.9.2.1.</span> <span class="nav-text">不同数据源准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E5%B9%B6%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%82%E5%95%86%E6%A0%87%E8%AF%86%E8%B5%B7%E5%88%AB%E5%90%8D"><span class="nav-number">4.9.2.2.</span> <span class="nav-text">启用并为数据库厂商标识起别名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E6%98%8Esql%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E5%8E%82%E5%95%86"><span class="nav-number">4.9.2.3.</span> <span class="nav-text">指明sql语句的执行厂商</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mappers"><span class="nav-number">4.10.</span> <span class="nav-text">mappers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E6%B3%A8%E5%86%8C%E6%96%B9%E5%BC%8F"><span class="nav-number">4.10.1.</span> <span class="nav-text">普通注册方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%B3%A8%E5%86%8C%E6%96%B9%E5%BC%8F"><span class="nav-number">4.10.2.</span> <span class="nav-text">批量注册方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#objectFactory"><span class="nav-number">4.11.</span> <span class="nav-text">objectFactory</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E6%A0%87%E7%AD%BE"><span class="nav-number">5.</span> <span class="nav-text">映射文件标签</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CRUD%E5%9F%BA%E7%A1%80"><span class="nav-number">5.1.</span> <span class="nav-text">CRUD基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CRUD%E6%A0%87%E7%AD%BE"><span class="nav-number">5.1.1.</span> <span class="nav-text">CRUD标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="nav-number">5.1.2.</span> <span class="nav-text">传入参数设置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BC%A0%E5%85%A5"><span class="nav-number">5.1.2.1.</span> <span class="nav-text">单个参数传入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BC%A0%E5%85%A5"><span class="nav-number">5.1.2.2.</span> <span class="nav-text">多个参数传入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%A1%8C%E4%B8%BA"><span class="nav-number">5.1.2.2.1.</span> <span class="nav-text">默认行为</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Param"><span class="nav-number">5.1.2.2.2.</span> <span class="nav-text">@Param</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%A0%E5%85%A5Map"><span class="nav-number">5.1.2.2.3.</span> <span class="nav-text">传入Map</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%B0%81%E8%A3%85TO"><span class="nav-number">5.1.2.2.4.</span> <span class="nav-text">自封装TO</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E4%BC%A0%E5%85%A5%E5%9C%BA%E6%99%AF"><span class="nav-number">5.1.2.3.</span> <span class="nav-text">特殊传入场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E5%85%A5%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">5.1.2.4.</span> <span class="nav-text">传入源码分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96"><span class="nav-number">5.1.3.</span> <span class="nav-text">传入参数获取</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F"><span class="nav-number">5.1.3.1.</span> <span class="nav-text">#{}方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F-2"><span class="nav-number">5.1.3.2.</span> <span class="nav-text">${}方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%B1%E5%93%8D%E6%9D%A1%E6%95%B0%E8%BF%94%E5%9B%9E"><span class="nav-number">5.1.4.</span> <span class="nav-text">影响条数返回</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE"><span class="nav-number">5.1.5.</span> <span class="nav-text">获取自增主键</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mysql"><span class="nav-number">5.1.5.1.</span> <span class="nav-text">Mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="nav-number">5.1.5.2.</span> <span class="nav-text">Oracle（了解）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CRUD%E5%9F%BA%E7%A1%80%E7%A4%BA%E4%BE%8B"><span class="nav-number">5.1.6.</span> <span class="nav-text">CRUD基础示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DAO%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.1.6.1.</span> <span class="nav-text">DAO接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CRUD%E9%85%8D%E7%BD%AE"><span class="nav-number">5.1.6.2.</span> <span class="nav-text">CRUD配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">5.1.6.3.</span> <span class="nav-text">测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select%E8%AF%A6%E8%A7%A3"><span class="nav-number">5.2.</span> <span class="nav-text">select详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.2.1.</span> <span class="nav-text">返回类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">对象类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.2.1.2.</span> <span class="nav-text">集合类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.2.1.3.</span> <span class="nav-text">Map类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">5.2.1.3.1.</span> <span class="nav-text">返回一条记录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%A4%9A%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">5.2.1.3.2.</span> <span class="nav-text">返回多条记录</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#resultMap%E5%B1%9E%E6%80%A7"><span class="nav-number">5.3.</span> <span class="nav-text">resultMap属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">5.3.1.</span> <span class="nav-text">引言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84"><span class="nav-number">5.3.1.1.</span> <span class="nav-text">自动映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E6%98%A0%E5%B0%84"><span class="nav-number">5.3.1.2.</span> <span class="nav-text">手动映射</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="nav-number">5.3.2.</span> <span class="nav-text">定义映射规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.3.3.</span> <span class="nav-text">关联查询对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E5%9C%BA%E6%99%AF"><span class="nav-number">5.3.3.1.</span> <span class="nav-text">需求场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7%E6%96%B9%E5%BC%8F"><span class="nav-number">5.3.3.2.</span> <span class="nav-text">级联属性方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5"><span class="nav-number">5.3.3.2.1.</span> <span class="nav-text">查询所有字段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="nav-number">5.3.3.2.2.</span> <span class="nav-text">映射规则</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E5%AF%B9%E8%B1%A1%E6%96%B9%E5%BC%8F"><span class="nav-number">5.3.3.3.</span> <span class="nav-text">嵌套对象方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5-2"><span class="nav-number">5.3.3.3.1.</span> <span class="nav-text">查询所有字段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99-2"><span class="nav-number">5.3.3.3.2.</span> <span class="nav-text">映射规则</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F"><span class="nav-number">5.3.3.4.</span> <span class="nav-text">分步查询方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E6%96%B9%E5%BC%8F"><span class="nav-number">5.3.3.4.1.</span> <span class="nav-text">普通方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#sql%E8%AF%AD%E5%8F%A5"><span class="nav-number">5.3.3.4.1.1.</span> <span class="nav-text">sql语句</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99-3"><span class="nav-number">5.3.3.4.1.2.</span> <span class="nav-text">映射规则</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="nav-number">5.3.3.4.2.</span> <span class="nav-text">延迟加载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E9%9B%86%E5%90%88"><span class="nav-number">5.3.4.</span> <span class="nav-text">关联查询集合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E5%9C%BA%E6%99%AF-2"><span class="nav-number">5.3.4.1.</span> <span class="nav-text">需求场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E9%9B%86%E5%90%88%E6%96%B9%E5%BC%8F"><span class="nav-number">5.3.4.2.</span> <span class="nav-text">嵌套集合方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5-3"><span class="nav-number">5.3.4.2.1.</span> <span class="nav-text">查询所有字段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99-4"><span class="nav-number">5.3.4.2.2.</span> <span class="nav-text">映射规则</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F-2"><span class="nav-number">5.3.4.3.</span> <span class="nav-text">分步查询方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#sql%E8%AF%AD%E5%8F%A5-2"><span class="nav-number">5.3.4.3.1.</span> <span class="nav-text">sql语句</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99-5"><span class="nav-number">5.3.4.3.2.</span> <span class="nav-text">映射规则</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7%E4%BD%BF%E7%94%A8"><span class="nav-number">5.3.5.</span> <span class="nav-text">扩展属性使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E4%BC%A0%E5%85%A5column"><span class="nav-number">5.3.5.1.</span> <span class="nav-text">多个传入column</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fetchType%E5%B1%9E%E6%80%A7"><span class="nav-number">5.3.5.2.</span> <span class="nav-text">fetchType属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%89%B4%E5%88%AB%E5%99%A8"><span class="nav-number">5.3.6.</span> <span class="nav-text">鉴别器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">5.3.6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-6"><span class="nav-number">5.3.6.2.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E6%80%81SQL"><span class="nav-number">6.</span> <span class="nav-text">动态SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="nav-number">6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">6.2.</span> <span class="nav-text">OGNL表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-3"><span class="nav-number">6.2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-number">6.2.2.</span> <span class="nav-text">基础语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#if%E6%A0%87%E7%AD%BE"><span class="nav-number">6.3.</span> <span class="nav-text">if标签</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="nav-number">6.3.1.</span> <span class="nav-text">语法格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-7"><span class="nav-number">6.3.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#where%E6%A0%87%E7%AD%BE"><span class="nav-number">6.4.</span> <span class="nav-text">where标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#trim%E6%A0%87%E7%AD%BE"><span class="nav-number">6.5.</span> <span class="nav-text">trim标签</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="nav-number">6.5.1.</span> <span class="nav-text">基本功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">6.5.2.</span> <span class="nav-text">使用方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#choose%E6%A0%87%E7%AD%BE"><span class="nav-number">6.6.</span> <span class="nav-text">choose标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#set%E6%A0%87%E7%AD%BE"><span class="nav-number">6.7.</span> <span class="nav-text">set标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#foreach%E6%A0%87%E7%AD%BE"><span class="nav-number">6.8.</span> <span class="nav-text">foreach标签</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-number">6.8.1.</span> <span class="nav-text">基本说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.8.2.</span> <span class="nav-text">批量查询示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95"><span class="nav-number">6.8.2.1.</span> <span class="nav-text">接口方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99-6"><span class="nav-number">6.8.2.2.</span> <span class="nav-text">映射规则</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E4%BF%9D%E5%AD%98%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.8.3.</span> <span class="nav-text">批量保存示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E6%8B%AC%E5%8F%B7%E6%96%B9%E5%BC%8F"><span class="nav-number">6.8.3.1.</span> <span class="nav-text">多括号方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9Asql%E8%AF%AD%E5%8F%A5%E6%96%B9%E5%BC%8F"><span class="nav-number">6.8.3.2.</span> <span class="nav-text">多sql语句方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bind%E6%A0%87%E7%AD%BE"><span class="nav-number">6.9.</span> <span class="nav-text">bind标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="nav-number">6.10.</span> <span class="nav-text">内置参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-8"><span class="nav-number">6.10.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql%E6%A0%87%E7%AD%BE"><span class="nav-number">6.11.</span> <span class="nav-text">sql标签</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="nav-number">7.</span> <span class="nav-text">缓存机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-4"><span class="nav-number">7.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-number">7.2.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%93%E9%AA%8C"><span class="nav-number">7.2.1.</span> <span class="nav-text">一级缓存体验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5"><span class="nav-number">7.2.2.</span> <span class="nav-text">缓存失效情况</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-number">7.3.</span> <span class="nav-text">二级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">7.3.1.</span> <span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-number">7.3.2.</span> <span class="nav-text">开启二级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setting%E9%85%8D%E7%BD%AE"><span class="nav-number">7.3.2.1.</span> <span class="nav-text">setting配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-number">7.3.2.2.</span> <span class="nav-text">配置二级缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POJO%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">7.3.2.3.</span> <span class="nav-text">POJO实现序列化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E6%B5%8B%E8%AF%95"><span class="nav-number">7.3.3.</span> <span class="nav-text">二级缓存测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%97%A5%E5%BF%97"><span class="nav-number">7.3.3.1.</span> <span class="nav-text">导入日志</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5log4j"><span class="nav-number">7.3.3.1.1.</span> <span class="nav-text">导入log4j</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-2"><span class="nav-number">7.3.3.1.2.</span> <span class="nav-text">配置文件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%B5%8B%E8%AF%95"><span class="nav-number">7.3.3.2.</span> <span class="nav-text">缓存测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E7%9B%B8%E5%85%B3%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="nav-number">7.3.4.</span> <span class="nav-text">缓存相关其他属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CRUD%E7%9B%B8%E5%85%B3"><span class="nav-number">7.3.4.1.</span> <span class="nav-text">CRUD相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#settings%E7%9B%B8%E5%85%B3"><span class="nav-number">7.3.4.2.</span> <span class="nav-text">settings相关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%93%E5%AD%98%E6%95%B4%E5%90%88"><span class="nav-number">7.4.</span> <span class="nav-text">第三方缓存整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5ehcache%E6%A0%B8%E5%BF%83%E5%8C%85"><span class="nav-number">7.4.1.</span> <span class="nav-text">导入ehcache核心包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDehcache%E9%80%82%E9%85%8D%E5%8C%85"><span class="nav-number">7.4.2.</span> <span class="nav-text">下载ehcache适配包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E5%85%A5ehcache-xml"><span class="nav-number">7.4.3.</span> <span class="nav-text">引入ehcache.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%93%E5%AD%98"><span class="nav-number">7.4.4.</span> <span class="nav-text">配置第三方缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86"><span class="nav-number">7.5.</span> <span class="nav-text">Mybatis缓存原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSM%E6%95%B4%E5%90%88%E5%9F%BA%E7%A1%80"><span class="nav-number">8.</span> <span class="nav-text">SSM整合基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis-Spring%E4%B8%8B%E8%BD%BD"><span class="nav-number">8.1.</span> <span class="nav-text">Mybatis-Spring下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="nav-number">8.2.</span> <span class="nav-text">配置文件编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#web-xml"><span class="nav-number">8.2.1.</span> <span class="nav-text">web.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringMVC"><span class="nav-number">8.2.2.</span> <span class="nav-text">SpringMVC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring"><span class="nav-number">8.2.3.</span> <span class="nav-text">Spring</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="nav-number">9.</span> <span class="nav-text">逆向工程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">9.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E4%B8%8B%E8%BD%BD"><span class="nav-number">9.2.</span> <span class="nav-text">依赖下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mbg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.</span> <span class="nav-text">mbg配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="nav-number">9.4.</span> <span class="nav-text">生成逆向工程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">10.</span> <span class="nav-text">工作原理与源码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="nav-number">10.1.</span> <span class="nav-text">分层架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E6%AD%A5%E9%AA%A4"><span class="nav-number">10.2.</span> <span class="nav-text">关键步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BASqlSessionFactory"><span class="nav-number">10.3.</span> <span class="nav-text">创建SqlSessionFactory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BASqlSession%E5%AF%B9%E8%B1%A1"><span class="nav-number">10.4.</span> <span class="nav-text">创建SqlSession对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1"><span class="nav-number">10.5.</span> <span class="nav-text">创建接口的代理对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E6%89%A7%E8%A1%8CCRUD"><span class="nav-number">10.6.</span> <span class="nav-text">代理对象执行CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93"><span class="nav-number">10.6.1.</span> <span class="nav-text">执行流程总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E5%BA%8F%E5%9B%BE%EF%BC%88%E5%8F%82%E8%80%83%EF%BC%89"><span class="nav-number">10.6.2.</span> <span class="nav-text">时序图（参考）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">10.7.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="nav-number">11.</span> <span class="nav-text">插件开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-5"><span class="nav-number">11.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="nav-number">11.2.</span> <span class="nav-text">插件运行原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HelloWord"><span class="nav-number">11.3.</span> <span class="nav-text">HelloWord</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99"><span class="nav-number">11.3.1.</span> <span class="nav-text">插件编写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E7%AD%BE%E5%90%8D"><span class="nav-number">11.3.2.</span> <span class="nav-text">插件签名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E6%B3%A8%E5%86%8C"><span class="nav-number">11.3.3.</span> <span class="nav-text">插件注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="nav-number">11.3.4.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E6%8F%92%E4%BB%B6%E8%BF%90%E8%A1%8C"><span class="nav-number">11.4.</span> <span class="nav-text">多插件运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="nav-number">11.5.</span> <span class="nav-text">插件开发流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PageHelper%E6%8F%92%E4%BB%B6"><span class="nav-number">11.6.</span> <span class="nav-text">PageHelper插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-6"><span class="nav-number">11.6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E4%B8%8B%E8%BD%BD-2"><span class="nav-number">11.6.2.</span> <span class="nav-text">依赖下载</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5-Jar-%E5%8C%85"><span class="nav-number">11.6.2.1.</span> <span class="nav-text">引入 Jar 包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Maven"><span class="nav-number">11.6.2.2.</span> <span class="nav-text">使用 Maven</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E6%8F%92%E4%BB%B6"><span class="nav-number">11.6.3.</span> <span class="nav-text">注册插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%88%86%E9%A1%B5"><span class="nav-number">11.6.4.</span> <span class="nav-text">基础分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PageInfo"><span class="nav-number">11.6.5.</span> <span class="nav-text">PageInfo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">11.6.5.1.</span> <span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E5%AF%BC%E8%88%AA"><span class="nav-number">11.6.5.2.</span> <span class="nav-text">分页导航</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">12.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="nav-number">12.1.</span> <span class="nav-text">Mybatis批量操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">12.1.1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SqlSession%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C"><span class="nav-number">12.1.2.</span> <span class="nav-text">SqlSession批量执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring%E6%95%B4%E5%90%88%E4%B8%AD%E9%85%8D%E7%BD%AE%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C"><span class="nav-number">12.1.3.</span> <span class="nav-text">Spring整合中配置批量执行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%88%E5%BE%85%E8%A1%A5%E5%85%85%EF%BC%89"><span class="nav-number">12.2.</span> <span class="nav-text">Mybatis调用存储过程（待补充）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Oracle%E5%88%86%E9%A1%B5%E5%8E%9F%E7%90%86"><span class="nav-number">12.2.1.</span> <span class="nav-text">Oracle分页原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">12.2.2.</span> <span class="nav-text">调用过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.</span> <span class="nav-text">自定义类型处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%8C%E6%99%AF-2"><span class="nav-number">12.3.1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.2.</span> <span class="nav-text">枚举类型处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.2.1.</span> <span class="nav-text">默认类型处理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%8D%A2%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.2.2.</span> <span class="nav-text">更换类型处理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8%E4%B8%8D%E8%B6%B3"><span class="nav-number">12.3.2.3.</span> <span class="nav-text">枚举处理器不足</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.3.</span> <span class="nav-text">自定义枚举处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.3.1.</span> <span class="nav-text">实现枚举处理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">12.3.3.2.</span> <span class="nav-text">注册自定义枚举处理器</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
