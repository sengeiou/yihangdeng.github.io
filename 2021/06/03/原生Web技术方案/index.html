<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="yhd">
    
    <title>
        
            原生Web技术方案 |
        
        DyhBlog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/MyLogo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"yoursite.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/MyLogo.svg","article_img_align":"left","left_side_width":"230px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.jpeg"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.1"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.1.1"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                DyhBlog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">原生Web技术方案</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">yhd</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-06-03 10:31:32
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/JavaWeb/">JavaWeb</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/MVC/">MVC</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>33.6k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>146 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p><strong>引言</strong>：原生Web技术方案涵盖了MVC设计模式、数据域使用、表单重复提交、分页技术、验证码、权限管理、事务管理、常见电商web功能模块、前后端分离技术、i18n国际化技术等。在于原生实现思路的体现，实现的代码部分可能存在bug，请注意。</p>
<h1 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h1><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>MVC 模式代表 Model-View-Controller（模型-视图-控制器） 模式。这种模式用于应用程序的分层开发。</p>
<ul>
<li><strong>Model（模型）</strong> ：代表一个存取数据的对象或 JAVA POJO。它也可以带有逻辑，在数据变化时更新控制器。</li>
<li><strong>View（视图）</strong> ：代表模型包含的数据的可视化。</li>
<li><strong>Controller（控制器）</strong> - 控制器作用于模型和视图上。它控制数据流向模型对象，并在数据变化时更新视图。它使视图与模型分离开。</li>
</ul>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/tianruo_2021-4-11-637537320155974751.jpg"
                      style="zoom:130%;" /
                >

<h2 id="包命名规范"><a href="#包命名规范" class="headerlink" title="包命名规范"></a>包命名规范</h2><table>
<thead>
<tr>
<th>层次</th>
<th>包名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>实体bean对象</td>
<td>com.website.pojo/entity/domain.bean</td>
<td>JavaBean类</td>
</tr>
<tr>
<td>dao持久层</td>
<td>com.website.dao</td>
<td>Dao接口</td>
</tr>
<tr>
<td></td>
<td>com.website.dao.impl</td>
<td>Dao接口实现类</td>
</tr>
<tr>
<td>web层</td>
<td>com.website.web/servlet/controller</td>
<td>视图控制层</td>
</tr>
<tr>
<td>service层</td>
<td>com.website.service</td>
<td>service接口包</td>
</tr>
<tr>
<td></td>
<td>com.website.service.impl</td>
<td>service接口实现类</td>
</tr>
<tr>
<td>测试包</td>
<td>com.website.test/junit</td>
<td>测试类</td>
</tr>
<tr>
<td>工具类</td>
<td>com.website.utils</td>
<td>工具类</td>
</tr>
</tbody></table>
<h2 id="后端编码流程"><a href="#后端编码流程" class="headerlink" title="后端编码流程"></a>后端编码流程</h2><p>tips：这里指编码流程阶段，指后端程序员工作角度，非整个软件的开发流程(需求分析等等)。</p>
<ol>
<li><strong>建库建表</strong></li>
<li><strong>编写JavaBean</strong></li>
<li><strong>后续准备测试类</strong></li>
<li><strong>编写DAO</strong></li>
<li><strong>业务service</strong></li>
<li><strong>视图控制层</strong></li>
</ol>
<h3 id="建库建表"><a href="#建库建表" class="headerlink" title="建库建表"></a>建库建表</h3><p>分析页面内容，提取需要的数据表与数据库结构</p>
<h3 id="JavaBean"><a href="#JavaBean" class="headerlink" title="JavaBean"></a>JavaBean</h3><p>为每个数据库表建立一个JavaBean</p>
<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><ul>
<li>以下开始，每编写一个功能类代码类，都需对应测试一遍(XxxTest.class，testMethod())，或通过IDE快速生成junit测试类。</li>
<li>注意，测试不仅要测试正确的返回值情况，<strong>还要测试错误</strong>的<strong>返回值</strong>情况<strong>是否符合预期</strong></li>
<li>测试<strong>要全面</strong>，正确的所有情况，错误的所有情况</li>
<li>购物车类测试，可以进行累加测试(即复制上一个功能基础上继续做新的测试)</li>
</ul>
<hr>
<ul>
<li><strong>com.website.test.BaseDaoTest</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自创建测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDaoTest</span> <span class="keyword">extends</span> <span class="title">BaseDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into t_user(`username`,`password`,`email`) values(?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> status = update(sql,<span class="string">&quot;priscilla&quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="string">&quot;11111111@qq.com&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;status = &quot;</span> + status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryForOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from t_user where id = ?&quot;</span>;</span><br><span class="line">        User user = queryForOne(User.class, sql, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryForList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from t_user&quot;</span>;</span><br><span class="line">        List&lt;User&gt; users = queryForList(User.class, sql);</span><br><span class="line">        System.out.println(<span class="string">&quot;users.toString() = &quot;</span> + users.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryForValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select username from t_user where id = ?&quot;</span>;</span><br><span class="line">        Object username = queryForValue(sql, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;username = &quot;</span> + username.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.test.UserServiceTest</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//IDEA自动生成的测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserService service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User login = service.login(<span class="keyword">new</span> User(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;12345678@qq.com&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span>(login == <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">existsUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = service.existsUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;用户已存在&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;用户不存在，可用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        service.registerUser(<span class="keyword">new</span> User(<span class="string">&quot;Jacky&quot;</span>,<span class="string">&quot;333&quot;</span>,<span class="string">&quot;333@qq.com&quot;</span>));</span><br><span class="line">        service.registerUser(<span class="keyword">new</span> User(<span class="string">&quot;Jacky&quot;</span>,<span class="string">&quot;333&quot;</span>,<span class="string">&quot;333@qq.com&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DAO编写"><a href="#DAO编写" class="headerlink" title="DAO编写"></a>DAO编写</h3><p>DAO (DataAccessobjects 数据存取对象)是指位于业务逻辑和持久化数据之间实现对持久化数据的访问。通俗来讲，就是将数据库操作都封装起来。DAO相关类与文件操作涉及如下</p>
<ul>
<li>jdbc.properties</li>
<li>dbcUtils</li>
<li>BaseDao</li>
<li>定制化业务Dao(XxxxDao接口及、XxxxDao实现类)</li>
</ul>
<hr>
<h4 id="properties"><a href="#properties" class="headerlink" title=".properties"></a>.properties</h4><ul>
<li><p>创建存储jdbc连接参数的.properties文件，</p>
</li>
<li><p>编码前提准备好第三方jar包，如最基本数据库连接驱动jar包，其次有可能第三方(连接池、DbUtils等)</p>
</li>
</ul>
<hr>
<ul>
<li><strong>jdbc.properties</strong></li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/book1</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>

<h4 id="JdbcUtils"><a href="#JdbcUtils" class="headerlink" title="JdbcUtils"></a>JdbcUtils</h4><p>编写JdbcUtils工具类，仅用于<strong>获取与回收数据库连接</strong>(一般项目经历准备好)</p>
<ul>
<li><strong>com.website.utils.JdbcUtils.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于获取数据库连接，通过druid数据库连接池实现</span></span><br><span class="line"><span class="comment"> * 1、导包</span></span><br><span class="line"><span class="comment"> *  - druid-1.1.9.jar 数据库连接池</span></span><br><span class="line"><span class="comment"> *  - mysql-connector-java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-11 11:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JdbcUtils</span><span class="params">()</span></span>&#123;&#125;<span class="comment">//私有化构造器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource = <span class="keyword">null</span>;<span class="comment">//可多态，也可DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//0、JdbcUtils均为静态方法，私有化构造器后通过static代码块实现初始化操作</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="comment">//6、处理编译异常问题</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2、创建Properties对象，</span></span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">//4、获取配置文件的输入流对象</span></span><br><span class="line">            InputStream inputStream = JdbcUtils.class.getClassLoader().getResourceAsStream(&quot;jdbc.properties&quot;);</span><br><span class="line">            <span class="comment">//3、已知Properties核心需调用load方法加载配置文件数据，得知需输入流</span></span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">            <span class="comment">//1、创建通过DruidDataSourceFactory获取数据库连接池对象，得知需Properties对象</span></span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据库连接对象，若获取失败返回null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//3、因处理异常而声明对象</span></span><br><span class="line">        Connection con = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//2、处理异常问题</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1、直接从数据库连接池获取连接对象并返回</span></span><br><span class="line">            con = dataSource.getConnection();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> con;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放数据库连接，回收到数据库连接池</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection connection)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(dataSource != <span class="keyword">null</span>)&#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BaseDao"><a href="#BaseDao" class="headerlink" title="BaseDao"></a>BaseDao</h4><p><strong>BaseDao</strong>：封装<strong>通用的CRUD操作类</strong>(可以基于一些工具类实现，如DbUtils)，如含以下主要方法，一般设计为<strong>抽象类</strong>，提供给别人继承使用。一般含如下方法：</p>
<ul>
<li>int <strong>update</strong>(String sql,Object…args)：执行insert、update、delete语句</li>
<li><T> T <strong>queryForOne</strong>(Class<T> type,String sql, Object…args)：查询返回一个javaBean对象</li>
<li><T> List<T> <strong>queryForList</strong>(Class<T> type,String sql, Object…args)：查询返回多个JavaBean</li>
<li>Obejct <strong>queryForSingleValue</strong>(String sql,Object…args)：查询返回单个值</li>
</ul>
<hr>
<ul>
<li><strong>com.website.dao.BaseDao.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.website.utils.JdbcUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装通用的数据库操作：update、query</span></span><br><span class="line"><span class="comment"> * 基于DbUtils实现(commons-dbutils-1.3)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-11 14:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用DbUtils</span></span><br><span class="line">    <span class="keyword">private</span> QueryRunner queryRunner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询返回一个值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   执行的sql语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args  sql语句填入的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  执行成功返回Object，否则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">queryForValue</span><span class="params">(String sql,Object...args)</span></span>&#123;</span><br><span class="line">        Connection con = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(con,sql,<span class="keyword">new</span> ScalarHandler(),args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(con);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询返回javaBean的List集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type  返回javaBean类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   执行的sql语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args  sql语句填充的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;   返回类型的泛型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  执行成功返回List，否则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">queryForList</span><span class="params">(Class&lt;T&gt; type, String sql, Object...args)</span></span>&#123;</span><br><span class="line">        Connection con = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(con,sql,<span class="keyword">new</span> BeanListHandler&lt;T&gt;(type),args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(con);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询返回一个javaBean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type  返回的对象类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   执行的sql语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args  sql对应参数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;   返回类型的泛型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  执行成功返回JavaBean，否则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">queryForOne</span><span class="params">(Class&lt;T&gt; type,String sql,Object...args)</span></span>&#123;</span><br><span class="line">        Connection con = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(con,sql,<span class="keyword">new</span> BeanHandler&lt;T&gt;(type),args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(con);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于执行：Insert/Update/Delete操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 执行的sql语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args sql语句中填入参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 若成则返回受影响的行数，失败返回-1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql,Object...args)</span></span>&#123;</span><br><span class="line">        Connection con = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.update(con, sql, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(con);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="定制化DAO"><a href="#定制化DAO" class="headerlink" title="定制化DAO"></a>定制化DAO</h4><ul>
<li>含<strong>interface</strong>接口，与对应的<strong>implements</strong>实现类。对应参与业务操作的JavaBean的Dao操作</li>
<li>方法命名要细致：如通过用户名Id查找用户信息的方法应命名为，queryUserById()，而非getUser()</li>
<li>一般关于update的操作，如add、delete、update都基于BaseDAO需返回受影响条数</li>
</ul>
<h3 id="Service业务层"><a href="#Service业务层" class="headerlink" title="Service业务层"></a>Service业务层</h3><p>编写<strong>XxxxService</strong>的java类程序，Web开发的<strong>核心逻辑处理</strong>就写在Service层，把每个业务涉及的所有逻辑操作封装好，供视图控制层直接创建对象调用一个方法处理内部逻辑。</p>
<ul>
<li><strong>java类程序</strong>，每一个业务对应一个XxxService<strong>接口</strong>及其实现类XxxServiceImpl</li>
<li>像对数据库进行操作时，删除、修改时一般需判断这个数据是否存在数据库先(查询一次)，这些逻辑都是在service封装好的，BaseDao无需写(也无法写出一个通用的判断方法)</li>
</ul>
<h3 id="视图控制层"><a href="#视图控制层" class="headerlink" title="视图控制层"></a>视图控制层</h3><ul>
<li>编写<strong>Servlet</strong>程序，接收post、get请求，并调用service层进行逻辑后对应地做出响应。</li>
<li>编写<strong>BaseServlet</strong>程序，完成同一个业务中同一类型<strong>请求</strong>的同一<strong>分发</strong>处理</li>
<li>基于第三方<strong>BeanUtils</strong>工具类实现<strong>WebUtils</strong>类，完成把请求参数直接注入到bean对象的操作。</li>
</ul>
<h4 id="业务Servlet"><a href="#业务Servlet" class="headerlink" title="业务Servlet"></a>业务Servlet</h4><ul>
<li>一般对于Service层，一个Service对应一个Servlet视图控制层</li>
<li><strong>映射url命名</strong>：一般将<strong>XxxxServlet</strong>，<strong>映射URL</strong>为首字母小写，一般将<strong>xxxxServlet</strong></li>
</ul>
<h4 id="BaseServlet"><a href="#BaseServlet" class="headerlink" title="BaseServlet"></a>BaseServlet</h4><p>在IDEA这种项目结构的实际开发中，一般一个模块就一个servlet。负责一个模块，因此像<code>LoginServlet</code>与<code>RegisterServlet</code>应该和并成<code>UserServlet</code></p>
<h5 id="区分信息的传递"><a href="#区分信息的传递" class="headerlink" title="区分信息的传递"></a>区分信息的传递</h5><ul>
<li><strong>GET请求</strong>：可通过在URL传参中，添加action=login参数</li>
<li><strong>POST请求</strong>：可通过在表单中添加隐藏域实现</li>
</ul>
<h5 id="分支方案"><a href="#分支方案" class="headerlink" title="分支方案"></a>分支方案</h5><ol>
<li><p>让同一业务范围同一请求类型的都<strong>请求同一个Servlet程序</strong></p>
</li>
<li><p>分别在两者表单内<strong>添加一个隐藏域</strong>，用于表示<strong>请求的业务类型</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- login表单中的隐藏域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;action&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- register表单中的隐藏域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;action&quot;</span> <span class="attr">value</span>=<span class="string">&quot;regist&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>后端在同一接收请求前，通过获取隐藏域<code>action-value</code>的值来区分业务</p>
</li>
<li><p>后端对每个业务功能创建如HttpServlet原生Post方法的结构，在if-else分支语句中进行调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.doPost(req, resp);</span><br><span class="line">        </span><br><span class="line">        String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;login&quot;</span>.equals(action))&#123;</span><br><span class="line">            login(req,resp);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;regist&quot;</span>.equals(action))&#123;</span><br><span class="line">            regist(req,resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理登录功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 处理注册功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">regist</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="反射方案"><a href="#反射方案" class="headerlink" title="反射方案"></a>反射方案</h5><ol>
<li>注意：要求请求的<strong>区分信息</strong>与被调用<strong>方法名一致</strong>(直接反射调用)</li>
<li>获取到区分信息后，通过反射的方式自动调用各种方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.doPost(req, resp);</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);<span class="comment">//请求中文乱码</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);<span class="comment">//响应中文乱码</span></span><br><span class="line">        </span><br><span class="line">        String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">        <span class="comment">//反射方案</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = <span class="keyword">this</span>.getClass().getDeclaredMethod(action, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            method.invoke(<span class="keyword">this</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理登录功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//..... </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 处理注册功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">regist</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="BaseServlet-1"><a href="#BaseServlet-1" class="headerlink" title="BaseServlet"></a>BaseServlet</h5><p>由于每个业务一般都有若干个功能模块，因此如上的请求分发操作时很常见的。通过反射的方式实现请求分发的代码又极具通用性，因此可以选择把这部分的代码封装到一个父类(目的为了代码复用，设计成抽象父类)中。</p>
<ul>
<li>把请求分发的反射代码写入BaseServlet抽象类中，让其继承HttpServlet</li>
<li>然业务XxxServlet继承BaseServlet</li>
<li>注意，访问url还是指向业务XxxServlet，BaseServlet只是起到代码复用功能</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210422103151.png"
                     
                ></p>
<ul>
<li><strong>com.website.web.BaseServlet</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过反射实现的同一请求类型不同请求接口的基类</span></span><br><span class="line"><span class="comment"> * 请求参数：</span></span><br><span class="line"><span class="comment"> *          action：传入需调用的方法名(反射使用)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-22 10:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//post请求中文乱码问题，获取参数前调用有效</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//GET&amp;POST请求响应中文乱码，获取响应流前调用有效</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;action = &quot;</span> + action);</span><br><span class="line">        <span class="comment">//反射方案</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = <span class="keyword">this</span>.getClass().getDeclaredMethod(action, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            method.invoke(<span class="keyword">this</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.web.UserServlet</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承BaseServlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理登录功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">        System.out.println(<span class="string">&quot;login method-&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 处理注册功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">regist</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">        System.out.println(<span class="string">&quot;regist method-&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据回显"><a href="#数据回显" class="headerlink" title="数据回显"></a>数据回显</h4><p>对浏览器操作返回页面<strong>提醒信息</strong>、某些领域还需<strong>数据回显</strong>(用户注册失败回显已输入内容)</p>
<ol>
<li>一般通过request域，通过请求转发的方式回传数据与提醒信息</li>
<li>观察需要回显页面当前的URL，若回显数据存在URL中，则可通过EL隐藏域param获取到</li>
</ol>
<h4 id="BeanUtils"><a href="#BeanUtils" class="headerlink" title="BeanUtils"></a>BeanUtils</h4><p>在视图控制层中，还有一部分代码的工作内容是高度相似的，即从request中获取<strong>请求的参数并封装成对应的JavaBean</strong>对象，如用户的登录，注册等等…。而且较大的项目，往往可能存在数十个请求参数，封装成一个对象，若都采用一个个编写getParameter()，获取每个参数，并创建对象，把每个参数setXxxx()进去，工作量和代码可维护性都是个问题。因此可以编写一个通用的方法去处理这些代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    </span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">//1、获取请求的参数</span></span><br><span class="line">    String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2、将请求参数封装成对象，new User(username,password,null)</span></span><br><span class="line">    User user = service.login(<span class="keyword">new</span> User(username,password,<span class="keyword">null</span>));</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="BeanUtils基本使用"><a href="#BeanUtils基本使用" class="headerlink" title="BeanUtils基本使用"></a>BeanUtils基本使用</h5><ol>
<li><p>由于BeanUtils是第三方的jar包，使用前需要先导包</p>
<ul>
<li>commons-beanutils-1.8.0.jar</li>
<li>commons-logging-1.1.1.jar (依赖)</li>
</ul>
</li>
<li><p><strong>注入前提</strong>：前端页面<strong>请求参数名(name)**与JavaBean</strong>属性名<strong>一致(核心是与</strong>setter()方法一致**)</p>
</li>
<li><p>BeanUtils的注入操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;注入前，user = &quot;</span> + user);</span><br><span class="line">    BeanUtils.populate(user,req.getParameterMap());</span><br><span class="line">    System.out.println(<span class="string">&quot;注入后，user = &quot;</span> + user);</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="WebUtils封装"><a href="#WebUtils封装" class="headerlink" title="WebUtils封装"></a>WebUtils封装</h5><p>由于每次执行注入操作都需要上述BeanUtils的注入代码与异常处理，可以选择把这些操作封装成一个静态方法</p>
<ul>
<li><strong>com.website.utils.WebUtils</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把Map中的值注入到对应的JavaBean属性中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copyParamToBean</span><span class="params">(Map value,T bean)</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        BeanUtils.populate(bean,value);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>调用测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User user = WebUtils.copyParamToBean(req.getParameterMap(),<span class="keyword">new</span> User());</span><br></pre></td></tr></table></figure>

<h5 id="BeanUtils源码分析"><a href="#BeanUtils源码分析" class="headerlink" title="BeanUtils源码分析"></a>BeanUtils源码分析</h5><p>最后通常将所有页面改为jsp页面</p>
<h2 id="前端相关操作"><a href="#前端相关操作" class="headerlink" title="前端相关操作"></a>前端相关操作</h2><ol>
<li>抽取前端页面相同的内容，通过引用的方式<ul>
<li>公共样式代码部分：如导航栏，底部栏/页脚等</li>
<li>公共外部引用标签部分，如共同的js、css，base标签</li>
</ul>
</li>
</ol>
<h1 id="Web路径见问题"><a href="#Web路径见问题" class="headerlink" title="Web路径见问题"></a>Web路径见问题</h1><h2 id="相对路径跳转错乱"><a href="#相对路径跳转错乱" class="headerlink" title="相对路径跳转错乱"></a>相对路径跳转错乱</h2><h3 id="场景驱动"><a href="#场景驱动" class="headerlink" title="场景驱动"></a>场景驱动</h3><ul>
<li>前端页面代码中，如html、css、js使用相对路径进行资源的使用时，<strong>默认</strong>是相对<strong>当前浏览器页面中地址栏</strong>上的地址进行一个相对路径的定位。</li>
<li>仅在前端页面代码中进行相对路径跳转是没问题，但是，一旦出现某个前端代码访问的资源的<strong>响应方式是请求的转发</strong>响应到另一个页面的，此时就会由于请求的转发特性，使其浏览器地址栏还是处于发起请求前的样子，扰乱了前端代码页面相对路径定位的一个依据，使其路径错误跳转，找不到资源。</li>
</ul>
<h3 id="base标签介绍"><a href="#base标签介绍" class="headerlink" title="base标签介绍"></a>base标签介绍</h3><p>原生javaweb阶段可以使用 base+相对路径这个解决方案，但涉及框架参与的开发建议使用绝对路径。</p>
<p>base标签使用：</p>
<ul>
<li>设置base标签可以修改前端代码相对寻址的依据，使其相对寻址以base标签设定的URI为基准。</li>
<li>注意：base标签设置只对当前页面有效。(多个页面需多个设置)</li>
<li>base标签的href属性只取<strong>目录信息</strong>：因此末尾是目录的话斜杠不能省，省了就不是目录，而是资源了。</li>
</ul>
<hr>
<ul>
<li>注意：一般设置base后，页面原本使用相对路径引入的资源一般都会失效了，如js、css、图片资源等，需对应的进行引入路径修改,(若之前加载过请清楚缓存后再查看)，或者F12查看Console错误提示</li>
</ul>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>通过base标签与jsp结合实现路径的正确跳转方案步骤如下：</p>
<ol>
<li>为所有页面设置统一的base标签(一份编写，其他通过引用)</li>
<li>通过jsp动态获取当前web项目的<code>ip:port/project</code>信息作为base标签的href属性值</li>
</ol>
<h4 id="base标签示例"><a href="#base标签示例" class="headerlink" title="base标签示例"></a>base标签示例</h4><ul>
<li>示例代码：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;http://www.testwebsite.com/&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;img.jpeg&quot;</span>&gt;</span>访问<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试效果：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210603171310.png"
                     
                ></p>
<h4 id="动态服务器资源路径"><a href="#动态服务器资源路径" class="headerlink" title="动态服务器资源路径"></a>动态服务器资源路径</h4><p>由于base标签需要填写绝对路径，而web项目在不同网络环境下ip是不一样的，因此需要jsp动态获取<code>ip:port/project</code>后作为组成base的href属性</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="comment">//http://</span></span><br><span class="line">    StringBuffer basePath = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    basePath.append(request.getScheme());</span><br><span class="line">    basePath.append(<span class="string">&quot;://&quot;</span>);</span><br><span class="line">    basePath.append(request.getServerName());</span><br><span class="line">    basePath.append(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">    basePath.append(request.getServerPort());</span><br><span class="line">    basePath.append(request.getContextPath());</span><br><span class="line">    basePath.append(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h1 id="数据传送问题"><a href="#数据传送问题" class="headerlink" title="数据传送问题"></a>数据传送问题</h1><h2 id="请求与重定向问题"><a href="#请求与重定向问题" class="headerlink" title="请求与重定向问题"></a>请求与重定向问题</h2><p>请求的转发用来传递数据，而请求的重定向是不可用来传输数据的，是用于终止数据的。场景请求转发与重定向使用场景归纳如下：</p>
<ol>
<li><strong>查询数据</strong>：<ul>
<li>成功/失败：请求的<strong>转发</strong>，request域传回查询的结果。</li>
</ul>
</li>
<li><strong>修改数据</strong>：增删改<ul>
<li>成功：请求的<strong>重定向</strong>，防止刷新页面表单重复提交。</li>
<li>失败：请求的<strong>转发</strong>，request域携带错误提示信息。</li>
</ul>
</li>
</ol>
<h2 id="数据传送域问题"><a href="#数据传送域问题" class="headerlink" title="数据传送域问题"></a>数据传送域问题</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul>
<li>作用域的作用与生命周期的长短，即决定了资源的占用情况。</li>
<li>范围越大，周期越长，占用的资源就越大。因此传送到前端数据所承载的域越小越好，能尽快回收资源。</li>
<li>因此能用request域解决的问题不用session域，能用session域解决的问题不用application…</li>
<li>生命周期及作用范围排序：pageContext —&gt; request —&gt; session —&gt; application<ul>
<li><strong>pageContext</strong>：仅限于<strong>当前 JSP 页面</strong>，因此Servlet或者其他页面都获取不到。</li>
<li><strong>request</strong>：仅限于<strong>同一个请求</strong>.</li>
<li><strong>session</strong>：限于<strong>同一次会话</strong>，浏览器打开直到关闭称之为一次会话(前提在此期间会话不失效)</li>
<li><strong>application</strong>：限于<strong>当前WEB 应用</strong>，是范围最大的属性作用范围。只要在一处设置属性, 在其他各处的 JSP 或 Servlet 中都可以获取到。</li>
</ul>
</li>
</ul>
<h3 id="常用功能数据域"><a href="#常用功能数据域" class="headerlink" title="常用功能数据域"></a>常用功能数据域</h3><ul>
<li><p>用户请求响应数据传递：request</p>
</li>
<li><p>数据回显：request</p>
</li>
<li><p>配置：application</p>
</li>
<li><p>用户登录信息：Cooke 、session</p>
<p>纯Session实现的购物车：session</p>
</li>
</ul>
<h2 id="数据获取问题"><a href="#数据获取问题" class="headerlink" title="数据获取问题"></a>数据获取问题</h2><ul>
<li>直接访问JSP页面没有想要加载的数据时，可通过访问Servlet接口，再<strong>转发</strong>到指定JSP页面中。</li>
</ul>
<h3 id="首页数据获取"><a href="#首页数据获取" class="headerlink" title="首页数据获取"></a>首页数据获取</h3><p>如上所示，当index.jsp首页没数据时，可以通过先访问一个Servlet再转发到index.jsp页面内。但此时用户访问首页的时候必须访问一个Servlet地址。而一般网站的首页地址<code>http://ip:port</code>或 <code>http://www.xxx.com</code>下的index文件，不会是不方便用户记忆的Servlet长地址。</p>
<h4 id="方案1：jsp跳板"><a href="#方案1：jsp跳板" class="headerlink" title="方案1：jsp跳板"></a>方案1：jsp跳板</h4><p>可以利用再工程根目录下创建一个index.jsp文件，这个文件里面只做一件事，就是进行一次请求的转发访问获取首页数据的Servlet，Servlet最终传送数据到正在的index.jsp页面。即访问过程，<strong>index.jsp ——&gt; Servlet ——&gt; index.jsp</strong>。</p>
<ul>
<li>工程根目录下index.jsp：<code>&lt;jsp:forward page=&quot;/include/xxxServlet&quot;&gt;&lt;/jsp:forward&gt;</code></li>
<li>首页数据Servlet</li>
<li>真正的index.jsp</li>
</ul>
<blockquote>
<ul>
<li>注意：index首页通过<strong>请求转发</strong>到的页面<strong>不能是被过滤器拦截的页面</strong>，否则会进行转发拦截死循环</li>
<li>若首页转发的页面受拦截器作用，则只能用重定向</li>
</ul>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210528142812.png"
                     
                ></p>
<h1 id="表单重复提交"><a href="#表单重复提交" class="headerlink" title="表单重复提交"></a>表单重复提交</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>表单重复提交常见的分为两大类，三种情况：</p>
<ol>
<li><strong>间接</strong>重复提交(用户-浏览器)：由于<strong>浏览器</strong>保存请求<strong>机制</strong>与后端<strong>请求转发</strong>导致。<ul>
<li><strong>请求转发刷新重复提交</strong></li>
</ul>
</li>
<li><strong>直接</strong>重复提交(用户)：有用户直接发起重复提交。<ul>
<li><strong>网络延迟重复提交</strong></li>
<li><strong>回退重复提交</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p>部分动态示意图及其文字与代码案例引用如下：</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/chenzao666/article/details/81222855?spm=1001.2014.3001.5501" >https://blog.csdn.net/chenzao666/article/details/81222855?spm=1001.2014.3001.5501<i class="fas fa-external-link-alt"></i></a></li>
</ul>
</blockquote>
<h2 id="请求转发刷新重复提交"><a href="#请求转发刷新重复提交" class="headerlink" title="请求转发刷新重复提交"></a>请求转发刷新重复提交</h2><h3 id="基本概念-1"><a href="#基本概念-1" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li><strong>说明</strong>：间接重复提交常指的是”请求转发刷新重复提交“，用户对后端发起<strong>修改数据提交</strong>(增删改)时，后端通过<strong>请求的转发</strong>响应提交数据后。由于浏览器的“保留最近的一次请求机制”，在用户执行<strong>刷新操作</strong>(F5)操作时，会导致直接再提交一次请求。</li>
<li><strong>场景复现</strong>：网络延迟重复提交可在Servlet程序中添加延时代码(Sleep)模拟网络差状态，在提交后页面一直处于加载状态下，再次点击提交便是网络延迟重复提交。</li>
<li><strong>引发的问题</strong>：<strong>非用户主观意愿</strong>(刷新)所带来的<strong>操作冗余</strong>，即不经意间进行了多次操作。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E5%88%B7%E6%96%B0%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4%E7%A4%BA%E6%84%8F%E5%8A%A8%E6%80%81%E5%9B%BE.gif"
                     
                ></p>
<h3 id="场景复现"><a href="#场景复现" class="headerlink" title="场景复现"></a>场景复现</h3><p>一般表单的重复提交出现在向后台发起<strong>修改数据提交</strong>(增删改)，如图书管理中的添加图书功能。</p>
<ul>
<li><p><strong>com.website.web.BaseServlet.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加一本图书</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1、获取请求参数并封装成java类</span></span><br><span class="line">    Book book = WebUtils.copyParamToBean(req.getParameterMap(), <span class="keyword">new</span> Book());</span><br><span class="line">    <span class="comment">//2、调用service层方法添加图书</span></span><br><span class="line">    service.addBook(book);</span><br><span class="line">    <span class="comment">//3、返回图书列表页面：</span></span><br><span class="line">    req.setAttribute(<span class="string">&quot;books&quot;</span>,book);</span><br><span class="line">    <span class="comment">//通过请求的转发响应提交数据</span></span><br><span class="line">    req.getRequestDispatcher(<span class="string">&quot;manager/bookServlet?action=list&quot;</span>).forward(req,resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>提交数据后返回图书列表情况：为演示明显，采用了get请求</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210525095538.png"
                     
                ></p>
</li>
<li><p><strong>原理分析</strong>：</p>
<p>由于浏览器默认会把用户最后一次请求的提交信息保留起来，当用户通过F5刷新页面时，浏览器就会自动提交该请求(对于POST请求一些浏览器还做提醒表单重复提交)。由于后台响应提交数据的方式是转发，而转发是一次请求，从图中可以看出URL还是处于add操作中，数据也被服务器保留着。</p>
</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul>
<li><p><strong>解决方案</strong>：将用户对后台进行<strong>修改数据提交</strong>(增删改)后的操作响应设置为<strong>请求的重定向</strong></p>
<p><code>resp.sendRedirect(req.getContextPath() + &quot;/manager/bookServlet?action=list&quot;);</code></p>
</li>
<li><p><strong>原理</strong>：请求的<strong>重定向</strong>是<strong>两次独立的请求</strong>，第一次请求把提交数据通过request域发给了后台。紧接着后台要求浏览器再发送一个<strong>新的请求</strong>去访问指定页面(一般为数据呈现(查询)页面或Servlet)。此时，由于浏览器只记录最后一次请求，因此即使刷新提交的请求也不是提交数据的请求。而是查询信息的请求(这些是允许重复提交查询的)</p>
</li>
</ul>
<h2 id="网络延迟重复提交"><a href="#网络延迟重复提交" class="headerlink" title="网络延迟重复提交"></a>网络延迟重复提交</h2><h3 id="基本概念-2"><a href="#基本概念-2" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li><strong>说明</strong>：用户正常提交服务器，但是由于网络延迟等原因，迟迟未收到服务器的响应，这个时候，用户以为提交失败， 就会着急，然后多点了几次提交操作，也会造成表单重复提交。</li>
<li><strong>场景复现</strong>：在接口响应代码中加入睡眠<code>Thread.sleep()</code>模拟网络环境不佳情况，再连续点击提交即可。</li>
<li><strong>引发的问题</strong>：由服务器和浏览器响应的机制可知，延迟重复提交纯粹造成资源浪费，一份结果多次请求。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4%E7%A4%BA%E6%84%8F%E5%8A%A8%E6%80%81%E5%9B%BE.gif"
                     
                ></p>
<h3 id="响应机制"><a href="#响应机制" class="headerlink" title="响应机制"></a>响应机制</h3><p>在介绍网络延迟所造成的重复提交前，先要说明涉及到服务器与浏览器对请求响应的机制知识</p>
<h4 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h4><ol>
<li>*服务器采用<strong>多线程</strong>处理多个请求，即<strong>并行处理请求</strong><ul>
<li>无论是多个客户发起同一个请求，还是一个用户发起多次请求，这些请求的处理都是独立且并行，互不干扰。</li>
</ul>
</li>
<li>当然同时处理多个请求的数量是有限的，再超过限制后则服务器将会把请求存入队列中排队，采取<strong>先来先服务</strong>处理方式，<strong>每一个请求都将被处理完毕</strong></li>
</ol>
<hr>
<p>小结：<strong>并行处理、所有请求均会被处理</strong></p>
<h4 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h4><p>注意：这里所指”请求“指<strong>由用户直接发起的请求</strong>，不包括资源加载自动对后台发起请求。一般存在如下两种请情况。</p>
<ul>
<li><p><strong>发起一个请求</strong>：客户端发起一个请求时，浏览器把请求发送出去，等待响应，收到响应并解析内容。</p>
</li>
<li><p><strong>发起多个请求</strong>：包含发起多个<strong>不同</strong>或<strong>相同</strong>的请求</p>
<ul>
<li><p><strong>情况1</strong>：每一个请求都收到响应后再发起一个请求，则相当于发起了一个请求</p>
</li>
<li><p><strong>情况2</strong>：在上一个请求未接收到响应时发起一个新的请求</p>
<ol>
<li><p>用户发起请求A，浏览器提交请求A，浏览器等待请求A响应…，<code>Status=(pending)</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E5%A4%9A%E8%AF%B7%E6%B1%82%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B601.png"
                     
                ></p>
</li>
<li><p>用户发起请求A’或请求B，浏览器将上一个还<strong>未收到响应</strong>的请求A的响应状态Status置为<code>Status=(canceled)</code>，表示当收到请求A的响应时，浏览器直接<strong>丢弃数据</strong>，<strong>不解析显示到页面</strong>。然后将新的请求A’或B发出。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E5%A4%9A%E8%AF%B7%E6%B1%82%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B602.png"
                     
                ></p>
</li>
<li><p>此时若步骤2的发出的新请求也处于<code>pending</code>状态时用户又再发起新的请求，则继续执行步骤2操作</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E5%A4%9A%E8%AF%B7%E6%B1%82%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B603.png"
                     
                ></p>
</li>
<li><p>直至出现一个请求完整收到响应后，浏览器才会将数据解析，并显示到页面上。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530102842.png"
                     
                ></p>
<ul>
<li>请求与响应数如下图统计</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>不间断pending状态请求数</th>
</tr>
</thead>
<tbody><tr>
<td>用户直接发起请求数</td>
<td>7</td>
</tr>
<tr>
<td>浏览器发出请求数</td>
<td>7</td>
</tr>
<tr>
<td>服务器接收请求数</td>
<td>7</td>
</tr>
<tr>
<td>服务器响应请求数</td>
<td>7</td>
</tr>
<tr>
<td>浏览器响应解析数</td>
<td>1</td>
</tr>
</tbody></table>
</li>
</ol>
<hr>
</li>
<li><p><strong>要点</strong>：</p>
<ul>
<li>因此在多次还未收到响应就发出的新的请求操作过程中，最终呈现给用户的基于页面反馈的讯息是”多次请求，只响应最后一次“。</li>
<li>需要再次强调：被<strong>浏览器</strong>标记为Status=(canceled)的请求虽然浏览器不处理，但服务器是依然做出响应的，对于服务器而言，<strong>服务器会响应收到的一切请求</strong></li>
<li>因此，<strong>pending</strong>状态下对<strong>同一请求</strong>(不包括不同请求)，进行连续状态下的新请求，造成的结果是请求了多份重复的资源或操作而最终给浏览器解析呈现给用户的只有一份，是<strong>纯粹的资源浪费</strong>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>小结</strong>：<ol>
<li>服务器是并行处理多个请求的</li>
<li>服务器总是会接收并响应所有请求</li>
<li>浏览器对服务器的宏观通话过程是：”一问一答“</li>
</ol>
</li>
</ul>
<h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>对于延迟重复提交与回退重复提交本质上都是，<strong>跳过了</strong>获取这个提交页面的<strong>Servlet</strong>，时业务流程<strong>不按实际操作流程</strong>进行，而导致的一种重复请求操作，引发的是增加了服务器的响应压力。因此这种类型的重复提交的解决方案是：<strong>本防止跳过Servlet的情况下发出请求，保证业务流程按实际操作流程进行</strong></p>
<ul>
<li><p><strong>正常流程</strong>：</p>
<ul>
<li><p>成功：点击登录超链接/访问首页(<strong>Servlet</strong>处理) ——&gt; 登录页面 ——&gt; 提交登录</p>
<p>——&gt; 转到登录后页面，且再无登录操作。</p>
</li>
<li><p>失败：——&gt; 失败(<strong>Servlet</strong>转发) ——&gt; 登录页面(提示错误)</p>
</li>
</ul>
</li>
<li><p><strong>网络延迟重复提交</strong>：</p>
<ul>
<li>第一次请求：点击登录超链接/访问首页(Servlet处理) ——&gt; 登录页面 ——&gt; 提交登录</li>
<li>重复提交：登录页面 ——&gt; 提交登录…</li>
</ul>
</li>
<li><p><strong>回退重复提交</strong>：</p>
<ul>
<li>第一次请求：点击登录超链接/访问首页(Servlet处理) ——&gt; 登录页面 ——&gt; 提交登录</li>
<li>重复提交：登录页面 ——&gt; 提交登录…</li>
</ul>
</li>
</ul>
<h4 id="Session方案"><a href="#Session方案" class="headerlink" title="Session方案"></a>Session方案</h4><ul>
<li><p><strong>Session-Token对称验证方案简述</strong>：通过信息对称判断，强制业务流程按序进行(过滤非法业务流程操作)</p>
<ol>
<li>在提交页面加载的Servlet程序中，生成一个唯一的随机标识号，专业术语称为Token(令牌)，同时在当前用户的Session域中保存这个Token</li>
<li>然后将Token发送到客户端的Form表单中，让表单提交的时候连同这个Token一起提交到服务器端(可以用隐藏域来存储这个Token)</li>
<li>然后在服务器端判断客户端提交上来的Token与服务器端生成的Token是否一致，如果不一致，那就是重复提交了，此时服务器端就可以不处理重复提交的表单(直接return，无数据响应的响应)。如果相同则属于正常业务流程的提交(经Servlet生成)，处理完后清除Session域中存储的标识号。</li>
</ol>
<hr>
<ul>
<li>也可以改变编写逻辑，即步骤3改变为，服务器在Session域中获取验证码后，立即删除。后续null判断机率更高。逻辑一样，好处在于不容易忘记卸载Session域中的验证码。</li>
</ul>
</li>
<li><p><strong>方案效果</strong>：</p>
<p>原理其实是利用了”<strong>信息对称</strong>“来实现，由于Token只有在正常业务流程的加载页面Servlet程序中生成，在首次成功提交响应程序中删除。因此，除正常业务流程访问外，不按这个业务流程操作的动作，即重复提交都会造成Token不对称。或前后端Token值不一致，或后端Token值为null，都属于重复提交操作的Token不对称情况。</p>
</li>
<li><p><strong>方案合并</strong>：由于Web表单提交页面中经常使用验证码来防止一些其他的恶意操作，而验证码的工作流程与工作时机和通过Session实现的直接重复提交解决方案一致，因此可以将两者合并起来，即<code>Token = 验证码&#39;</code>从而降低需要维护的机制与变量的数目。</p>
</li>
</ul>
<hr>
<ul>
<li><p><strong>可优化空间</strong>：</p>
<ol>
<li>代码优化部分(<strong>推荐</strong>)：步骤1可以模仿kaptcha验证码生成方法，编写一个专门用于生成Token的Servlet程序并配置在web.xml中，可通过URL访问直接完成Token动态生成与保存到Session域中。这样就不用为了这个机制而单独转发一个页面。</li>
<li>当后端发现用户重复提交后，后端如何进行操作，由于浏览器只会解析最后一次请求(重复提交)，如何提示之前的提交已经成功，之后的提交是重复提交，请勿操作。</li>
<li>当后端发现用户重复提交后，如何遏制用户继续重复提交。</li>
<li>明显，这种方案虽然避免因重复提交导致的后端数据重复操作，但对于流向服务器的流量压力始终没改善(估计难以改善，就如DOS攻击的防护)</li>
</ol>
</li>
<li><p><strong>参考代码</strong>：</p>
<ul>
<li>自编写：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.Constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基于验证码的Session-Token信息对称解决</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistServlet3</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">        <span class="comment">//获取表单内容Servlet请求响应</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;getForm&quot;</span>.equals(action))&#123;</span><br><span class="line">            <span class="comment">//1、生成动态唯一标识Token</span></span><br><span class="line">            <span class="comment">//String token = makeToken();</span></span><br><span class="line">            String token = (String) req.getSession().getAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">            <span class="comment">//2、将Token放入Session域</span></span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line">            <span class="comment">//3、将token返回个前端表单存储</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line">            <span class="comment">//4、执行正常的页面加载响应逻辑</span></span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/regist3.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//表单提交Servlet响应</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//若存在重复提交操作</span></span><br><span class="line">            <span class="keyword">if</span>(isRepeatSubmit(req))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;重复提交操作，不处理&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;<span class="comment">//服务器接收请求，但不做任何操作(响应)</span></span><br><span class="line">                <span class="comment">//其实还需要处理</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">                String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(username))&#123;</span><br><span class="line">                    <span class="comment">//修改数据库操作</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;请求处理-注册成功&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    req.getRequestDispatcher(<span class="string">&quot;/registServlet2?action=getForm&quot;</span>).forward(req,resp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="comment">//合法提交</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重复提交判断函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  true存在重复提交，否则合法提交</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isRepeatSubmit</span><span class="params">(HttpServletRequest req)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">        <span class="comment">//1、获取用户提交上来的token值</span></span><br><span class="line">        String clientToken = req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(clientToken == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、获取该用户Session域中的Token值</span></span><br><span class="line">        Object serverToken = req.getSession().getAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">        <span class="keyword">if</span>(serverToken == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、对比token值</span></span><br><span class="line">        <span class="keyword">if</span>(!clientToken.equals(serverToken))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4、若为合法提交，立即卸载Session中的token值</span></span><br><span class="line">        req.getSession().removeAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>尚硅谷2020javaWeb视频</li>
<li>由于基于kaptcha验证码实现，因此可直接访问表单页面.jsp文件通过kaptcha的验证码Servlet生成程序也可以调用到更新验证码的操作。所以不用先经过一个Servlet生成Token再转发到指定提交页面。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取Session中的验证码</span></span><br><span class="line">        String token = (String) req.getSession().getAttribute(KAPTCHA_SESSION_KEY);</span><br><span class="line">        <span class="comment">// 删除 Session中的验证码</span></span><br><span class="line">        req.getSession().removeAttribute(KAPTCHA_SESSION_KEY);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String code = req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取用户名</span></span><br><span class="line">        String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (token != <span class="keyword">null</span> &amp;&amp; token.equalsIgnoreCase(code)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;保存到数据库：&quot;</span> + username);</span><br><span class="line">            resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/ok.jsp&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请不要重复提交表单&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>网上引用：</p>
</li>
<li><p><strong>form.jsp</strong></p>
</li>
<li><p>在form.jsp中使用隐藏域来存储<strong>Token(令牌)</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;form表单&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/servlet/DoFormServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;%--使用隐藏域存储生成的token--%&gt;</span><br><span class="line">        &lt;%--</span><br><span class="line">            &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;token&quot;</span> value=<span class="string">&quot;&lt;%=session.getAttribute(&quot;</span>token<span class="string">&quot;) %&gt;&quot;</span>&gt;</span><br><span class="line">        --%&gt;</span><br><span class="line">        &lt;%--使用EL表达式取出存储在session中的token--%&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;token&quot;</span> value=<span class="string">&quot;$&#123;token&#125;&quot;</span>/&gt; </span><br><span class="line">        用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt; </span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>FormServlet.java</strong></p>
</li>
<li><p>创建FormServlet，用于生成**Token(令牌)**和跳转到form.jsp页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xdp.gacl.session;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FormServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">884689940866074733L</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String token = TokenProccessor.getInstance().makeToken();<span class="comment">//创建令牌</span></span><br><span class="line">        System.out.println(<span class="string">&quot;在FormServlet中生成的token：&quot;</span>+token);</span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;token&quot;</span>, token);  <span class="comment">//在服务器使用session保存token(令牌)</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/form.jsp&quot;</span>).forward(request, response);<span class="comment">//跳转到form.jsp页面</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>DoFormServlet.java</strong></p>
</li>
<li><p>处理表单请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xdp.gacl.session;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoFormServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">boolean</span> b = isRepeatSubmit(request);<span class="comment">//判断用户是否是重复提交</span></span><br><span class="line">            <span class="keyword">if</span>(b==<span class="keyword">true</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;请不要重复提交&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            request.getSession().removeAttribute(<span class="string">&quot;token&quot;</span>);<span class="comment">//移除session中的token</span></span><br><span class="line">            System.out.println(<span class="string">&quot;处理用户提交请求！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 判断客户端提交上来的令牌和服务器端生成的令牌是否一致</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">         *         true 用户重复提交了表单 </span></span><br><span class="line"><span class="comment">         *         false 用户没有重复提交表单</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isRepeatSubmit</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">            String client_token = request.getParameter(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="comment">//1、如果用户提交的表单数据中没有token，则用户是重复提交了表单</span></span><br><span class="line">            <span class="keyword">if</span>(client_token==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//取出存储在Session中的token</span></span><br><span class="line">            String server_token = (String) request.getSession().getAttribute(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="comment">//2、如果当前用户的Session中不存在Token(令牌)，则用户是重复提交了表单</span></span><br><span class="line">            <span class="keyword">if</span>(server_token==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3、存储在Session中的Token(令牌)与表单提交的Token(令牌)不同，则用户是重复提交了表单</span></span><br><span class="line">            <span class="keyword">if</span>(!client_token.equals(server_token))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>TokenProccessor.java</strong></p>
</li>
<li><p>生成Token的工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xdp.gacl.session;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenProccessor</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *单例设计模式（保证类的对象在内存中只有一个）</span></span><br><span class="line"><span class="comment">     *1、把类的构造函数私有</span></span><br><span class="line"><span class="comment">     *2、自己创建一个类的对象</span></span><br><span class="line"><span class="comment">     *3、对外提供一个公共的方法，返回类的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">TokenProccessor</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> TokenProccessor instance = <span class="keyword">new</span> TokenProccessor();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回类的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TokenProccessor <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成Token</span></span><br><span class="line"><span class="comment">     * Token：Nv6RRuGEVvmGjB+jimI/gw==</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">makeToken</span><span class="params">()</span></span>&#123;  <span class="comment">//checkException</span></span><br><span class="line">        <span class="comment">//  7346734837483  834u938493493849384  43434384</span></span><br><span class="line">        String token = (System.currentTimeMillis() + <span class="keyword">new</span> Random().nextInt(<span class="number">999999999</span>)) + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//数据指纹   128位长   16个字节  md5</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest md = MessageDigest.getInstance(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line">            <span class="keyword">byte</span> md5[] =  md.digest(token.getBytes());</span><br><span class="line">            <span class="comment">//base64编码--任意二进制编码明文字符   adfsdfsdfsf</span></span><br><span class="line">            BASE64Encoder encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line">            <span class="keyword">return</span> encoder.encode(md5);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="合并验证码方案"><a href="#合并验证码方案" class="headerlink" title="合并验证码方案"></a>合并验证码方案</h4><ul>
<li><p>由上所述，通过Session-Token对称方案解决重复提交问题，还常与验证码机制合并使用，以下介绍基于第三方验证码生成包<strong>Kaptcha</strong>实现验证码生成。</p>
</li>
<li><p>验证码可以防止恶意破解密码、刷票、论坛灌水、刷页等非法操作，是Web非常常用的验证机制之一。</p>
</li>
</ul>
<h5 id="Kaptcha"><a href="#Kaptcha" class="headerlink" title="Kaptcha"></a>Kaptcha</h5><p>Google Kaptcha图片验证是一个可高度配置的实用验证码生成工具，可自由配置的选项如：</p>
<ul>
<li>验证码的字体</li>
<li>验证码字体的大小</li>
<li>验证码字体的字体颜色</li>
<li>验证码内容的范围(数字，字母，中文汉字！)</li>
<li>验证码图片的大小，边框，边框粗细，边框颜色</li>
<li>验证码的干扰线</li>
<li>验证码的样式(鱼眼样式、3D、普通模糊、…)</li>
<li>…</li>
</ul>
<h5 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h5><p>Kaptcha的使用是直接使用其生成验证码的Servlet程序，配置后直接是一个URL接口。</p>
<ol>
<li><p>导入Google验证码的jar包：<strong>kaptcha-2.3.2.jar</strong></p>
</li>
<li><p>在web.xml中去配置用于<strong>生成验证码</strong>的<strong>Servlet</strong>程序访问的<strong>URL</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530213709.png"
                     
                ></p>
</li>
<li><p><strong>前端页面</strong>获取验证码：直接访问Servlet配置URL，如上所例配置URL为<code>ip:port/工程项目名/kaptcha.jpg</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &lt;form action=<span class="string">&quot;http://localhost:8080/13_RepeatSubmit/registServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">     用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> &gt; &lt;br&gt;</span><br><span class="line">     验证码：&lt;input type=<span class="string">&quot;text&quot;</span> style=<span class="string">&quot;width: 60px;&quot;</span> name=<span class="string">&quot;code&quot;</span>&gt;</span><br><span class="line">     &lt;img src=<span class="string">&quot;http://localhost:8080/13_RepeatSubmit/kaptcha.jpg&quot;</span> alt=<span class="string">&quot;&quot;</span> style=<span class="string">&quot;width: 100px; height: 28px;&quot;</span>&gt; &lt;br&gt;</span><br><span class="line">     &lt;input id=<span class="string">&quot;count&quot;</span> type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;requestCount&quot;</span> value=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">     &lt;input id=<span class="string">&quot;submit&quot;</span> type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>效果如下图所示：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530214531.png"
                     
                ></p>
</li>
<li><p><strong>后端Servlet</strong>获取验证码数据：kaptcha生成验证码的Servlet程序被调用后有自动完成下述三个操作</p>
<ul>
<li><p>自动生成随机的验证码</p>
</li>
<li><p>自动并生成验证码图片</p>
</li>
<li><p>自动把验证码<strong>保存到Session域</strong>中</p>
<ul>
<li>kaptcha有专门存储常量的类Constants，里面<code>KAPTCHA_SESSION_KEY</code>即是存储在Session域中验证码Key值</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530222250.png"
                     
                ></p>
</li>
<li><p>后端直接通过Session域即可获取</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String token = (String)req.getSession().getAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="刷新验证码"><a href="#刷新验证码" class="headerlink" title="刷新验证码"></a>刷新验证码</h5><ul>
<li><p>通过JS为验证码图片添加点击事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给验证码的图片，绑定单击事件</span></span><br><span class="line">$(<span class="string">&quot;#code_img&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//在事件响应的 function 函数中有一个 this 对象。这个 this 对象，是当前正在响应事件的 dom 对象</span></span><br><span class="line"><span class="comment">//src 属性表示验证码 img 标签的图片路径。它可读，可写</span></span><br><span class="line"><span class="comment">//当对img的src修改时(写操作)，img标签将会重新加载图片(重新发起get请求获取图片)</span></span><br><span class="line"><span class="comment">//添加一个动态的任意请求参数是为了防止某些浏览器的缓存机制导致不能多次点击更新</span></span><br><span class="line"><span class="built_in">this</span>.src = <span class="string">&quot;$&#123;basePath&#125;kaptcha.jpg?d=&quot;</span> + <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>浏览器<strong>静态资源</strong>缓存机制：</p>
<p>某些浏览器为了加快响应速度，常常对静态资源进行缓存，缓存机制如下</p>
<ol>
<li>浏览器对首次响应后的静态资源本体暂存起来，并记录下这个静态资源的URL</li>
<li>当下次再发起同样的静态资源请求时，先从缓存区匹配URL，找到立即响应缓存的本体内容，不向服务器请求。</li>
</ol>
</li>
<li><p><strong>跳过浏览器静态资源缓存机制</strong>：添加一个动态的任意请求参数改变URL即可。</p>
</li>
</ul>
<h4 id="JavaScript方案"><a href="#JavaScript方案" class="headerlink" title="JavaScript方案"></a>JavaScript方案</h4><p>解决的做法就是”用JavaScript控制Form表单只能提交一次”，或提交一次按钮就不可用。</p>
<ul>
<li><strong>form.jsp</strong></li>
<li><strong>单次提交</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Form表单&lt;/title&gt;</span><br><span class="line">        &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        <span class="keyword">var</span> isCommitted = <span class="keyword">false</span>;<span class="comment">//表单是否已经提交标识，默认为false</span></span><br><span class="line">        <span class="function">function <span class="title">dosubmit</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(isCommitted==<span class="keyword">false</span>)&#123;</span><br><span class="line">                isCommitted = <span class="keyword">true</span>;<span class="comment">//提交表单后，将表单是否已经提交标识设置为true</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//返回true让表单正常提交</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;<span class="comment">//返回false那么表单将不提交</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">      &lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/servlet/DoFormServlet&quot;</span> onsubmit=<span class="string">&quot;return dosubmit()&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span> id=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>除了用这种方式之外，经常见的另一种方式就是表单提交之后，将提交按钮设置为不可用，让用户没有机会点击第二次提交按钮，代码如下：</p>
<ul>
<li><strong>form.jsp</strong></li>
<li>按钮设置为不可用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dosubmit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//获取表单提交按钮</span></span><br><span class="line">    <span class="keyword">var</span> btnSubmit = <span class="built_in">document</span>.getElementById(<span class="string">&quot;submit&quot;</span>);</span><br><span class="line">    <span class="comment">//将表单提交按钮设置为不可用，这样就可以避免用户再次点击提交按钮</span></span><br><span class="line">    btnSubmit.disabled= <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">    <span class="comment">//返回true让表单可以正常提交</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="回退重复提交"><a href="#回退重复提交" class="headerlink" title="回退重复提交"></a>回退重复提交</h2><ul>
<li><p><strong>说明</strong>：用户正常提交服务器。服务器也没有延迟，但是提交完成后，用户点击回退键回退上一个操作后继续重新提交，也会造成表单重复提交。</p>
</li>
<li><p><strong>场景复现</strong>：回退直接点击浏览器的<code>&lt;-</code>按钮或者按下键盘<code>Backspace</code>按钮再提交可看到</p>
</li>
<li><p><strong>引发的问题</strong>：此时重复提交的问题是用户行为上的一个误导，所造成的操作冗余，间接造成的资源浪费。</p>
<blockquote>
<p>例如：用户进入购物网站下单前需登录，登录后用户无意中进行了回退操作。此时用户看到了一个完整的需要登录的界面，常误认为就是网站系统需用户再次进行登录操作，一般用户就会再次输入信息登录。其实当用户按下回退键时，登录状态并没有被注销，用户可以操作浏览器[前进键]或直接访问需要登录后才能访问的页面都是允许的，即用户第二次的登录操作时多余的，一定程度上间接地加大了服务器的压力(比不要的操作/请求更多了)</p>
</blockquote>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E5%90%8E%E9%80%80%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4%E7%A4%BA%E6%84%8F%E5%8A%A8%E6%80%81%E5%9B%BE.gif"
                     
                ></p>
<h3 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案"></a>解决方案</h3><p>采用”网络延迟重复提交“的Session-Token信息对称解决方案。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li><p><strong>间接重复提交</strong>：请求转发刷新重复提交</p>
<ul>
<li><strong>引发的问题</strong>：避免的是<strong>非用户主观意愿</strong>(刷新)带来的操作冗余。</li>
<li><strong>解决方案</strong>：将涉及增删改操作的接口的<strong>成功响应</strong>使用<strong>重定向</strong>，<strong>失败响应</strong>使用<strong>转发</strong>。</li>
</ul>
</li>
<li><p><strong>直接重复提交</strong>：</p>
<ul>
<li><p><strong>网络延迟重复提交</strong>：</p>
<ul>
<li><p><strong>引发的问题</strong>：真正避免的是，连续<strong>发起多个</strong>处于<code>State=(pending)</code>(<strong>等待</strong>)状态下的<strong>同一请求</strong>而带来的资源浪费与操作冗余。而pending状态下发起不同的请求是常规允许的操作场景。</p>
</li>
<li><p><strong>解决方案</strong>：Session-Token对称验证</p>
<blockquote>
<p>Session-Token对称验证是，通过信息对称判断，强制业务流程按序进行(过滤非法业务流程操作)</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>回退重复提交</strong>：</p>
<ul>
<li>引发的问题：此时重复提交的问题是用户行为上的一个误导，所造成的操作冗余，间接造成的资源浪费。</li>
<li><strong>解决方案</strong>：Session-Token对称验证</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="同一表单不同请求"><a href="#同一表单不同请求" class="headerlink" title="同一表单不同请求"></a>同一表单不同请求</h1><h2 id="场景说明"><a href="#场景说明" class="headerlink" title="场景说明"></a>场景说明</h2><ul>
<li>假如存在一个图书后台管理界面，有两个超链接按钮分别为：”添加图书”、”修改图书”</li>
<li>由于信息提交页面类似，现在规定这两个功能都跳转到同一个表单页面上，但又需要各自完成各自的功能</li>
<li>假设是通过传递action值来控制访问不同的接口，因此可以通过修改action的值来实现不同接口的访问，问题在于基于什么去动态修改action值。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;manager/bookServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;action&quot;</span> <span class="attr">value</span>=<span class="string">&quot;动态&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="解决方案-3"><a href="#解决方案-3" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="增加请求参数做标识"><a href="#增加请求参数做标识" class="headerlink" title="增加请求参数做标识"></a>增加请求参数做标识</h3><p>使用的前提是，超链接或是请求的转发，需保证页面跳转后是请求的URL</p>
<ol>
<li><p>分别为，”添加图书”，”修改图书“两个超链接请求添加一个新的请求参数<code>method</code>，如<code>xxx/book_edit.jsp?method=add</code>或<code>xxx/book_edit.jsp?method=update</code></p>
</li>
<li><p>通过JSP/EL表达式的<code>param</code>获取这个请求参数标识，修改action的值。(范式URL上存在的请求参数param都能获取)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;manager/bookServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;&#123;param.method&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="判断不同业务URL情况"><a href="#判断不同业务URL情况" class="headerlink" title="判断不同业务URL情况"></a>判断不同业务URL情况</h3><p>如当前”修改图书”操作URL上含id请求参数，而”添加图书”业务URL上没有id参数，因此在JSP页面可以通过判断是否存在id请求参数作为判断业务的标识。</p>
<ul>
<li>JSP/EL判断</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;manager/bookServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;&#123;empty param.id ? &quot;</span>add<span class="string">&quot; : &quot;</span>update<span class="string">&quot;&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h3 id="判断不同业务的隐藏域情况"><a href="#判断不同业务的隐藏域情况" class="headerlink" title="判断不同业务的隐藏域情况"></a>判断不同业务的隐藏域情况</h3><p>由于”修改图书“操作需要向后端先请求修改图书原本的数据，因此request域是存在数据的。而”添加图书“是不用向后端请求任何数据。request域为空，因此可以通过判断request域识别业务类型。</p>
<ul>
<li>JSP/EL判断</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;manager/bookServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;$&#123;empty requestScope.book ? &quot;</span>add<span class="string">&quot; : &quot;</span>update<span class="string">&quot;&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h1 id="分页技术"><a href="#分页技术" class="headerlink" title="分页技术"></a>分页技术</h1><h2 id="基本概念-3"><a href="#基本概念-3" class="headerlink" title="基本概念"></a>基本概念</h2><p>分页功能在网页中是非常常见的一个功能，其作用也就是将<strong>数据分割成多个页面来进行显示</strong>。</p>
<ul>
<li><p><strong>使用场景</strong>：当取到的数据量达到一定的时候，就需要使用<strong>分页来进行数据分割</strong>。</p>
</li>
<li><p>不使用分页所<strong>面临的问题</strong></p>
<ul>
<li><strong>客户端</strong>：若数据量太多，都显示在同一个页面的话，会因为页面太长严重影响到用户的体验，也<strong>不便于操作</strong>，也会出现<strong>加载太慢</strong>的问题。</li>
<li><strong>服务端</strong>：如果数据量太多，可能会造成<strong>内存溢出</strong>，而且一次请求<strong>携带的数据太多</strong>，对<strong>服务器的性能</strong>也是一个考验。</li>
</ul>
</li>
<li><p><strong>常见分页实例</strong></p>
<ul>
<li>淘宝</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210526163724.png"
                     
                ></p>
<ul>
<li>百度</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210526164146.png"
                     
                ></p>
</li>
</ul>
<h2 id="分页的分类"><a href="#分页的分类" class="headerlink" title="分页的分类"></a>分页的分类</h2><p>分页的实现分为<strong>真分页</strong>(物理分页)和<strong>假分页</strong>(逻辑分页)两种。</p>
<ol>
<li><strong>真分页</strong>(物理分页)<ul>
<li><strong>实现原理</strong>：<code>SELECT * FROM xxx [WHERE...] LIMIT #&#123;paran1&#125;，#&#123;paran2&#125;</code></li>
<li><strong>优点</strong>：不会造成内存溢出</li>
<li><strong>缺点</strong>：翻页的速度比较慢</li>
</ul>
</li>
<li><strong>假分页</strong>(逻辑分页)<ul>
<li><strong>实现原理</strong>：一次性将所有的数据查询出来放在内存之中，每次需要查询的时候就直接从内存之中去取出相应索引区间的数据</li>
<li><strong>优点</strong>：分页速度比较快</li>
<li><strong>缺点</strong>：可能造成内存溢出</li>
</ul>
</li>
</ol>
<blockquote>
<p>分页基本概念与分类引用：<a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/wmyskxz/p/8945693.html" >https://www.cnblogs.com/wmyskxz/p/8945693.html<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<h2 id="后端设计"><a href="#后端设计" class="headerlink" title="后端设计"></a>后端设计</h2><p>当前以<strong>真分页</strong>为主介绍原生方案</p>
<h3 id="分页模型"><a href="#分页模型" class="headerlink" title="分页模型"></a>分页模型</h3><p>一般实现分页操作要建立一个分页模型对象Page类，一般含如下属性，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAGE_SIZE = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pageNo;<span class="comment">//当前页码：</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pageTotal;<span class="comment">//总页码</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pageTotalCount;<span class="comment">//总记录数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pageSize = PAGE_SIZE;<span class="comment">//每页显示的数量</span></span><br><span class="line"><span class="keyword">private</span> List&lt;T&gt; items;<span class="comment">//分页后的数据集</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>pageNo</strong>：当前页码一般由<strong>用户提供</strong>给后端。</p>
</li>
<li><p><strong>pageSize</strong>：每页显示数量一般有两种来源</p>
<ol>
<li>由<strong>用户进行传递</strong>，如百度搜索中可设置每页返回的条目数量</li>
<li>由页面布局决定，由<strong>前端工程师</strong>决定(后端设定)。</li>
</ol>
</li>
<li><p><strong>pageTotalCount</strong>：总记录数可通过<strong>sql语句</strong>查询得出</p>
<ul>
<li><code>select count(*) from table;</code></li>
</ul>
</li>
<li><p><strong>pageTotal</strong>：总页码数可通过pageSize与pageTotalCount计算得出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> pageTotal = pageTotalCount / pageSize;</span><br><span class="line"><span class="keyword">if</span>(pageTotalCount % pageSize != <span class="number">0</span>)&#123;<span class="comment">//若不能整除</span></span><br><span class="line">    pageTotal++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>items</strong>：当前分页后的数据集，有<strong>sql语句</strong>查询得出</p>
<ul>
<li><code>select * from table limit begin,end;</code></li>
<li><strong>begin</strong>：<code>begin  = (pageNo - 1) * pageSize;</code></li>
<li><strong>end</strong>：<code>end = pageSize;</code></li>
</ul>
</li>
</ul>
<p>Page模型类只是封装分页操作的关键属性支持，分页操作的关键在于如何把这些属性进行设定。在Web应用开发中，这种核心的逻辑处理由<strong>Service层负责</strong>。</p>
<h3 id="置顶向下实现"><a href="#置顶向下实现" class="headerlink" title="置顶向下实现"></a>置顶向下实现</h3><p>开发中可以采用置顶向下的开发顺序即，从Servlet层、Service层、dao层，从用户需求往下展开实现。利于编码。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/java%E5%8E%9F%E7%94%9F%E7%9C%9F%E5%88%86%E9%A1%B5.png"
                     
                ></p>
<h3 id="Servlet层"><a href="#Servlet层" class="headerlink" title="Servlet层"></a>Servlet层</h3><ul>
<li><strong>com.website.web.BookServlet</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//响应指定分页信息的数据</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1、获取请求页码和页码数量(默认是第1页、每页Page.PAGE_SIZE 4 项内容)</span></span><br><span class="line">    <span class="keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageNo&quot;</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> pageSize = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageSize&quot;</span>),Page.PAGE_SIZE);</span><br><span class="line">    <span class="comment">//2、调用bookService.page(pageNo,pageSize);方法获取分页后的数据</span></span><br><span class="line">    Page&lt;Book&gt; page = bookService.page(pageNo,pageSize);</span><br><span class="line">    <span class="comment">//3、把分页后的数据存储到request域中</span></span><br><span class="line">    req.setAttribute(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">    <span class="comment">//4、请求转发到 /pages/manager/book_manager.jsp页面中</span></span><br><span class="line">    req.getRequestDispatcher(<span class="string">&quot;/pages/manager/book_manager.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Service层"><a href="#Service层" class="headerlink" title="Service层"></a>Service层</h3><ul>
<li><strong>com.website.service.BookService</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//.......</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前分页对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNo 请求页号：1 ~ MAX</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize 每页条目数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Page&lt;Book&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.service.impl.BookServiceImp</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Book&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">    Page&lt;Book&gt; page = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    <span class="comment">//1、设置请求页码数</span></span><br><span class="line">    <span class="comment">//不可封装到setPageNo中，如输入 10 ，此时 pageTotal == 0 则 10 &gt; 0 被赋予0，</span></span><br><span class="line">    <span class="comment">//协定一个方案，如若用户输入数字 &lt; 1，则显示首页，&gt; 总页数则显示尾页</span></span><br><span class="line">    <span class="keyword">if</span>(pageNo &lt; <span class="number">1</span>)&#123;</span><br><span class="line">        pageNo = <span class="number">1</span>;<span class="comment">//因为total后面才能赋值，则放到最后在setPageNo</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2、设置每页条目数</span></span><br><span class="line">    page.setPageSize(pageSize);</span><br><span class="line">    <span class="comment">//3、设置数据总量，如果查询结果为0，会引发bug</span></span><br><span class="line">    <span class="keyword">int</span> pageTotalCount = dao.queryForPageTotalCount();</span><br><span class="line">    page.setPageTotalCount(pageTotalCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4、设置总页码数</span></span><br><span class="line">    <span class="keyword">int</span> pageTotal = pageTotalCount / pageSize;</span><br><span class="line">    <span class="keyword">if</span>(pageTotalCount % pageSize != <span class="number">0</span>)&#123;<span class="comment">//若不能整除</span></span><br><span class="line">        pageTotal++;</span><br><span class="line">    &#125;</span><br><span class="line">    page.setPageTotal(pageTotal);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pageNo &gt; pageTotal)&#123;<span class="comment">//外层调用必须按序先给</span></span><br><span class="line">        pageNo = pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line">    page.setPageNo(pageNo);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//5、设置分页查询后的数据集</span></span><br><span class="line">    <span class="keyword">int</span> begin = (pageNo - <span class="number">1</span>) * pageSize;</span><br><span class="line">    List&lt;Book&gt; items = dao.queryForItems(begin,pageSize);</span><br><span class="line">    page.setItems(items);</span><br><span class="line">    <span class="comment">//6、返回Page对象</span></span><br><span class="line">    <span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="dao层"><a href="#dao层" class="headerlink" title="dao层"></a>dao层</h3><ul>
<li><strong>com.website.dao.BookDao</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">queryForPageTotalCount</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">queryForItems</span><span class="params">(<span class="keyword">int</span> begin,<span class="keyword">int</span> end)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.dao.impl.BookDaoImp</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">queryForPageTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;SELECT COUNT(*) FROM t_book&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> ((Number) queryForValue(sql)).intValue();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryForItems</span><span class="params">(<span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;select id,name,price,author,sales,stock,img_path imgPath from t_book limit ?,?&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> queryForList(Book.class,sql,begin,end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="前端设计"><a href="#前端设计" class="headerlink" title="前端设计"></a>前端设计</h2><p>这里指的前端设计是一些部署到前端页面上的后端代码<strong>JSP</strong>(EL,JSTL)，和<strong>javaScript</strong>代码。</p>
<h3 id="布局代码"><a href="#布局代码" class="headerlink" title="布局代码"></a>布局代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;page_nav&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        【4】</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>末页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        共10页，30条记录 到第<span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pn_input&quot;</span>/&gt;</span>页</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;确定&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="首尾与上下页"><a href="#首尾与上下页" class="headerlink" title="首尾与上下页"></a>首尾与上下页</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- 大于<span class="number">1</span>页才允许出现首页和上一页操作 --%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageNo &gt; 1&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=1&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;requestScope.page.pageNo - 1&#125;&quot;&gt;上一页&lt;/a&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">&lt;%-- 若是最后一页则不显示下一页和莫页 --%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageNo &lt; requestScope.page.pageTotal&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;requestScope.page.pageNo + 1&#125;&quot;&gt;下一页&lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;requestScope.page.pageTotal&#125;&quot;&gt;末页&lt;/a&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>

<h3 id="跳转页"><a href="#跳转页" class="headerlink" title="跳转页"></a>跳转页</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//页面加载完成后</span></span><br><span class="line">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;input.searchPageBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">//1、获取输入的页码(忽略非法输入情况)</span></span><br><span class="line">            <span class="keyword">var</span> pageNo = $(<span class="string">&quot;#pn_input&quot;</span>).val();</span><br><span class="line">            <span class="comment">//2、javaScript语言中提供了一个location地址栏对象，</span></span><br><span class="line">            <span class="comment">//其中具备一个名为href属性，可以对浏览器地址栏操作，可读可写</span></span><br><span class="line">            <span class="comment">//读href属性：获取当前浏览器URL内容</span></span><br><span class="line">            <span class="comment">//写href属性：替换当前浏览器URL并直接在当前页面访问(GET请求)</span></span><br><span class="line">            location.href = <span class="string">&quot;manager/bookServlet?action=page&amp;pageNo=&quot;</span> + pageNo;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="范围页"><a href="#范围页" class="headerlink" title="范围页"></a>范围页</h3><h4 id="功能需求"><a href="#功能需求" class="headerlink" title="功能需求"></a>功能需求</h4><p>能显示若干个(5)个连续的页码，而且当前页码在中间。除了当前页码之外，每个页码都可以点击跳到指定页。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210526164444.png"
                     
                ></p>
<h4 id="情况分析"><a href="#情况分析" class="headerlink" title="情况分析"></a>情况分析</h4><ul>
<li><strong>showPageCount</strong>：<strong>拟显示页码数</strong>，即上图所示，“1，2，3，4，5“，共显示5个页码。一般为了布局对称，选取<strong>奇数</strong>。</li>
<li><strong>pageTotal</strong>：总页码数</li>
<li><strong>pageNo</strong>：当前页码数</li>
</ul>
<ol>
<li><p><strong>情况1</strong>：<strong>pageTotal</strong> ≤ <strong>showPageCount</strong>，如总页码数只有3页，而拟显示5个页码</p>
<ul>
<li><strong>访问范围</strong>：<code>1 ~ pageTotal</code>，即把持有的所有页号全部显示</li>
<li><strong>页码范围</strong>：<code>1 ~ pageTotal</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">只有1页：【1】</span><br><span class="line">只有2页：【1】，2</span><br><span class="line">        1，【2】，</span><br><span class="line">只有3页：1，【2】，3】</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>代码实现</strong>：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;%-- 情况<span class="number">1</span>：总页码数 &lt;= 拟显示页码数 --%&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &lt;= 5&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;c:forEach begin=<span class="string">&quot;1&quot;</span> end=<span class="string">&quot;$&#123;requestScope.page.pageTotal&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i != requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;i&#125;&quot;&gt;$&#123;i&#125;&lt;/a&gt;</span><br><span class="line">            &lt;/c:if&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i == requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                【$&#123;i&#125;】</span><br><span class="line">            &lt;/c:if&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>情况2</strong>：<strong>pageTotal</strong>  ＞ <strong>showPageCount</strong>，如总页码数多达<strong>10页</strong>，而拟显示<strong>5个</strong>页码</p>
<ul>
<li><p>情况2细分三种情况图示如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210526214347.png"
                     
                ></p>
</li>
</ul>
<ol>
<li><p>情况2.1：当前访问页处于<strong>页码首部</strong>，且小于等于<strong>拟显示页码范围</strong>的<strong>前半段</strong>时，显示页码<strong>范围固定</strong></p>
<ul>
<li><strong>访问范围</strong>：<code>pageNo ≤ (showPageCount/2 + 1)</code></li>
<li><strong>页码范围</strong>：<code>1 ~ showPageCount </code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;如上例子参数，showPageCount &#x3D; 5</span><br><span class="line">&#x2F;&#x2F;showPageCount&#x2F;2 + 1 &#x3D; 3，则在访问1~3页时，页码的访问访问不变，保持在1~5访问</span><br><span class="line">【1】2，3，4，5</span><br><span class="line">1【2】3，4，5</span><br><span class="line">1，2【3】4，5</span><br><span class="line">&#x2F;&#x2F;如访问第4页时应该展示的序列为(发生变化)：2，3【4】，5，6</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>代码实现</strong>：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;%-- 情况<span class="number">1</span>：总页码数 &lt;= 拟显示页码数 --%&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &lt;= 5&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;%-- .... --%&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%-- 情况<span class="number">2</span>：总页码数 &gt; 拟显示页码数 --%&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &gt; 5&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;c:choose&gt;</span><br><span class="line">            &lt;%-- 情况<span class="number">2.1</span>：当前访问页处于页码首部，且小于等于拟显示页码范围的前半段时%&gt;</span><br><span class="line">            &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageNo &lt;= (3)&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;c:forEach begin=<span class="string">&quot;1&quot;</span> end=<span class="string">&quot;5&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i != requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                        &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;i&#125;&quot;&gt;$&#123;i&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i == requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                        【$&#123;i&#125;】</span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/c:when&gt;</span><br><span class="line">        &lt;/c:choose&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>情况2.2：当前访问页处于<strong>页码尾部</strong>，且大于等于<strong>拟显示页码范围</strong>的<strong>后半段</strong>时，显示页码<strong>范围固定</strong></p>
<ul>
<li><strong>访问范围</strong>：<code>pageTotal - showPageCount/2 ≤ pageNo ≤ pageToal </code></li>
<li><strong>页码范围</strong>：<code>pageTotal - showPageCount + 1 ~ pageTotal </code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;如上例子参数，showPageCount &#x3D; 5、pageTotal &#x3D; 10</span><br><span class="line">&#x2F;&#x2F;pageTotal - showPageCount&#x2F;2 &#x3D; 8，则在访问8~10页时，页码的访问访问不变，保持在6~10访问</span><br><span class="line">6，7，8，9【10】</span><br><span class="line">6，7，8【9】，10</span><br><span class="line">6，7【8】，9，10</span><br><span class="line">&#x2F;&#x2F;如访问第7页时应该展示的序列为(发生变化)：5，6【7】，8，9</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>代码实现</strong>：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;%-- 情况<span class="number">1</span>：总页码数 &lt;= 拟显示页码数 --%&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &lt;= 5&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;%-- .... --%&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%-- 情况<span class="number">2</span>：总页码数 &gt; 拟显示页码数 --%&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &gt; 5&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;c:choose&gt;</span><br><span class="line">            &lt;%--情况<span class="number">2.2</span> 当前访问页处于页码尾部，且大于等于拟显示页码范围的后半段时--%&gt;</span><br><span class="line">            &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageNo &gt;= (8)&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;c:forEach begin=<span class="string">&quot;$&#123;requestScope.page.pageTotal - 5 + 1&#125;&quot;</span> end=<span class="string">&quot;$&#123;requestScope.page.pageTotal&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i != requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                        &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;i&#125;&quot;&gt;$&#123;i&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i == requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                        【$&#123;i&#125;】</span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/c:when&gt;</span><br><span class="line">        &lt;/c:choose&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>情况2.3：即除上述情况外，当前访问页处于<strong>首尾</strong>拟显示页码数访问范围的<strong>后前半段之间</strong>。即处于<strong>中中部</strong>。</p>
<ul>
<li><strong>访问范围</strong>：<code>(showPageCount/2 + 2) ≤ pageNo ≤ (pageTotal - showPageCount/2 - 1)</code></li>
<li>一般不判断情况3的访问范围，除上述两种之外的条件就是情况3</li>
<li><strong>页码范围</strong>：<code>(pageNo - showPageCount/2) ~ (pageNo + showPageCount/2) </code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;如上例子参数，showPageCount &#x3D; 5、pageTotal &#x3D; 10</span><br><span class="line">   &#x2F;&#x2F;(showPageCount&#x2F;2 + 1) ≤ pageNo ≤ (pageTotal - showPageCount&#x2F;2)，</span><br><span class="line">   &#x2F;&#x2F;则在访问4~7页时，页码的访问变化，(pageNo - 2) ~ (pageNo + 2)</span><br><span class="line">   2，3，【4】，5，6</span><br><span class="line">   3，4，【5】，6，7</span><br><span class="line">   4，5，【6】，7，8</span><br><span class="line">   5，6，【7】，8，9</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>代码实现</strong>：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- 一般配合上述两种情况最后作为一个<span class="keyword">else</span>/<span class="keyword">default</span>/otherwise条件处理 --%&gt;</span><br><span class="line">   &lt;c:choose&gt;</span><br><span class="line">       &lt;%-- 情况<span class="number">1</span>：总页码数 &lt;= 拟显示页码数 --%&gt;</span><br><span class="line">       &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &lt;= 5&#125;&quot;</span>&gt;</span><br><span class="line">           &lt;%-- .... --%&gt;</span><br><span class="line">       &lt;/c:when&gt;</span><br><span class="line">   </span><br><span class="line">       &lt;%-- 情况<span class="number">2</span>：总页码数 &gt; 拟显示页码数 --%&gt;</span><br><span class="line">       &lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &gt; 5&#125;&quot;</span>&gt;</span><br><span class="line">           &lt;c:choose&gt;</span><br><span class="line">               &lt;%-- </span><br><span class="line">       			情况<span class="number">2.3</span>：即除上述情况外，当前访问页处于首尾拟</span><br><span class="line">       			显示页码数访问范围的后前半段之间。即处于中中部 </span><br><span class="line">       		--%&gt;</span><br><span class="line">               &lt;c:otherwise&gt;</span><br><span class="line">                   &lt;c:forEach begin=<span class="string">&quot;$&#123;requestScope.page.pageNo - 2&#125;&quot;</span> end=<span class="string">&quot;$&#123;requestScope.page.pageNo + 2&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">                       &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i != requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                           &lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;i&#125;&quot;&gt;$&#123;i&#125;&lt;/a&gt;</span><br><span class="line">                       &lt;/c:if&gt;</span><br><span class="line">                       &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i == requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">                           【$&#123;i&#125;】</span><br><span class="line">                       &lt;/c:if&gt;</span><br><span class="line">                   &lt;/c:forEach&gt;</span><br><span class="line">               &lt;/c:otherwise&gt;</span><br><span class="line">               </span><br><span class="line">           &lt;/c:choose&gt;</span><br><span class="line">       &lt;/c:when&gt;</span><br><span class="line">   &lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ol>
<h2 id="增删改分页调整"><a href="#增删改分页调整" class="headerlink" title="增删改分页调整"></a>增删改分页调整</h2><p>若按上述实现过程，无论在对哪一页的数据项进行增删改之后都是跳转到首页。为了用户体验更好，应实现如下效果。</p>
<ul>
<li>实现的<strong>前提</strong>是：后端已经具备若前端传送页码大于总页码数默认跳转到尾页的后端功能。</li>
</ul>
<ol>
<li><p><strong>删除与修改</strong>：</p>
<ul>
<li><p>效果：删除或修改指定一页中的数据项后，刷新回到该页。</p>
</li>
<li><p>实现：在删除与修改操作的前端请求中传送<strong>当前页码</strong>数据即可。对应后端的删改操作请求转发到page时也需把新的转发数据转发过去。</p>
<blockquote>
<p>当前页删除跳回当前页，若尾页部分删除消失一页则会因传送页码大于实际页码总数而默认跳到最新的尾页。</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>增加</strong>：</p>
<ul>
<li>效果：增加数据项后，应跳转到尾页。</li>
<li>实现：在增加操作前端请求中传送 (<strong>当前页码+1</strong>)的数据，使其总是跳转到最后一页。对应后端的增加操作请求转发到page时也需把新的转发数据转发过去。</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>代码实现</strong>：基于本文分页的实例项目结构的代码实现</p>
<ul>
<li><p><strong>删除</strong>：由于删除一个操作，接收参即可</p>
<ul>
<li><strong>book_manager.jsp</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;a class=&quot;deleteClass&quot; href=&quot;manager/bookServlet?action=delete&amp;id=$&#123;book.id&#125;&amp;pageNo=$&#123;requestScope.page.pageNo&#125;&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.web.BookServlet.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">     <span class="comment">//省略代码....</span></span><br><span class="line">    resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/manager/bookServlet?action=page&amp;pageNo=&quot;</span> + req.getParameter(<span class="string">&quot;pageNo&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改</strong>：</p>
<ul>
<li><strong>book_manager.jsp</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;a href=&quot;manager/bookServlet?action=getBook&amp;id=$&#123;book.id&#125;&amp;pageNo=$&#123;requestScope.page.pageNo&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>book_edit.jsp</strong>：由于删除和修改都是先跳转到一个页码上再提交给后端的。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;main&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;manager/bookServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;pageNo&quot;</span> value=<span class="string">&quot;$&#123;param.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 省略代码..... --&gt; </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.web.BookServlet.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同删除部分代码修改</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>增加</strong>：</p>
<ul>
<li><strong>book_manager.jsp</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;a href=&quot;pages/manager/book_edit.jsp?pageNo=$&#123;requestScope.page.pageTotal&#125;&quot;&gt;添加图书&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>book_edit.jsp</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- 同修改操作代码部分修改 --%&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>com.website.web.BookServlet.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//补充分页增加部分</span></span><br><span class="line">    <span class="keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageNo&quot;</span>), <span class="number">0</span>);</span><br><span class="line">    pageNo++;<span class="comment">//添加后总是显示到尾页</span></span><br><span class="line">    <span class="comment">//省略代码....</span></span><br><span class="line">    resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/manager/bookServlet?action=page&amp;pageNo=&quot;</span> + pageNo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="代码的抽取"><a href="#代码的抽取" class="headerlink" title="代码的抽取"></a>代码的抽取</h2><p>由于分页代码有极高的相似度，若读取的数据都一样，则不同页面上实用分页代码只有，访问的Servlet地址不一样而已。因此可以有效的进行代码抽取。<strong>开发中常用</strong>！</p>
<ol>
<li>将Page模型添加一个<strong>分页url</strong>属性，抽取至<code>client/clientBookServlet?action=page</code>。即含Servlet也含分页方法(因为存在同一Servlet不同分页函数的情况)</li>
<li>在不同的分页Servlet中设置与之对应的分页url</li>
<li>将前端分页代码抽取出来，统一通过动态获分页URL的方式访问。</li>
</ol>
<h2 id="区间查询分页"><a href="#区间查询分页" class="headerlink" title="区间查询分页"></a>区间查询分页</h2><p>总体上和普通的数据分页一样，只是要对应再建立一个架构而已。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210529203014.png"
                     
                ></p>
<h1 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h1><p>验证码可以防止恶意破解密码、刷票、论坛灌水、刷页等非法操作，是Web非常常用的验证机制之一。</p>
<h2 id="Kaptcha-1"><a href="#Kaptcha-1" class="headerlink" title="Kaptcha"></a>Kaptcha</h2><p>Google Kaptcha图片验证是一个可高度配置的实用验证码生成工具，可自由配置的选项如：</p>
<ul>
<li>验证码的字体</li>
<li>验证码字体的大小</li>
<li>验证码字体的字体颜色</li>
<li>验证码内容的范围(数字，字母，中文汉字！)</li>
<li>验证码图片的大小，边框，边框粗细，边框颜色</li>
<li>验证码的干扰线</li>
<li>验证码的样式(鱼眼样式、3D、普通模糊、…)</li>
<li>…</li>
</ul>
<h2 id="使用步骤-1"><a href="#使用步骤-1" class="headerlink" title="使用步骤"></a>使用步骤</h2><p>Kaptcha的使用是直接使用其生成验证码的Servlet程序，配置后直接是一个URL接口。</p>
<ol>
<li><p>导入Google验证码的jar包：<strong>kaptcha-2.3.2.jar</strong></p>
</li>
<li><p>在web.xml中去配置用于<strong>生成验证码</strong>的<strong>Servlet</strong>程序访问的<strong>URL</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530213709.png"
                     
                ></p>
</li>
<li><p><strong>前端页面</strong>获取验证码：直接访问Servlet配置URL，如上所例配置URL为<code>ip:port/工程项目名/kaptcha.jpg</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &lt;form action=<span class="string">&quot;http://localhost:8080/13_RepeatSubmit/registServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">     用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> &gt; &lt;br&gt;</span><br><span class="line">     验证码：&lt;input type=<span class="string">&quot;text&quot;</span> style=<span class="string">&quot;width: 60px;&quot;</span> name=<span class="string">&quot;code&quot;</span>&gt;</span><br><span class="line">     &lt;img src=<span class="string">&quot;http://localhost:8080/13_RepeatSubmit/kaptcha.jpg&quot;</span> alt=<span class="string">&quot;&quot;</span> style=<span class="string">&quot;width: 100px; height: 28px;&quot;</span>&gt; &lt;br&gt;</span><br><span class="line">     &lt;input id=<span class="string">&quot;count&quot;</span> type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;requestCount&quot;</span> value=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">     &lt;input id=<span class="string">&quot;submit&quot;</span> type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>效果如下图所示：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530214531.png"
                     
                ></p>
</li>
<li><p><strong>后端Servlet</strong>获取验证码数据：kaptcha生成验证码的Servlet程序被调用后有自动完成下述三个操作</p>
<ul>
<li><p>自动生成随机的验证码</p>
</li>
<li><p>自动并生成验证码图片</p>
</li>
<li><p>自动把验证码<strong>保存到Session域</strong>中</p>
<ul>
<li>kaptcha有专门存储常量的类Constants，里面<code>KAPTCHA_SESSION_KEY</code>即是存储在Session域中验证码Key值</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210530222250.png"
                     
                ></p>
</li>
<li><p>后端直接通过Session域即可获取</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String token = (String)req.getSession().getAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="刷新验证码-1"><a href="#刷新验证码-1" class="headerlink" title="刷新验证码"></a>刷新验证码</h2><ul>
<li><p>通过JS为验证码图片添加点击事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给验证码的图片，绑定单击事件</span></span><br><span class="line">$(<span class="string">&quot;#code_img&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//在事件响应的 function 函数中有一个 this 对象。这个 this 对象，是当前正在响应事件的 dom 对象</span></span><br><span class="line"><span class="comment">//src 属性表示验证码 img 标签的图片路径。它可读，可写</span></span><br><span class="line"><span class="comment">//当对img的src修改时(写操作)，img标签将会重新加载图片(重新发起get请求获取图片)</span></span><br><span class="line"><span class="comment">//添加一个动态的任意请求参数是为了防止某些浏览器的缓存机制导致不能多次点击更新</span></span><br><span class="line"><span class="built_in">this</span>.src = <span class="string">&quot;$&#123;basePath&#125;kaptcha.jpg?d=&quot;</span> + <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>浏览器<strong>静态资源</strong>缓存机制：</p>
<p>某些浏览器为了加快响应速度，常常对静态资源进行缓存，缓存机制如下</p>
<ol>
<li>浏览器对首次响应后的静态资源本体暂存起来，并记录下这个静态资源的URL</li>
<li>当下次再发起同样的静态资源请求时，先从缓存区匹配URL，找到立即响应缓存的本体内容，不向服务器请求。</li>
</ol>
</li>
<li><p><strong>跳过浏览器静态资源缓存机制</strong>：添加一个动态的任意请求参数改变URL即可。</p>
</li>
</ul>
<h1 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h1><ul>
<li>在配置Servlet程序URL地址定义时，应有意地借助在URL中添加额外的字符串信息用来将请求范围进行归类</li>
<li>分类方式多种，可按范围、资源类型、访问权限等分类</li>
<li>主要目的是方便后续通过Filter过滤器做进一步分离处理。</li>
</ul>
<hr>
<p>例如：按用户权限类型进行分类，</p>
<ul>
<li>普通用户操作的资源或Servlet程序则在URL冠以<code>client/</code>标识，如<code>/manager/bookServlet</code></li>
<li>管理员用户则冠以<code>manager</code>标识。如<code>/client/clientBookServlet</code></li>
<li>最后Filter可以以<code>/client/*</code>或<code>/manner/*</code>清晰地实现拦截。</li>
</ul>
<h1 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h1><h2 id="基本概念-4"><a href="#基本概念-4" class="headerlink" title="基本概念"></a>基本概念</h2><p>一个功能的实现往往需要一次性修改多次数据库数据，而这些多次修改操作必须保证要么全执行，要么全部不执行，这就是一个事务。如用户结算购物车中的产品生成订单的功能，涉及的操作如下：</p>
<ul>
<li>模拟生成购物订单操作，凸显事务作用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.affair;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟生成购物订单操作，凸显事务作用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-01 9:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    Dao dao = <span class="keyword">new</span> Dao();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        dao.updateGoods();<span class="comment">//修改数据库中商品中的销量和库存量</span></span><br><span class="line"></span><br><span class="line">        dao.createOrder();<span class="comment">//在数据库中创建订单信息数据</span></span><br><span class="line">        <span class="comment">//int i = 12 / 0;</span></span><br><span class="line">        <span class="comment">//若程序在允许过程中出错，则数据库的库存销量被修改，订单</span></span><br><span class="line">        <span class="comment">//也被生成，而订单中的商品信息却没生成，从而导致数据库数据操作不对称，是致命的错误。</span></span><br><span class="line">        <span class="comment">//必须用事务控制整个createOrder操作要么执行要么全部不执行</span></span><br><span class="line">        </span><br><span class="line">        dao.createOrderItem();<span class="comment">//在数据库中创建订单商品项信息数据</span></span><br><span class="line">        System.out.println(<span class="string">&quot;订单成功生成！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> OrderService().createOrder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dao</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改数据库中商品中的销量和库存量&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;在数据库中创建订单信息数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;在数据库中创建订单商品项信息数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="事务管理设计"><a href="#事务管理设计" class="headerlink" title="事务管理设计"></a>事务管理设计</h2><p>在设计之前，概括以下食物控制实现的几大要点，第<strong>1,2</strong>点属于<strong>数据库事务机制</strong>的要求，第<strong>3,4</strong>点属于对<strong>业务</strong>进行<strong>事务控制的基本逻辑</strong>。</p>
<ol>
<li><strong>手动管理</strong>：设置为<strong>手动管理事务</strong>模式</li>
<li><strong>同一连接</strong>：事务内的所有数据库操作都是<strong>同一个数据库连接对象</strong></li>
<li><strong>异常传递</strong>：含数据库操作的业务的所有<strong>代码异常均需暴露</strong>，可被业务操作最顶层代码检测。</li>
<li><strong>顶层捕获</strong>：最后<strong>业务操作的最顶层</strong>代码进行<strong>资源回收</strong>，或异常捕获后进行<strong>回滚与回收</strong>。</li>
</ol>
<h3 id="手动管理事务"><a href="#手动管理事务" class="headerlink" title="手动管理事务"></a>手动管理事务</h3><p>实现事务控制的前提是用户必须能<strong>自己控制事务</strong>，如事务的创建、提交、回滚操作。这些操作均由Connection对象提供的方法实现。</p>
<ul>
<li><p><strong>设置为手动管理事务</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.setAutoCommit(<span class="keyword">false</span>);<span class="comment">//设置为手动管理事务</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>事务的提交</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//未执行事务提交操作时，所有sql语句操作均未生效</span></span><br><span class="line">connection.commit();<span class="comment">//含编译异常，由于受限于网络条件</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>事务的回滚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.rollback();<span class="comment">//含编译异常，由于受限于网络条件</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<ul>
<li><p><strong>注意</strong>：若发现就算设置connection.setAutoCommit(false);还出现没有调用commit()方法数据就进入到数据库了，除去代码问题外，很有可能是因为<strong>数据表</strong>的引擎设置成了MyISAM模式，该模式是<strong>不支持事务的</strong>。不管是设置setAutoCommit(false)还是‘SET AUTOCOMMIT=0’都没有用！应修改数据表的引擎改为<strong>InnoDB</strong>模式。</p>
<blockquote>
<p>出处：<a class="link"   target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/507577592.html" >https://zhidao.baidu.com/question/507577592.html<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602155900.png"
                     
                ></p>
<h3 id="同一连接对象"><a href="#同一连接对象" class="headerlink" title="同一连接对象"></a>同一连接对象</h3><ul>
<li><p>确保事务内的所有数据库操作都是<strong>同一个数据库连接对象</strong>，是数据库事务机制可运作的基础。</p>
</li>
<li><p>在没有进行事务管理操作的底层Dao代码(BaseDao)是每进行一次数据库操作就做一次”<strong>获取连接-释放连接</strong>“。当某个业务功能单次运转内部就需要多次操作数据库时，显然这种每次操作都进行获取释放的控制是不能够保证，”事务内的所有数据库操作都位于同一连接对象上“这一要求的。</p>
<ul>
<li><strong>没有事务控制的BaseDao</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.website.utils.JdbcUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql,Object...args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//每一次进行数据库操作都获取一个新的数据库连接</span></span><br><span class="line">        Connection con = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.update(con, sql, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//每一次操作完毕都立即回收掉了这个数据库连接</span></span><br><span class="line">            JdbcUtils.close(con);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="异常传递"><a href="#异常传递" class="headerlink" title="异常传递"></a>异常传递</h3><ul>
<li><p>事务的控制就在于控制数据库数据操作的异常情况，一旦哪一个环节出现异常，则整个环节回滚失效。</p>
</li>
<li><p>简而言之就是从最底层dao操作起，所有有可能出现的异常，都必须抛出，并能够往上传递至该业务的顶层代码(即这个业务功能结束时代码)，使其这个涉及数据库操作的业务在任意调用环节出错都可以被侦测到，进而顶层作为最后的异常抓取与处理，如选择回滚或其他操作，<strong>让事务保护整个业务流程的代码</strong>。</p>
</li>
<li><p><strong>异常处理提点</strong>：</p>
<ol>
<li>异常可以被内部try-catch捕获，但捕获后必须再抛出来。throw + throws</li>
<li>异常可以是显式地抛出，如第1点所示，也可以利用系统自带的隐式抛出(系统默认发现异常就会throw抛出)</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>模拟异常若不往上传递，而导致即使启用了事务控制，顶层代码也无法出现侦测做出回滚操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.website.dao.OrderDao;</span><br><span class="line"><span class="keyword">import</span> com.website.dao.impl.OrderDaoImp;</span><br><span class="line"><span class="keyword">import</span> com.website.pojo.Order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异常测试</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-01 17:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于本案例所有dao操作都是继承BaseDao实现的，BaseDao就是最底层的dao</span></span><br><span class="line">    <span class="comment">//可以看出由于BaseDao由于捕获异常内部处理，且没有抛出异常，基础与BaseDao的OrderDao的方法</span></span><br><span class="line">    <span class="comment">//在不存在编译时异常，而且当orderDao。若出现异常时代码会继续往下执行</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            testException();</span><br><span class="line">            System.out.println(<span class="string">&quot;无异常，不回滚&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;检测到异常，回滚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//模拟异常内部处理且不抛出情况</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        OrderDao orderDao = <span class="keyword">new</span> OrderDaoImp();</span><br><span class="line">        Order order = orderDao.queryOrderById(<span class="string">&quot;16224645526101&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;order = &quot;</span> + order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//插入一个数据库查询出来的数据，造成主键冲突，模拟sql执行内部错误</span></span><br><span class="line">        orderDao.saveOrder(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//继续进行数据库操作</span></span><br><span class="line">        orderDao.saveOrder(<span class="keyword">new</span> Order(<span class="string">&quot;12345&quot;</span>,<span class="keyword">new</span> Date(),<span class="number">1.0</span>,<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">        System.out.println(orderDao.queryOrderById(<span class="string">&quot;12345&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>输出：成功查询数据库数据后，即使出现异常(仅打印)，代码扔继续执行，而且顶层检测不到异常。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">order = Order&#123;orderId=<span class="string">&#x27;16224645526101&#x27;</span>, createTime=<span class="number">2021</span>-<span class="number">05</span>-<span class="number">31</span> <span class="number">20</span>:<span class="number">35</span>:<span class="number">52.0</span>, price=<span class="number">80.0</span>, status=<span class="number">0</span>, userId=<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">java.sql.SQLException: Duplicate entry <span class="string">&#x27;16224645526101&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;PRIMARY&#x27;</span> Query: <span class="function">INSERT INTO <span class="title">t_order</span><span class="params">(`order_id`,`create_time`,`price`,`status`,`user_id`)</span> <span class="title">VALUES</span><span class="params">(?,?,?,?,?)</span></span>; Parameters: [<span class="number">16224645526101</span>, <span class="number">2021</span>-<span class="number">05</span>-<span class="number">31</span> <span class="number">20</span>:<span class="number">35</span>:<span class="number">52.0</span>, <span class="number">80.0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">	at org.apache.commons.dbutils.QueryRunner.rethrow(QueryRunner.java:<span class="number">542</span>)</span><br><span class="line">	at org.apache.commons.dbutils.QueryRunner.update(QueryRunner.java:<span class="number">599</span>)</span><br><span class="line">	at com.website.dao.BaseDao.update(BaseDao.java:<span class="number">91</span>)</span><br><span class="line">	at com.website.dao.impl.OrderDaoImp.saveOrder(OrderDaoImp.java:<span class="number">24</span>)</span><br><span class="line">	at com.website.test.ExceptionTest.testException(ExceptionTest.java:<span class="number">36</span>)</span><br><span class="line">	at com.website.test.ExceptionTest.main(ExceptionTest.java:<span class="number">22</span>)</span><br><span class="line">Order&#123;orderId=<span class="string">&#x27;12345&#x27;</span>, createTime=<span class="number">2021</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">55</span>:<span class="number">12.0</span>, price=<span class="number">1.0</span>, status=<span class="number">1</span>, userId=<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">无异常，不回滚</span><br></pre></td></tr></table></figure>

<h3 id="顶层捕获"><a href="#顶层捕获" class="headerlink" title="顶层捕获"></a>顶层捕获</h3><h4 id="service层捕获"><a href="#service层捕获" class="headerlink" title="service层捕获"></a>service层捕获</h4><ul>
<li>通过上述“异常传递”的要求，需将异常上传至该业务的顶层代码，从Web开发原生MVC方案中，就是<strong>service</strong>层，service层正是调用DAO处理业务主要逻辑的部分。<strong>理论上说，从业务代码结束的角度上，应将异常上传至service层</strong>，通过将service层所有在一个try-cath里面编写，一旦出现异常则捕获，调用JdbcUtils进行回滚与资源回收。</li>
<li>目前可以通过代理设计模式，将service层的try-catch外壳抽取出来，实现代码复用。但仍然需要每一个业务的service层都需要设置。</li>
</ul>
<h4 id="Filet层捕获"><a href="#Filet层捕获" class="headerlink" title="Filet层捕获"></a>Filet层捕获</h4><ul>
<li>更好的解决方案是，将service层的异常继续往上传递，一直传递到servlet、filter，直至被filter感知，通过Filter同一处理异常，进行回滚操作。</li>
<li>此时代码的复用程度最高，事务管理访问容易控制。</li>
<li>调用逻辑如下</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602163904.png"
                     
                ></p>
<h2 id="事务管理实现"><a href="#事务管理实现" class="headerlink" title="事务管理实现"></a>事务管理实现</h2><p>以购物车结账生成订单createOrder功能为例，通过ThreadLocal +  Filter 实现事务管理。主要操作简述步骤如下：</p>
<ol>
<li><strong>修改数据库连接管理</strong>(JdbcUtils)：含手动管理事务、同一连接对象操作<ul>
<li>通过ThreadLocal存储Connection对象，保证之后的操作是同一个Connection对象</li>
<li>设置手动管理事务</li>
<li>封装[提交&amp;回滚]和、[提交&amp;回收]函数</li>
<li>增加remove操作，由于tomcat使用了线程池技术</li>
</ul>
</li>
<li><strong>底层DAO异常上抛</strong>(BaseDao)：异常传递操作<ul>
<li>获取连接处：回收资源与回滚操作只能进行一次，通过外抛异常统一处理。</li>
</ul>
</li>
<li><strong>通过Filter统一捕获</strong>：顶层捕获操作</li>
</ol>
<hr>
<p>详细的修改操作如下：</p>
<h3 id="连接管理"><a href="#连接管理" class="headerlink" title="连接管理"></a>连接管理</h3><p>如何确保一个功能内的所有数据库操作都是用同一个Connection对象呢？，用ThreadLocal存储可实现，而使用ThreadLocal实现前提又是所有操作都必须在同一个线程中完成，而Tomcat处理请求<em>就是多个独立的线程处理</em>。(有可能存在错误，先这样描述)</p>
<ul>
<li><strong>事务管理的JdbcUtils代码</strong><ul>
<li>修改 getConnection()方法</li>
<li>增加 commitAndClose()方法</li>
<li>增加 rollbackAndClose()方法</li>
<li>删除 close(Connection connection)方法</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>注意：若发现就算设置connection.setAutoCommit(false);还出现没有调用commit()方法数据就进入到数据库了，除去代码问题外，很有可能是因为<strong>数据表</strong>的引擎设置成了MyISAM模式，该模式是<strong>不支持事务的</strong>。不管是设置setAutoCommit(false)还是‘SET AUTOCOMMIT=0’都没有用！应修改数据表的引擎改为<strong>InnoDB</strong>模式。</p>
<blockquote>
<p>出处：<a class="link"   target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/507577592.html" >https://zhidao.baidu.com/question/507577592.html<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602155900.png"
                     
                ></p>
</li>
<li><p><strong>JdbcUtils.java</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ThreadLocal事务管理版</span></span><br><span class="line"><span class="comment">  * 获取数据库连接对象，若获取失败返回null</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、尝试从ThreadLocal中获取Connection对象</span></span><br><span class="line">    Connection connection = conns.get();</span><br><span class="line">    <span class="comment">//2、若是首次获取连接则从数据库连接池中获取数据库连接，否则使用ThreadLocal中的连接</span></span><br><span class="line">    <span class="keyword">if</span>(connection == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = dataSource.getConnection();</span><br><span class="line">            connection.setAutoCommit(<span class="keyword">false</span>);<span class="comment">//把当前连接设置为手动提交事务</span></span><br><span class="line">            conns.set(connection);<span class="comment">//存入ThreadLocal中，并立即与当前线程绑定</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> connection;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 提交事务并回收连接资源</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commitAndClose</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1、从ThreadLocal中取出数据库连接(保持一致性)</span></span><br><span class="line">    Connection connection = conns.get();</span><br><span class="line">    <span class="keyword">if</span>(connection != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.commit();<span class="comment">//2、提交事务</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();<span class="comment">//3、关闭连接</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4、一定要执行remove操作，否则会报错，(由于Tomcat服务器底层使用了线程池技术)</span></span><br><span class="line">    conns.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 回滚事务并回收资源</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rollbackAndClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1、从ThreadLocal中取出数据库连接(保持一致性)</span></span><br><span class="line">    Connection connection = conns.get();</span><br><span class="line">    <span class="keyword">if</span>(connection != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.rollback();<span class="comment">//2、回滚事务</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();<span class="comment">//3、关闭连接</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4、一定要执行remove操作，否则会报错，(由于Tomcat服务器底层使用了线程池技术)</span></span><br><span class="line">    conns.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="异常传递-1"><a href="#异常传递-1" class="headerlink" title="异常传递"></a>异常传递</h3><p>涉及数据库操作的必须将从最底层DAO(BaseDao)产生的异常均外抛，且能上传至Servlet层通过Filter方案统一处理。</p>
<ul>
<li><p>createOrder业务功能调用逻辑：请求逻辑是系统自动处理调用，<strong>主要看响应逻辑</strong></p>
</li>
<li><p>异常传递过程中，不一定全部显式抛出，也可以默认系统抛出，但一定要抛出。简而言之就是如下三种情况：(除JdbcUtils外)</p>
<ol>
<li>响应逻辑中全程没有try-catch，按系统默认抛出异常后逐层传递。</li>
<li>响应逻辑中存在try-catch捕获异常操作，但捕获后要抛出(还不如不捕获直接抛出)。</li>
<li>响应逻辑中，对于SQL类型的异常直接抛出，其他选择性捕获后抛出。</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602114035.png"
                     
                ></p>
</li>
</ul>
<hr>
<ul>
<li>演示案例中需要修改部分<ul>
<li><strong>BaseDao</strong>：<ul>
<li>删除：所有finally中的close操作(保持同一对象)</li>
<li>添加：抛出异常，可以捕获异常(因为调用queryRunner.query()方法本身就会抛出异常)，但一定要抛出，或<strong>不捕获直接抛出</strong>。</li>
</ul>
</li>
<li>OrderDao：抛出异常，throws SQLException</li>
<li>OrderService：抛出异常，throws SQLException</li>
<li>OrderServlet：抛出异常，throws SQLException</li>
<li><strong>BaseServlet</strong>：抛出异常，throws SQLException</li>
</ul>
</li>
</ul>
<h3 id="Filter捕获异常"><a href="#Filter捕获异常" class="headerlink" title="Filter捕获异常"></a>Filter捕获异常</h3><ul>
<li><p>通过了解Filter实际调用原理可以使用Filter进行异常捕获</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602163904.png"
                     
                ></p>
</li>
<li><p><strong>TransactionFilter.java</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.website.utils.TransactionJdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-02 15:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionFilter</span> <span class="keyword">extends</span> <span class="title">HttpFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//响应中没有发生异常，则提交事务操作</span></span><br><span class="line">            chain.doFilter(request,response);</span><br><span class="line">            TransactionJdbcUtils.commitAndClose();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//否则回滚事务</span></span><br><span class="line">            TransactionJdbcUtils.rollbackAndClose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>web.xml</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事务管理过滤器，写在web.xml首部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TransactionFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.website.filter.TransactionFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TransactionFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Tomcat错误信息页"><a href="#Tomcat错误信息页" class="headerlink" title="Tomcat错误信息页"></a>Tomcat错误信息页</h3><p>如事务控制中处理异常后，若不进行任何处理，返回给用户就是空白页。因此还需要跳转到一些用户提示页面。可以添加代码重定向逐一设置各种情况错误跳转到哪里。更好的解决方案是，让Tomcat统一管理错误信息页，通过web.xml中配置实现。</p>
<h4 id="使用步骤-2"><a href="#使用步骤-2" class="headerlink" title="使用步骤"></a>使用步骤</h4><ol>
<li><p>创建错误信息展示页面</p>
</li>
<li><p>在web.xml中配置错误页面信息</p>
<ul>
<li><strong>web.xml</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置HTTP错误代码，500即Tomcat发现内部错误(异常)时调用指定页面 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对于500内部异常错误，需Tomcat捕获到程序异常才能生效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/error_500.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>某些错误状态码需<strong>被Tomcat服务器检测到异常</strong>才能生效，如500内部错误。(若存在Filter中使用try-catch，则要显式上抛异常)</p>
</li>
</ol>
<hr>
<h4 id="创建错误信息页面"><a href="#创建错误信息页面" class="headerlink" title="创建错误信息页面"></a>创建错误信息页面</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602165143.png"
                     
                ></p>
<h4 id="配置错误页面"><a href="#配置错误页面" class="headerlink" title="配置错误页面"></a>配置错误页面</h4><ul>
<li><strong>web.xml</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置HTTP错误代码，500即Tomcat发现内部错误(异常)时调用指定页面 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对于500内部异常错误，需Tomcat捕获到程序异常才能生效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/error_500.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 404错误可被Tomcat直接捕获，不或访问到web程序，可直接配置生效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/error_400.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="上报异常"><a href="#上报异常" class="headerlink" title="上报异常"></a>上报异常</h4><p>如500内部错误状态码，需要Tomcat能感知到程序错误异常才能生效，如果在程序内部被拦截是无法生效的(程序内部捕获了也就不会产生内部错误)</p>
<p>下例为TransationFilter实现事务管理时500错误异常上报情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//响应中没有发生异常，则提交事务操作</span></span><br><span class="line">    chain.doFilter(request,response);</span><br><span class="line">    TransactionJdbcUtils.commitAndClose();</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//否则回滚事务</span></span><br><span class="line">    TransactionJdbcUtils.rollbackAndClose();</span><br><span class="line">    <span class="comment">//继续上抛异常至Tomcat服务器，让Tomcat检测到跳转指定错误页面</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h4 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210602170923.png"
                     
                ></p>
<h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><h3 id="基本概念-5"><a href="#基本概念-5" class="headerlink" title="基本概念"></a>基本概念</h3><p>JDK提供用于<strong>解决线程安全</strong>的<strong>工具类</strong>，ThreadLocal它可以给当前线程，以<strong>线程名</strong>(唯一性)为<strong>key</strong>对指定一个Object类型<strong>数据进行绑定</strong>(关联)操作，使其避免其他线程访问的同时可对被绑定数据进行线程安全的存取操作(如Map存取操作)，达到线程安全操作的效果。</p>
<hr>
<ul>
<li>ThreadLocal特点<ol>
<li>ThreadLocal 可以为当前线程关联一个数据。（它可以像 Map 一样存取数据，key 为当前线程） </li>
<li>每一个 ThreadLocal 对象，只能为当前线程关联一个数据，如果要为当前线程关联多个数据，就需要使用多个 ThreadLocal 对象实例。</li>
<li>每个 ThreadLocal 对象实例定义的时候，一般都是 static 类型</li>
<li>ThreadLocal 中保存数据，在线程销毁后。会由 JVM 虚拟自动释放</li>
</ol>
</li>
</ul>
<hr>
<p><strong>小结</strong>：ThreadLocal是以每个线程的线程名为key，存储某个Object数据的线程安全Map类型存储器。</p>
<h3 id="模拟应用场景"><a href="#模拟应用场景" class="headerlink" title="模拟应用场景"></a>模拟应用场景</h3><ul>
<li><strong>创建类SimilarThreadLocal模仿ThreadLocal的实现与功能</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.webstite.threadlocal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 仿写ThreadLocal的功能</span></span><br><span class="line"><span class="comment"> * 以线程名绑定某个Objetc类型数据，可对被绑定数据进行线程安全的存取操作。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-01 8:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimilarThreadLocal</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建线程安全的Map，用于存储绑定数据及其实现存取操作</span></span><br><span class="line">    <span class="comment">//key为当前线程名，value为任意的Object类型</span></span><br><span class="line">    <span class="comment">//模仿ThreadLocal使用建议，设置为static类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Object&gt; mapData = <span class="keyword">new</span> Hashtable&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//随机数生成</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建三个线程，并为每个线程分配一个数据作为被绑定的数据</span></span><br><span class="line">    <span class="comment">//在三个线程同时执行下，正确存取对应线程所分配的数据(线程安全测试)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Integer num = random.nextInt(<span class="number">1000</span>);</span><br><span class="line">            <span class="comment">//获取当前线程线程名(唯一性)，作为Map中的key</span></span><br><span class="line">            String name = Thread.currentThread().getName();</span><br><span class="line">            System.out.println(<span class="string">&quot;线程[&quot;</span>+ name +<span class="string">&quot;]绑定的随机数为：&quot;</span> + num);</span><br><span class="line">            mapData.put(name,num);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取数据测试，查看数据是否对称存取，检查线程安全操作</span></span><br><span class="line">            <span class="keyword">new</span> OrderService().createOrder();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启三个线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">3</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Task()).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>模仿在多线程环境获取特定的数据</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.webstite.threadlocal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模仿一应用需求：生成订单操作需在线程中获取一个数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-01 9:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取当前执行的线程名，作为获取数据的key标志</span></span><br><span class="line">        String name = Thread.currentThread().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;OrderService处于线程[&quot;</span>+ name +<span class="string">&quot;]获取绑定数据&quot;</span> + SimilarThreadLocal.mapData.get(name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>打印输出</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">线程[Thread-0]绑定的随机数为：57</span><br><span class="line">线程[Thread-1]绑定的随机数为：655</span><br><span class="line">线程[Thread-2]绑定的随机数为：965</span><br><span class="line">OrderService处于线程[Thread-1]获取绑定数据655</span><br><span class="line">OrderService处于线程[Thread-0]获取绑定数据57</span><br><span class="line">OrderService处于线程[Thread-2]获取绑定数据965</span><br></pre></td></tr></table></figure>

<ul>
<li><p>使用ThreadLocal实现</p>
<ul>
<li>修改<strong>SimilarThreadLocal.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public static Map&lt;String,Object&gt; mapData = new Hashtable&lt;&gt;();</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt;  threadLocal=  <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<strong>OrderService.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//System.out.println(&quot;OrderService处于线程[&quot;+ name +&quot;]获取绑定数据&quot; + SimilarThreadLocal.mapData.get(name));</span></span><br><span class="line">System.out.println(<span class="string">&quot;OrderService处于线程[&quot;</span>+ name +<span class="string">&quot;]获取绑定数据&quot;</span> + SimilarThreadLocal.threadLocal.get());</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="常用工具类"><a href="#常用工具类" class="headerlink" title="常用工具类"></a>常用工具类</h1><h2 id="带默认值字符串转整型"><a href="#带默认值字符串转整型" class="headerlink" title="带默认值字符串转整型"></a>带默认值字符串转整型</h2><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>带默认值字符串转整型的操作，在处理web请求中使用的频率非常高</li>
<li>带默认值的功能，比屏蔽内部异常后返回统一判断标识的做法更高明，它使其调用者出现就算异常情况，也不用再写调用该方法的一些判断，而是将用户自定义的异常处理方案也预置在调用方法中，灵活性更高。</li>
<li>使其代码更加简洁，健壮性更高</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li>在获取请求页码和每页数据量时，带默认值的类型转换函数，可以让用户预置自定义异常出现后的解决方案。使其代码更简洁，健壮性更高。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求页码和每页数据量(默认是第1页、每页Page.PAGE_SIZE 4 项内容)</span></span><br><span class="line"><span class="keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageNo&quot;</span>), <span class="number">1</span>);</span><br><span class="line"><span class="keyword">int</span> pageSize = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageSize&quot;</span>),Page.PAGE_SIZE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//补充</span></span><br><span class="line"><span class="keyword">int</span> min = WebUtils.parseInt(req.getParameter(<span class="string">&quot;min&quot;</span>),<span class="number">0</span>);</span><br><span class="line"><span class="keyword">int</span> max = WebUtils.parseInt(req.getParameter(<span class="string">&quot;max&quot;</span>),Integer.MAX_VALUE);</span><br></pre></td></tr></table></figure>

<ul>
<li>在一些常规场合，也可以让代码更清晰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品编号</span></span><br><span class="line"><span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><ul>
<li>源代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.utils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-22 11:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">  	 * 带默认值地将字符串数值转换为整型</span></span><br><span class="line"><span class="comment">  	 * <span class="doctag">@param</span> strInt    字符串数值</span></span><br><span class="line"><span class="comment">  	 * <span class="doctag">@param</span> defaultValue  若转换失败返回默认定义值</span></span><br><span class="line"><span class="comment">  	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  	 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parseInt</span><span class="params">(String strInt,<span class="keyword">int</span> defaultValue)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(strInt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="comment">//e.printStackTrace();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> defaultValue;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="命名词汇"><a href="#命名词汇" class="headerlink" title="命名词汇"></a>命名词汇</h1><h2 id="常用动词"><a href="#常用动词" class="headerlink" title="常用动词"></a>常用动词</h2><ul>
<li>查找/查询：query</li>
<li>获取：get</li>
<li>删除：delete</li>
<li>…</li>
</ul>
<h2 id="常用介词"><a href="#常用介词" class="headerlink" title="常用介词"></a>常用介词</h2><ul>
<li><p>by….：通过….，基于….，根据…..，</p>
<ul>
<li>通过id删除图书：<code>deleteBookById()</code></li>
<li>基于价格来查找总页数：<code>queryForPageTotalCountByPrice()</code></li>
</ul>
</li>
<li><p>for…：对…，给…，为…，供…表用途，;以帮助;</p>
<ul>
<li>对总页码数进行查询：<code>queryForPageTotalCount()</code></li>
<li>BaseDao中常见：<ul>
<li>对数值进行查询：<code>queryForValue()</code></li>
<li>对List集合进行查询：<code>queryForList()</code></li>
<li>…</li>
</ul>
</li>
</ul>
</li>
<li><p>to…：变成、转换到..</p>
<ul>
<li>转换/变成String类型：<code>toString()</code></li>
<li>转换/变成JSON类型：<code>gson.toJson()</code></li>
</ul>
</li>
</ul>
<h1 id="前端请求方案"><a href="#前端请求方案" class="headerlink" title="前端请求方案"></a>前端请求方案</h1><ul>
<li>form表单直接提交</li>
<li>超链接get请求</li>
<li>js事件绑定-location.href赋值刷新当前页面发起请求方案</li>
<li>js事件绑定-ajax异步交互json数据</li>
</ul>
<h2 id="location-href"><a href="#location-href" class="headerlink" title="location.href"></a>location.href</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;input.searchPageBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//1、获取输入的页码(忽略非法输入情况)</span></span><br><span class="line">    <span class="keyword">var</span> pageNo = $(<span class="string">&quot;#pn_input&quot;</span>).val();</span><br><span class="line">    <span class="comment">//2、javaScript语言中提供了一个location地址栏对象，</span></span><br><span class="line">    <span class="comment">//其中具备一个名为href属性，可以对浏览器地址栏操作，可读可写</span></span><br><span class="line">    <span class="comment">//读href属性：获取当前浏览器URL内容</span></span><br><span class="line">    <span class="comment">//写href属性：替换当前浏览器URL并直接在当前页面访问(GET请求)</span></span><br><span class="line">    location.href = <span class="string">&quot;manager/bookServlet?action=page&amp;pageNo=&quot;</span> + pageNo;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h1 id="电商Web功能模块"><a href="#电商Web功能模块" class="headerlink" title="电商Web功能模块"></a>电商Web功能模块</h1><h2 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h2><h3 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h3><ul>
<li>加入购物车</li>
<li>删除商品项</li>
<li>清空购物车</li>
<li>修改商品数量</li>
<li>…</li>
</ul>
<h3 id="对象模型"><a href="#对象模型" class="headerlink" title="对象模型"></a>对象模型</h3><ul>
<li><strong>Cart</strong>：购物车对象<ul>
<li><del><strong>totalCount</strong>：总商品数量</del>(可选项，因却决于items)</li>
<li><del><strong>totalPrice</strong>：总商品金额</del>(可选项，因却决于items)</li>
<li>Map&lt;Integer,CartItem&gt; <strong>items</strong>：购物车商品项集</li>
</ul>
</li>
<li><strong>CartItem</strong>：购物车专属商品项信息<ul>
<li><strong>id</strong>：商品编号</li>
<li><strong>name</strong>：商品名称</li>
<li><strong>count</strong>：商品数量</li>
<li><strong>price</strong>：商品单价</li>
<li><strong>totalPrice</strong>：商品总价</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>参考分析</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210531105749.png"
                     
                ></p>
<h3 id="实现技术"><a href="#实现技术" class="headerlink" title="实现技术"></a>实现技术</h3><p>目前市面上购物车实现技术有：</p>
<ol>
<li><strong>Session版本</strong>：将用户的购物车信息保存到Session域中</li>
<li><strong>数据库版本</strong>：将用户的购物车信息保存到数据库中</li>
<li><strong>redis + 数据库 + Cookie</strong>：使用Cookie + Redis缓存，和数据库实现</li>
</ol>
<h4 id="Sessions方案"><a href="#Sessions方案" class="headerlink" title="Sessions方案"></a>Sessions方案</h4><p>一般web调用方案是，web层(Servlet)——&gt;业务层(service)——&gt;持久层(dao)，由于基于Session实现的用户数据存储在Session中，因此没有dao，这些增删改查方法，<del>而且Session属于web层API</del>，可以选择service直接操作，或封装到Cart对象模型中，目前选择后者。</p>
<p>Cart对象模型具备的方法：</p>
<ul>
<li>addItem(CartItem);</li>
<li>deleteItem(id);</li>
<li>clear();</li>
<li>updateCount(id,count);</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 购物车对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cart</span> </span>&#123;</span><br><span class="line"><span class="comment">//    private Integer totalCount;</span></span><br><span class="line"><span class="comment">//    private BigDecimal totalPrice;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key是商品编号，</span></span><br><span class="line"><span class="comment">     * value，是商品信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer,CartItem&gt; items = <span class="keyword">new</span> LinkedHashMap&lt;Integer,CartItem&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加商品项</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cartItem</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(CartItem cartItem)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先查看购物车中是否已经添加过此商品，如果已添加，则数量累加，总金额更新，如果没有添加过，直接放到集合中即可</span></span><br><span class="line">        CartItem item = items.get(cartItem.getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (item == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 之前没添加过此商品</span></span><br><span class="line">            items.put(cartItem.getId(), cartItem);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 已经 添加过的情况</span></span><br><span class="line">            item.setCount( item.getCount() + <span class="number">1</span> ); <span class="comment">// 数量 累加</span></span><br><span class="line">            item.setTotalPrice( item.getPrice().multiply(<span class="keyword">new</span> BigDecimal( item.getCount() )) ); <span class="comment">// 更新总金额</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除商品项</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        items.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空购物车</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        items.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCount</span><span class="params">(Integer id,Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先查看购物车中是否有此商品。如果有，修改商品数量，更新总金额</span></span><br><span class="line">        CartItem cartItem = items.get(id);</span><br><span class="line">        <span class="keyword">if</span> (cartItem != <span class="keyword">null</span>) &#123;</span><br><span class="line">            cartItem.setCount(count);<span class="comment">// 修改商品数量</span></span><br><span class="line">            cartItem.setTotalPrice( cartItem.getPrice().multiply(<span class="keyword">new</span> BigDecimal( cartItem.getCount() )) ); <span class="comment">// 更新总金额</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Integer totalCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer,CartItem&gt;entry : items.entrySet()) &#123;</span><br><span class="line">            totalCount += entry.getValue().getCount();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> totalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BigDecimal totalPrice = <span class="keyword">new</span> BigDecimal(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer,CartItem&gt;entry : items.entrySet()) &#123;</span><br><span class="line">            totalPrice = totalPrice.add(entry.getValue().getTotalPrice());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> totalPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Integer, CartItem&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItems</span><span class="params">(Map&lt;Integer, CartItem&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Cart&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;totalCount=&quot;</span> + getTotalCount() +</span><br><span class="line">                <span class="string">&quot;, totalPrice=&quot;</span> + getTotalPrice() +</span><br><span class="line">                <span class="string">&quot;, items=&quot;</span> + items +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="添加购物"><a href="#添加购物" class="headerlink" title="添加购物"></a>添加购物</h5><p>添加购物后返回操作</p>
<ul>
<li><p><strong>需求描述</strong>：往往用户在含有分页、分类、价格区间下等等多种条件筛选下的页面情况进行加入购物车操作，当购物车操作处理完后，应该让页面回到原有状态下的情况。如用户在点击了电子产品类别，第三页中进行了添加购物车操作。操作完成后也应该让页面回到电子产品类别、第三页中。</p>
</li>
<li><p><strong>解决方案</strong>：通过获取发起购物车请求时网页地址栏的URL，在加入购物车操作完成后，请求重定向回去这个网页，由于这些筛选项参数一般都通过GET请求实现，因此通过URL则可以回到原有状态的网页。在HTTP协议中通过获取<code>Referer</code>请求头获取到网页地址栏。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.getHeader(<span class="string">&quot;Referer&quot;</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210531102027.png"
                     
                ></p>
<h5 id="删除商品项"><a href="#删除商品项" class="headerlink" title="删除商品项"></a>删除商品项</h5><p>对于删除、清空、或不容易被用户感知的修改数据等操作，一定需要给出确认、取消提示框。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;a.deleteClass&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * confirm 是确认提示框函数</span></span><br><span class="line"><span class="comment">	 * 参数：提示内容</span></span><br><span class="line"><span class="comment">	 * 提供两个按钮，确认、取消</span></span><br><span class="line"><span class="comment">	 * 返回true表示点击了确认，返回false则点击了取消</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="comment">//直接return即，因为返回false则阻止元素的默认行为，不提交</span></span><br><span class="line">    <span class="comment">//this：在事件的function函数中，this对象表示当前响应事件(前端响应)的dom对象</span></span><br><span class="line">    <span class="comment">//在这里this == &lt;a class=&quot;deleteClass&quot; href=&quot;manager/bookServlet?action=delete&amp;id=$&#123;book.id&#125;&quot;&gt;删除&lt;/a&gt;</span></span><br><span class="line">    <span class="keyword">return</span> confirm(<span class="string">&quot;你确定要删除 &quot;</span> +  $(<span class="built_in">this</span>).parent().parent().find(<span class="string">&quot;td:first&quot;</span>).text() + <span class="string">&quot;?&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="修改购物车"><a href="#修改购物车" class="headerlink" title="修改购物车"></a>修改购物车</h5><ul>
<li>业务功能：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210531104122.png"
                     
                ></p>
<ul>
<li>js代码：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给输入框绑定 onchange内容发生改变事件</span></span><br><span class="line">$(<span class="string">&quot;.updateCount&quot;</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取商品名称</span></span><br><span class="line">    <span class="keyword">var</span> name = $(<span class="built_in">this</span>).parent().parent().find(<span class="string">&quot;td:first&quot;</span>).text();</span><br><span class="line">    <span class="keyword">var</span> id = $(<span class="built_in">this</span>).attr(<span class="string">&#x27;bookId&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取商品数量</span></span><br><span class="line">    <span class="keyword">var</span> count = <span class="built_in">this</span>.value;</span><br><span class="line">    <span class="keyword">if</span> ( confirm(<span class="string">&quot;你确定要将【&quot;</span> + name + <span class="string">&quot;】商品修改数量为：&quot;</span> + count + <span class="string">&quot; 吗?&quot;</span>) ) &#123;</span><br><span class="line">        <span class="comment">//发起请求。给服务器保存修改</span></span><br><span class="line">        location.href = <span class="string">&quot;http://localhost:8080/book/cartServlet?action=updateCount&amp;count=&quot;</span>+count+<span class="string">&quot;&amp;id=&quot;</span>+id;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// defaultValue属性是表单项Dom对象的属性。它表示默认的value属性值。</span></span><br><span class="line">        <span class="built_in">this</span>.value = <span class="built_in">this</span>.defaultValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>若js需要后端的参数，如修改商品的id号，可通过在绑定事件中添加自定义的属性存储这些参数，如下的bookId属性就是自定义用于存储商品id信息，提供个js发出请求。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;updateCount&quot;</span> bookId=<span class="string">&quot;$&#123;entry.value.id&#125;&quot;</span> type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;$&#123;entry.value.count&#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h5 id="最后添加回显"><a href="#最后添加回显" class="headerlink" title="最后添加回显"></a>最后添加回显</h5><ul>
<li><p>Servlet修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在addItem最后添加</span></span><br><span class="line"><span class="comment">// 最后一个添加的商品名称,提供前端页面回显</span></span><br><span class="line">req.getSession().setAttribute(<span class="string">&quot;lastName&quot;</span>, cartItem.getName());</span><br></pre></td></tr></table></figure>
</li>
<li><p>前端页面修改：除直接赋值外，由于清空购物车操作也不显示，因此需判断一下购物车</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;text-align: center&quot;</span>&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;%--购物车为空的输出--%&gt;</span><br><span class="line">        &lt;span&gt; &lt;/span&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;span style=&quot;color: red&quot;&gt;当前购物车为空&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;%--购物车非空的输出--%&gt;</span><br><span class="line">        &lt;span&gt;您的购物车中有 $&#123;sessionScope.cart.totalCount&#125; 件商品&lt;/span&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            您刚刚将&lt;span style=&quot;color: red&quot;&gt;$&#123;sessionScope.lastName&#125;&lt;/span&gt;加入到了购物车中</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.pojo.Book;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.pojo.Cart;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.pojo.CartItem;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.service.BookService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.service.impl.BookServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.utils.WebUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BookService bookService = <span class="keyword">new</span> BookServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">updateCount</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">        <span class="comment">// 获取请求的参数 商品编号 、商品数量</span></span><br><span class="line">        <span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>),<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> count = WebUtils.parseInt(req.getParameter(<span class="string">&quot;count&quot;</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 获取Cart购物车对象</span></span><br><span class="line">        Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cart != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 修改商品数量</span></span><br><span class="line">            cart.updateCount(id,count);</span><br><span class="line">            <span class="comment">// 重定向回原来购物车展示页面</span></span><br><span class="line">            resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">        <span class="comment">// 1 获取购物车对象</span></span><br><span class="line">        Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cart != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 清空购物车</span></span><br><span class="line">            cart.clear();</span><br><span class="line">            <span class="comment">// 重定向回原来购物车展示页面</span></span><br><span class="line">            resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除商品项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">        <span class="comment">// 获取商品编号</span></span><br><span class="line">        <span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 获取购物车对象</span></span><br><span class="line">        Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cart != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 删除 了购物车商品项</span></span><br><span class="line">            cart.deleteItem(id);</span><br><span class="line">            <span class="comment">// 重定向回原来购物车展示页面</span></span><br><span class="line">            resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加入购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取请求的参数 商品编号</span></span><br><span class="line">        <span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 调用bookService.queryBookById(id):Book得到图书的信息</span></span><br><span class="line">        Book book = bookService.queryBookById(id);</span><br><span class="line">        <span class="comment">// 把图书信息，转换成为CartItem商品项</span></span><br><span class="line">        CartItem cartItem = <span class="keyword">new</span> CartItem(book.getId(),book.getName(),<span class="number">1</span>,book.getPrice(),book.getPrice());</span><br><span class="line">        <span class="comment">// 调用Cart.addItem(CartItem);添加商品项</span></span><br><span class="line">        Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cart == <span class="keyword">null</span>) &#123;</span><br><span class="line">            cart = <span class="keyword">new</span> Cart();</span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;cart&quot;</span>,cart);</span><br><span class="line">        &#125;</span><br><span class="line">        cart.addItem(cartItem);</span><br><span class="line"></span><br><span class="line">        System.out.println(cart);</span><br><span class="line">        System.out.println(<span class="string">&quot;请求头Referer的值：&quot;</span> + req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">        <span class="comment">// 最后一个添加的商品名称,提供前端页面回显</span></span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;lastName&quot;</span>, cartItem.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重定向回原来商品所在的地址页面</span></span><br><span class="line">        resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="订单"><a href="#订单" class="headerlink" title="订单"></a>订单</h2><h3 id="基本功能-1"><a href="#基本功能-1" class="headerlink" title="基本功能"></a>基本功能</h3><ul>
<li>用户：<ul>
<li>生成订单</li>
<li>查看我的(全部)订单</li>
<li>查看订单详情(商品信息)</li>
<li>签收订单</li>
</ul>
</li>
<li>管理员/店家<ul>
<li>查看所有订单(管理员/店家)</li>
<li>查看订单详情(商品信息)</li>
<li>发货(管理员/店家)</li>
</ul>
</li>
</ul>
<h3 id="对象模型-1"><a href="#对象模型-1" class="headerlink" title="对象模型"></a>对象模型</h3><ul>
<li><strong>Order</strong>：订单类<ul>
<li>orderId：订单号(唯一)</li>
<li>createTime：下单时机</li>
<li>price：交易金额</li>
<li>status：交易状态，如0未发货，1已发货，2已签收</li>
<li>userId：用户编号，用于标记这个订单属于哪个用户</li>
<li><del>OrderItem items：订单信息专属商品项</del>(采用数据库存储方案)</li>
</ul>
</li>
<li><strong>OrderItem</strong>：订单信息专属商品项类<ul>
<li>id：主键编号</li>
<li>name：商品名称</li>
<li>count：数量</li>
<li>price：单价</li>
<li>totalPrice：总价</li>
<li>orderId：订单号，属于哪个订单的商品项(数据库存储方案)</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>参考分析</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210531111820.png"
                     
                ></p>
<p>功能实现</p>
<h4 id="生成订单"><a href="#生成订单" class="headerlink" title="生成订单"></a>生成订单</h4><ul>
<li><strong>Servlet</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.website.dao.BookDao;</span><br><span class="line"><span class="keyword">import</span> com.website.dao.OrderDao;</span><br><span class="line"><span class="keyword">import</span> com.website.dao.OrderItemDao;</span><br><span class="line"><span class="keyword">import</span> com.website.dao.impl.BookDaoImp;</span><br><span class="line"><span class="keyword">import</span> com.website.dao.impl.OrderDaoImp;</span><br><span class="line"><span class="keyword">import</span> com.website.dao.impl.OrderItemDaoImp;</span><br><span class="line"><span class="keyword">import</span> com.website.pojo.*;</span><br><span class="line"><span class="keyword">import</span> com.website.service.OrderService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-05-31 16:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImp</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先保存订单、再保存订单号</span></span><br><span class="line">    OrderDao orderDao = <span class="keyword">new</span> OrderDaoImp();</span><br><span class="line">    OrderItemDao orderItemDao = <span class="keyword">new</span> OrderItemDaoImp();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于生成订单后改变原有的库存量域销量数据</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao = <span class="keyword">new</span> BookDaoImp();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">(Cart cart, Integer userId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、先保存订单</span></span><br><span class="line">        <span class="comment">//订单的唯一性</span></span><br><span class="line">        String orderId = System.currentTimeMillis() + <span class="string">&quot;&quot;</span> +userId;</span><br><span class="line">        Order order = <span class="keyword">new</span> Order(orderId,<span class="keyword">new</span> Date(),cart.getTotalPrice().doubleValue(),<span class="number">0</span>,userId);</span><br><span class="line">        orderDao.saveOrder(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、保存订单的商品项目</span></span><br><span class="line">        <span class="comment">//将购物车的商品项转换未购物车的商品项</span></span><br><span class="line">        <span class="keyword">for</span> (CartItem cartItem : cart.getItems().values()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//更新图书销量和库存</span></span><br><span class="line">            Book book = bookDao.queryBookById(cartItem.getId());</span><br><span class="line">            book.setSales(book.getSales() + cartItem.getCount());</span><br><span class="line">            book.setStock(book.getStock() - cartItem.getCount());</span><br><span class="line">            bookDao.updateBook(book);</span><br><span class="line"></span><br><span class="line">            OrderItem orderItem = <span class="keyword">new</span> OrderItem(<span class="keyword">null</span>,cartItem.getName(),cartItem.getCount(),cartItem.getPrice().doubleValue(),cartItem.getTotalPrice().doubleValue(),orderId);</span><br><span class="line">            orderItemDao.saveOrder(orderItem);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h1><h2 id="基本概念-6"><a href="#基本概念-6" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>JSP + Servlet的Web技术方案存在的最大问题就是前后端业务耦合度高，数据是通过各种后端代码标签嵌入到前端页面中，随着技术的发展已经逐渐被淘汰。</p>
</li>
<li><p>现如今最常用的Web技术方案就是前后端分离方案。分离在于前后端都协定一种数据交换格式(JSON)，客户端与服务器之间任何数据传递都是先封装成这种格式然后在网络中进行传递，客户端或服务器收到后再自行解析。使其前后端的工作完全分离，直接面向这种数据格式编程。</p>
</li>
</ul>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><h3 id="JSON概念"><a href="#JSON概念" class="headerlink" title="JSON概念"></a>JSON概念</h3><p>JSON (JavaScript Object Notation) 是一种<strong>轻量级</strong>的<strong>数据交换格式</strong>。易于人阅读和编写。同时也<strong>易于机器解析和生成</strong>。JSON 采用完全<strong>独立于语言</strong>的<strong>文本格式</strong>，而且很多语言都提供了对 json 的支持（包括 C, C++, C#, Java, JavaScript, Perl, Python 等）。 使得 JSON 成为理想的数据交换格式。</p>
<ul>
<li>json 是一种轻量级的数据交换格式，轻量级指的是跟 xml 做比较(早期数据交换格式使用XML)。</li>
<li>数据交换指的是客户端和服务器之间<strong>业务数据的传递格式</strong>。</li>
</ul>
<h3 id="格式定义"><a href="#格式定义" class="headerlink" title="格式定义"></a>格式定义</h3><ol>
<li>json是由键值对组成，并由花括号(大括号/ { } )包围。</li>
<li>每个键由双引号引起来</li>
<li>键和值之间使用冒号进行分隔：<code>&#123;&quot;key&quot;:value&#125;</code></li>
<li>多组键值对之间进行逗号进行分隔：<code>&#123;&quot;key1&quot;:value1,&quot;key2&quot;:value2,...&#125;</code></li>
<li>每个值支持多种类型：<ul>
<li><strong>数值</strong>：<code>&#123;&quot;key&quot;:12&#125;</code></li>
<li><strong>字符串</strong>：<code>&#123;&quot;key&quot;:&quot;str&quot;&#125;</code></li>
<li><strong>布尔型</strong>：<code>&#123;&quot;key&quot;:true&#125;</code></li>
<li><strong>数组</strong>：<code>&#123;&quot;key&quot;:[11,&quot;arr&quot;,false]&#125;</code></li>
<li><strong>JSON对象</strong>：<code>&#123;&quot;key&quot;: &#123;&quot;key1&quot;:1,&quot;key2&quot;:false&#125; &#125;</code></li>
<li><strong>JSON数组</strong>(数组)：<code>&#123;&quot;key&quot;: [&#123;&quot;key1&quot;:1,&quot;key2&quot;:false&#125;,&#123;&quot;key3&quot;:123&#125;] &#125;</code></li>
</ul>
</li>
</ol>
<ul>
<li>JavaScript中，JSON格式示意</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var jsonObj = &#123;</span><br><span class="line">    &quot;key1&quot;:12,</span><br><span class="line">    &quot;key2&quot;:&quot;abc&quot;,</span><br><span class="line">    &quot;key3&quot;:true,</span><br><span class="line">    &quot;key4&quot;:[11,&quot;arr&quot;,false],</span><br><span class="line">    &quot;key5&quot;:&#123;</span><br><span class="line">    &quot;key5_1&quot; : 551,</span><br><span class="line">    &quot;key5_2&quot; : &quot;key5_2_value&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;key6&quot;:[&#123;</span><br><span class="line">    &quot;key6_1_1&quot;:6611,</span><br><span class="line">    &quot;key6_1_2&quot;:&quot;key6_1_2_value&quot;&#125;,&#123;</span><br><span class="line">    &quot;key6_2_1&quot;:6621,</span><br><span class="line">    &quot;key6_2_2&quot;:&quot;key6_2_2_value&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="反序列化与反序列化"><a href="#反序列化与反序列化" class="headerlink" title="反序列化与反序列化"></a>反序列化与反序列化</h3><h4 id="基本概念-7"><a href="#基本概念-7" class="headerlink" title="基本概念"></a>基本概念</h4><ol>
<li><strong>持久化</strong>（Persistence）：将程序数据在<strong>瞬时状态</strong>转换为<strong>持久状态</strong>。即把数据（如内存中的对象）保存到可永久保存的存储设备中（如<strong>磁盘</strong>）。</li>
<li><strong>序列化</strong>（Serialization）：是将对象的状态信息，转换为<strong>可存储或可传输</strong>的形式的过程，可以理解为一种对象持久化的过程。从json作为数据交换格式情况下，序列化即<strong>Java对象变成json</strong>的过程。序列化的目的在于：<ul>
<li><strong>存储</strong>：以某种存储形式使自定义对象持久化</li>
<li><strong>传递</strong>：将对象从一个地方传递到另一个地方</li>
<li><strong>维护</strong>：使程序更具维护性</li>
</ul>
</li>
<li><strong>反序列化</strong>：即序列化的逆过程，从json作为数据交换格式情况下，序列化即<strong>json变成Java对象</strong>的过程。</li>
</ol>
<h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><h5 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h5><p>Json对象数据用来操作，Json字符串用于传送</p>
<ul>
<li>把 json 对象转换成为 json 字符串:<code>var jsonObjString = JSON.stringify(jsonObj);</code></li>
</ul>
<h5 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h5><ol>
<li>将后端发送过来的JSON字符串<strong>转换为JSON对象</strong>：<code>var jsonObj = JSON.parse(jsonObjString);</code></li>
<li>解析JSON数据：json在JavaScript中就是一个对象，直接通过“**.点取**”操作获取即可</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="comment">// json的定义</span></span><br><span class="line">    <span class="keyword">var</span> jsonObj = &#123;</span><br><span class="line">        <span class="string">&quot;key1&quot;</span>:<span class="number">12</span>,</span><br><span class="line">        <span class="string">&quot;key2&quot;</span>:<span class="string">&quot;abc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;key3&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;key4&quot;</span>:[<span class="number">11</span>,<span class="string">&quot;arr&quot;</span>,<span class="literal">false</span>],</span><br><span class="line">        <span class="string">&quot;key5&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;key5_1&quot;</span> : <span class="number">551</span>,</span><br><span class="line">            <span class="string">&quot;key5_2&quot;</span> : <span class="string">&quot;key5_2_value&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;key6&quot;</span>:[&#123;</span><br><span class="line">            <span class="string">&quot;key6_1_1&quot;</span>:<span class="number">6611</span>,</span><br><span class="line">            <span class="string">&quot;key6_1_2&quot;</span>:<span class="string">&quot;key6_1_2_value&quot;</span></span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="string">&quot;key6_2_1&quot;</span>:<span class="number">6621</span>,</span><br><span class="line">            <span class="string">&quot;key6_2_2&quot;</span>:<span class="string">&quot;key6_2_2_value&quot;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// alert(typeof(jsonObj));// object  json就是一个对象</span></span><br><span class="line"><span class="comment">// alert(jsonObj.key1); //12</span></span><br><span class="line"><span class="comment">// alert(jsonObj.key2); // abc</span></span><br><span class="line"><span class="comment">// alert(jsonObj.key3); // true</span></span><br><span class="line"><span class="comment">// alert(jsonObj.key4);// 得到数组[11,&quot;arr&quot;,false]</span></span><br><span class="line"><span class="comment">//  // json 中 数组值的遍历</span></span><br><span class="line"><span class="comment">// for(var i = 0; i &lt; jsonObj.key4.length; i++) &#123;</span></span><br><span class="line"><span class="comment">// 	alert(jsonObj.key4[i]);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// alert(jsonObj.key5.key5_1);//551</span></span><br><span class="line"><span class="comment">// alert(jsonObj.key5.key5_2);//key5_2_value</span></span><br><span class="line"><span class="comment">// alert( jsonObj.key6 );// 得到json数组</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // 取出来每一个元素都是json对象</span></span><br><span class="line"><span class="comment">// var jsonItem = jsonObj.key6[0];</span></span><br><span class="line"><span class="comment">// // alert( jsonItem.key6_1_1 ); //6611</span></span><br><span class="line"><span class="comment">// alert( jsonItem.key6_1_2 ); //key6_1_2_value</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><ul>
<li>Gson 是 Google 提供的用来在 Java 对象和 JSON 数据之间进行映射的 Java 类库。使用前需添加jar包。gson-2.2.4.jar。</li>
<li>常用的序列化与反序列化的操作对象有：JavaBean、List、Map三种类型。使用步骤如下：<ul>
<li>无论序列化还是反序列化第一步均需<strong>创建Gson对象</strong>：<code>Gson gson = new Gson();</code></li>
<li><strong>序列化</strong>：统一调用<code>son.toJson(Object src);</code></li>
<li><strong>反序列化</strong>：<ul>
<li>javaBean：<code>gson.fromJson(String json,Class&lt;T&gt; classOfT)</code></li>
<li>集合(List &amp; Map)：<code>gson.fromJson(String json,Type typeOfT);</code></li>
</ul>
</li>
</ul>
</li>
<li>集合类反序列化不能使用：<code>gson.fromJson(String json,Class&lt;T&gt; classOfT)</code>原因：</li>
<li><strong>错误测试</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//List与Json之间的转换</span></span><br><span class="line">    List&lt;Person&gt; personList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    personList.add(<span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈慧娴&quot;</span>));</span><br><span class="line">    personList.add(<span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈百强&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;personList = &quot;</span> + personList);</span><br><span class="line">    </span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    String personJsonString = gson.toJson(personList);</span><br><span class="line">    </span><br><span class="line">    List&lt;Person&gt; list = gson.fromJson(personJsonString, personList.getClass());</span><br><span class="line">    Person person = list.get(<span class="number">0</span>);<span class="comment">//将报出类型转换错误</span></span><br><span class="line">&#125;     </span><br></pre></td></tr></table></figure>

<ul>
<li>错误打印</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: com.google.gson.internal.LinkedTreeMap cannot be cast to com.website.pojo.Person</span><br><span class="line"></span><br><span class="line">	at com.website.json.JsonTest.test2(JsonTest.java:68)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	.....</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>原理分析</strong>：<code>gson.fromJson(String json,Class&lt;T&gt; classOfT);</code>方法默认会转换为<strong>LinkedTreeMap</strong>类型由于gson功能设计，LinkedTreeMap可以部封装成bean也可以自由地进行通过key获取value的操作<br>如JavaScript操作json对象一般，只要有key就能获取value。因此回来的数据类型是<code>List&lt;LinkedTreeMap&gt;</code>获取其中一个数据项转为Person类型肯定报错。</li>
</ul>
<h5 id="JavaBean-1"><a href="#JavaBean-1" class="headerlink" title="JavaBean"></a>JavaBean</h5><ul>
<li>JsonTest.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//JavaBean与Json之间的转换</span></span><br><span class="line">    Person person = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈慧娴&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;person = &quot;</span> + person);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、创建Gson对象</span></span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    <span class="comment">//2.1、JavaBean——&gt;Json：调用gson.toJson(Object src);</span></span><br><span class="line">    String personJsonString = gson.toJson(person);</span><br><span class="line">    System.out.println(<span class="string">&quot;personJsonString = &quot;</span> + personJsonString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.2、Json——&gt;JavaBean：调用：gson.fromJson(String json,Class&lt;T&gt; classOfT);</span></span><br><span class="line">    Person person1 = gson.fromJson(personJsonString, Person.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;person1 = &quot;</span> + person1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>打印结果：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person = Person&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;陈慧娴&#x27;</span>&#125;</span><br><span class="line">personJsonString = &#123;<span class="string">&quot;id&quot;</span>:<span class="number">1</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;陈慧娴&quot;</span>&#125;</span><br><span class="line">person1 = Person&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;陈慧娴&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h5 id="List"><a href="#List" class="headerlink" title="List"></a>List</h5><ol>
<li><p>创建Gson对象</p>
</li>
<li><p>序列化：<code>son.toJson(Object src);</code></p>
</li>
<li><p>反序列化：<code>gson.fromJson(String json,Type typeOfT);</code></p>
<ul>
<li>Type<strong>对象</strong>：<ul>
<li>创建一个空白类继承com.google.gson.reflect.TypeToken<strong>泛型类</strong></li>
<li>在继承TypeToken&lt;&gt;泛型类中填入目的转换的集合类型，如<code>List&lt;Person&gt;</code>或<code>ArrayList&lt;Person&gt;</code></li>
<li>调用这个空白类的getType()方法，将返回的Type对象传fromJson()方法中</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>tips：实际开发中，直接通过<strong>匿名的方式</strong>继承创建这个空白类传入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gson.fromJson(personJsonString,<span class="keyword">new</span> TypeToken&lt;ArrayList&lt;Person&gt;&gt;()&#123;&#125;.getType());</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><strong>JsonTest.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//List与Json之间的转换</span></span><br><span class="line">    List&lt;Person&gt; personList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    personList.add(<span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈慧娴&quot;</span>));</span><br><span class="line">    personList.add(<span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈百强&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;personList = &quot;</span> + personList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、创建Gson对象</span></span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2.1、JavaBean——&gt;Json：调用gson.toJson(Object src);</span></span><br><span class="line">    String personJsonString = gson.toJson(personList);</span><br><span class="line">    System.out.println(<span class="string">&quot;personJsonString = &quot;</span> + personJsonString);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2.2.1、调用gson.fromJson(String json,Type typeOfT)方法，</span></span><br><span class="line">    List&lt;Person&gt; personList1 = gson.fromJson(personJsonString, <span class="keyword">new</span> PersonListType().getType());</span><br><span class="line">    System.out.println(<span class="string">&quot;personList1 = &quot;</span> + personList1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>PersonListType.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.reflect.TypeToken;</span><br><span class="line"><span class="keyword">import</span> com.website.pojo.Person;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 空白类，仅用于继承TypeToken辅助Gson进行反射操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-02 21:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonListType</span> <span class="keyword">extends</span> <span class="title">TypeToken</span>&lt;<span class="title">ArrayList</span>&lt;<span class="title">Person</span>&gt;&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>打印结果：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">personList = [Person&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;陈慧娴&#x27;</span>&#125;, Person&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;陈百强&#x27;</span>&#125;]</span><br><span class="line">personJsonString = [&#123;<span class="string">&quot;id&quot;</span>:<span class="number">1</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;陈慧娴&quot;</span>&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="number">1</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;陈百强&quot;</span>&#125;]</span><br><span class="line">personList1 = [Person&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;陈慧娴&#x27;</span>&#125;, Person&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;陈百强&#x27;</span>&#125;]</span><br></pre></td></tr></table></figure>

<h5 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h5><ul>
<li>同理与List操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//Map与Json之间的转换</span></span><br><span class="line">    Map&lt;Integer,Person&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="number">1</span>,<span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈慧娴&quot;</span>));</span><br><span class="line">    map.put(<span class="number">2</span>,<span class="keyword">new</span> Person(<span class="number">2</span>,<span class="string">&quot;陈百强&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;map = &quot;</span> + map);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、创建Gson对象</span></span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.1、JavaBean——&gt;Json</span></span><br><span class="line">    String mapJsonString = gson.toJson(map);</span><br><span class="line">    System.out.println(<span class="string">&quot;mapJsonString = &quot;</span> + mapJsonString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.2、Json——&gt;JavaBean</span></span><br><span class="line">    Map&lt;Integer,Person&gt; mapPerson = gson.fromJson(mapJsonString, <span class="keyword">new</span> TypeToken&lt;Map&lt;Integer, Person&gt;&gt;() &#123;&#125;.getType());</span><br><span class="line">    Person person = mapPerson.get(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;person = &quot;</span> + person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><h3 id="基本概念-8"><a href="#基本概念-8" class="headerlink" title="基本概念"></a>基本概念</h3><p><em>AJAX</em> 即“<strong>A</strong>synchronous <strong>J</strong>avascript <strong>A</strong>nd <strong>X</strong>ML”（异步 JavaScript 和 XML，由于以前数据交换格式使用XML），是指一种创建交互式网页应用的网页开发技术。 </p>
<ul>
<li><p>AJAX<strong>不是</strong>新的编程语言，而是<strong>一种</strong>使用现有<strong>技术集合</strong>的‘新’方法，不同库或框架有自己的AJAX实现。</p>
</li>
<li><p><strong>AJAX所描述的技术集合</strong>：通过浏览器脚本编程语言调用一个隐藏请求装置，也就是XMLHttpRequest(简称XHR)，由这个请求装置异步地向服务器请求资源，使其页面不阻塞情况下返回一个资源载体。可在<strong>不重载页面的情况下</strong>与 Web 服务器交换数据，即在不需要刷新页面的情况下，就可以产生<strong>局部刷新的效果</strong>。</p>
</li>
<li><p><strong>AJAX的优势</strong>：</p>
<ul>
<li>Ajax 在浏览器与 Web 服务器之间使用异步数据传输（HTTP 请求），这样就可使网页从服务器<strong>请求少量的信息</strong>，而不是整个页面。</li>
<li>Ajax可使因特网应用程序更小、更快，更友好</li>
</ul>
</li>
</ul>
<h3 id="原生AJAX"><a href="#原生AJAX" class="headerlink" title="原生AJAX"></a>原生AJAX</h3><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p>由于AJAX的基础是<strong>XMLHttpRequest</strong>服务器资源交互对象，因此实现AJAX首先围绕这个对象展开。<a class="link"   target="_blank" rel="noopener" href="https://www.w3school.com.cn/ajax/index.asp" >w3school学习参考文档<i class="fas fa-external-link-alt"></i></a>。实现原生的AJAX基本步骤如下：</p>
<ol>
<li>创建XMLHttpRequest对象</li>
<li>设置请求链接及其参数，<code>xmlhttp.open();</code></li>
<li>发送请求前绑定<code>onreadystatechange</code>事件，设置处理请求完成后的操作。</li>
<li>向服务器发起请求，<code>xmlhttp.send();</code></li>
<li>在<code>onreadystatechange </code>事件中处理数据</li>
</ol>
<hr>
<ul>
<li>使用示例</li>
<li><strong>ajax.html</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ajaxRequest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//1、首先创建XMLHttpRequest</span></span><br><span class="line">    <span class="keyword">var</span> xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、调用open方法设置请求参数</span></span><br><span class="line">    <span class="keyword">var</span> requestUrl = <span class="string">&quot;/15_json_ajax_i18n/ajaxServlet?action=javaScriptAjax&quot;</span></span><br><span class="line">    xmlHttp.open(<span class="string">&quot;GET&quot;</span>,requestUrl,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、在send方法前绑定onreadystatechange事件，处理请求完成后的操作。</span></span><br><span class="line">    xmlHttp.onreadystatechange=<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//当XMLHttpRequest对象的readyState属性为4，表示请求完成，且响应就绪</span></span><br><span class="line">        <span class="comment">//且HTTP响应码为200时，表示数据完整接收到</span></span><br><span class="line">        <span class="keyword">if</span>(xmlHttp.readyState == <span class="number">4</span> &amp;&amp; xmlHttp.status == <span class="number">200</span>)&#123;</span><br><span class="line">            <span class="comment">//证明顺利接收到完整的数据，开始处理数据</span></span><br><span class="line">         </span><br><span class="line">            alert(xmlHttp.responseText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4、调用send方法发送请求</span></span><br><span class="line">    xmlHttp.send();</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>AjaxServlet.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.website.pojo.Person;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-03 7:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AjaxServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//响应JavaScript的Ajax请求</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">javaScriptAjax</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//向ajax请求响应一个json格式的Person对象</span></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈慧娴&quot;</span>);</span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        String personJsonString = gson.toJson(person);</span><br><span class="line">        resp.getWriter().write(personJsonString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>web.xml</strong>：配置servlet</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AjaxServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.website.servlet.AjaxServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AjaxServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/ajaxServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>效果</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210603084547.png"
                     
                ></p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p>详细的API文档，请查看<a class="link"   target="_blank" rel="noopener" href="https://www.w3school.com.cn/ajax/index.asp" >w3school<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="XMLHtppRequest对象"><a href="#XMLHtppRequest对象" class="headerlink" title="XMLHtppRequest对象"></a>XMLHtppRequest对象</h5><ul>
<li>创建 XMLHttpRequest 对象的语法：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variable=<span class="keyword">new</span> XMLHttpRequest();</span><br></pre></td></tr></table></figure>

<ul>
<li>老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variable=<span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h5><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>open(<em>method</em>,*url,<em>async</em>)</td>
<td>规定请求的类型、URL 以及是否异步处理请求。  <em>method</em>：请求的类型；GET 或 POST <em>url</em>：文件在服务器上的位置 <em>async</em>：true（异步）或 false（同步）</td>
</tr>
</tbody></table>
<h5 id="onreadystatechange事件"><a href="#onreadystatechange事件" class="headerlink" title="onreadystatechange事件"></a>onreadystatechange事件</h5><ul>
<li>当请求被发送到服务器时，我们需要执行一些基于响应的任务。</li>
<li>每当 readyState 改变时，就会触发 onreadystatechange 事件</li>
<li>readyState 属性存有 XMLHttpRequest 的状态信息。</li>
<li>下面是 XMLHttpRequest 对象的三个重要的属性：</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>onreadystatechange</td>
<td>存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</td>
</tr>
<tr>
<td>readyState</td>
<td>存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。  0: 请求未初始化， 1: 服务器连接已建立， 2: 请求已接收， 3: 请求处理中， 4: 请求已完成，且响应已就绪</td>
</tr>
<tr>
<td>status</td>
<td>200: “OK”，404: 未找到页面</td>
</tr>
</tbody></table>
<ul>
<li><strong>注释</strong>：onreadystatechange 事件被触发 5 次（0 - 4），对应着 readyState 的每个变化。</li>
<li>通用的响应判断：应判断readyState为4，且HTTP响应为200时才表示数据顺利完整接收，响应就绪</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)&#123;</span><br><span class="line">    	<span class="built_in">document</span>.getElementById(<span class="string">&quot;myDiv&quot;</span>).innerHTML=xmlhttp.responseText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="XHR响应数据"><a href="#XHR响应数据" class="headerlink" title="XHR响应数据"></a>XHR响应数据</h5><ul>
<li>如需获得来自服务器的响应，请使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>responseText</td>
<td>获得字符串形式的响应数据。</td>
</tr>
<tr>
<td>responseXML</td>
<td>获得 XML 形式的响应数据。</td>
</tr>
</tbody></table>
<ul>
<li><strong>responseText属性</strong></li>
</ul>
<p>如果来自服务器的响应并非 XML，请使用 responseText 属性。</p>
<p>responseText 属性返回字符串形式的响应，因此您可以这样使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;myDiv&quot;</span>).innerHTML=xmlhttp.responseText;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>responseXML属性</strong></li>
</ul>
<p>如果来自服务器的响应是 XML，而且需要作为 XML 对象进行解析，请使用 responseXML 属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xmlDoc&#x3D;xmlhttp.responseXML;</span><br><span class="line">txt&#x3D;&quot;&quot;;</span><br><span class="line">x&#x3D;xmlDoc.getElementsByTagName(&quot;ARTIST&quot;);</span><br><span class="line">for (i&#x3D;0;i&lt;x.length;i++)</span><br><span class="line">  &#123;</span><br><span class="line">  txt&#x3D;txt + x[i].childNodes[0].nodeValue + &quot;&lt;br &#x2F;&gt;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">document.getElementById(&quot;myDiv&quot;).innerHTML&#x3D;txt;</span><br></pre></td></tr></table></figure>

<h5 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h5><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>send()</td>
<td>用于GET请求</td>
</tr>
<tr>
<td>send(<em>string</em>)</td>
<td>将请求发送到服务器。  <em>string</em>：仅用于 POST 请求</td>
</tr>
</tbody></table>
<h3 id="同步与异步"><a href="#同步与异步" class="headerlink" title="同步与异步"></a>同步与异步</h3><h4 id="同步测试"><a href="#同步测试" class="headerlink" title="同步测试"></a>同步测试</h4><p>延用“原生Ajax”中的示例来进行同步异步请求测试。</p>
<ul>
<li><strong>AjaxServlet.java</strong>：在响应中加入延时代码，模拟网络环境导致响应不能马上发回。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.website.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.website.pojo.Person;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yhd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-03 7:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AjaxServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//响应JavaScript的Ajax请求</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">javaScriptAjax</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//向ajax请求响应一个json格式的Person对象</span></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;陈慧娴&quot;</span>);</span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        String personJsonString = gson.toJson(person);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        resp.getWriter().write(personJsonString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ajax.html</strong>：<ul>
<li>将<code>xmlHttp.open(&quot;GET&quot;,requestUrl,false);</code>改为<strong>false</strong>，表示<strong>同步请求</strong>。</li>
<li>在<code>xmlHtpp.send()</code>方法下添加js代码，如<code>alert(&quot;我被执行了&quot;);</code></li>
<li>添加多个触发事件按钮，button ，ajax request2</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta http-equiv=<span class="string">&quot;pragma&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">		&lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">		&lt;meta http-equiv=<span class="string">&quot;Expires&quot;</span> content=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">		&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">		&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">		&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">			<span class="function"><span class="keyword">function</span> <span class="title">ajaxRequest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">				<span class="comment">//1、首先创建XMLHttpRequest</span></span><br><span class="line">				<span class="keyword">var</span> xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">				<span class="comment">//2、调用open方法设置请求参数</span></span><br><span class="line">				<span class="keyword">var</span> requestUrl = <span class="string">&quot;/15_json_ajax_i18n/ajaxServlet?action=javaScriptAjax&quot;</span></span><br><span class="line">				xmlHttp.open(<span class="string">&quot;GET&quot;</span>,requestUrl,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">//3、在send方法前绑定onreadystatechange事件，处理请求完成后的操作。</span></span><br><span class="line">				xmlHttp.onreadystatechange=<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">					<span class="comment">//当XMLHttpRequest对象的readyState属性为4，表示请求完成，且响应就绪</span></span><br><span class="line">					<span class="comment">//且HTTP响应码为200时，表示数据完整接收到</span></span><br><span class="line">					<span class="keyword">if</span>(xmlHttp.readyState == <span class="number">4</span> &amp;&amp; xmlHttp.status == <span class="number">200</span>)&#123;</span><br><span class="line">						<span class="comment">//证明顺利接收到完整的数据，开始处理数据</span></span><br><span class="line">						alert(xmlHttp.responseText);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//4、调用send方法发送请求</span></span><br><span class="line">				xmlHttp.send();</span><br><span class="line"></span><br><span class="line">				<span class="comment">//测试同步与异步特性</span></span><br><span class="line">				alert(<span class="string">&quot;我被执行了...&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/script&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;	</span><br><span class="line">		&lt;button onclick=<span class="string">&quot;ajaxRequest()&quot;</span>&gt;ajax request&lt;/button&gt;</span><br><span class="line">		&lt;button onclick=<span class="string">&quot;ajaxRequest()&quot;</span>&gt;ajax request2&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">		&lt;div id=<span class="string">&quot;div01&quot;</span>&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试效果：<ol>
<li><code>alert(&quot;我被执行了...&quot;);</code>代码必须等待onreadystatechange事件执行完毕后才能执行。</li>
<li>当点下第一个按钮响应还没回来时，无法点击第二个按钮。这就是同步，同步必须等待响应后才能执行。</li>
</ol>
</li>
</ul>
<h4 id="异步测试"><a href="#异步测试" class="headerlink" title="异步测试"></a>异步测试</h4><ul>
<li>延用上述同步测试代码，将ajax.html中的将<code>xmlHttp.open(&quot;GET&quot;,requestUrl,true);</code>改为<strong>true</strong>，表示<strong>异步请求</strong></li>
<li>测试效果：<ol>
<li>先执行<code>alert(&quot;我被执行了...&quot;);</code>，再执行onreadystatechange事件中的<code>alert(xmlHttp.responseText);</code></li>
<li>当点下第一个按钮时，<code>alert(&quot;我被执行了...&quot;)</code>立即执行，且在第一个按钮的响应未回来之前，页面不会阻塞，还可以继续点击第二个按钮，执行代码并发出新的请求，这就是异步效果。</li>
</ol>
</li>
</ul>
<h4 id="异步的优势"><a href="#异步的优势" class="headerlink" title="异步的优势"></a>异步的优势</h4><p>异步优势在于发起局部请求后，即使响应数据没马上到来，整个浏览器页面不会阻塞(卡死)，这就异步请求良好的用户体验。</p>
<h3 id="jQuery-AJAX"><a href="#jQuery-AJAX" class="headerlink" title="jQuery-AJAX"></a>jQuery-AJAX</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><ul>
<li><p>jQuery 提供多个与 AJAX 有关的方法。</p>
</li>
<li><p>通过 jQuery AJAX 方法，您能够使用 HTTP Get 和 HTTP Post 从远程服务器上请求文本、HTML、XML 或 JSON - 同时您能够把这些外部数据直接载入网页的被选元素中。</p>
</li>
</ul>
<hr>
<p><strong>提示</strong>：如果没有 jQuery，AJAX 编程还是有些难度的。</p>
<p>编写常规的 AJAX 代码并不容易，因为<strong>不同的浏览器</strong>对 <strong>AJAX 的实现并不</strong>相同。这意味着您必须编写额外的代码对浏览器进行测试。不过，jQuery 团队为我们解决了这个难题，我们只需要一行简单的代码，就可以实现 AJAX 功能。</p>
<ul>
<li>具体API及其适用请参考：<a class="link"   target="_blank" rel="noopener" href="https://www.w3school.com.cn/jquery/jquery_ajax_intro.asp" >w3school<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<h4 id="ajax"><a href="#ajax" class="headerlink" title="$.ajax()"></a>$.ajax()</h4><p>该方法是 jQuery 底层 AJAX 实现。简单易用的高层实现见 <code>$.get</code>,<code>$.post</code>等，<code>$.ajax() </code>返回其创建的 XMLHttpRequest 对象。大多数情况下你无需直接操作该函数，除非你需要操作不常用的选项，以获得更多的灵活性。</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><ul>
<li><p>语法：<code>$.ajax([settings])</code></p>
</li>
<li><p><code>settings = &#123;key1:value2,key2:value2,...&#125;</code>：通过键值对的方式设置方法参数。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>settings</em></td>
<td align="center">可选。用于配置 Ajax 请求的键值对{key:}集合。 可以通过 $.ajaxSetup() 设置任何选项的默认值。</td>
</tr>
</tbody></table>
<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><ul>
<li><strong>url</strong>：表示请求的地址</li>
<li><strong>type</strong>：表示请求的类型 GET 或 POST 请求 </li>
<li><strong>data</strong>：表示发送给服务器的数据(只能是键值对)，格式有两种(默认都会转换为第一种)<ul>
<li>name=value&amp;name=value </li>
<li>{key:value} </li>
</ul>
</li>
<li><strong>success</strong>：请求成功，响应的回调函数。对调函数中含一个回传参数，响应数据存储在该回传参数中。</li>
<li><strong>dataType</strong>：表示接收后转换的数据类型<ul>
<li>text：表示纯文本</li>
<li>xml：表示xml 数据</li>
<li>json：表示 json 对象，直接返回json对象</li>
</ul>
</li>
</ul>
<h5 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h5><ul>
<li><strong>jq_ajax.js</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ajax请求</span></span><br><span class="line">    $(<span class="string">&quot;#ajaxBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:<span class="string">&quot;/15_json_ajax_i18n/ajaxServlet?action=jQueryAjax&quot;</span>,</span><br><span class="line">            type:<span class="string">&quot;GET&quot;</span>,</span><br><span class="line">            data:<span class="string">&quot;name=jqueryAjax&amp;password=123&quot;</span>,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                alert(data);</span><br><span class="line">            &#125;,</span><br><span class="line">            dataType:<span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        alert(<span class="string">&quot;ajax btn&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="get-与-post"><a href="#get-与-post" class="headerlink" title="$.get() 与 $.post()"></a>$.get() 与 $.post()</h4><ul>
<li><p>通过远程 HTTP GET/POST 请求载入信息。</p>
</li>
<li><p>这是一个简单的 GET/POST 请求功能以取代复杂 <code>$.ajax</code>(少了一个请求类型参数)。请求成功时可调用回调函数。如果需要在出错时执行函数，请使用<code>  $.ajax</code></p>
</li>
</ul>
<h5 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h5><p>将所有参数值<strong>按序直接传入</strong></p>
<h5 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h5><ul>
<li><strong>url</strong>：待载入页面的URL地址</li>
<li><strong>data</strong>：请求参数，<strong>字符串</strong>或<strong>键值对</strong>的形式<code>&#123;key:value&#125;</code>方式发送参数</li>
<li><strong>callback</strong>：载入成功时回调函数</li>
<li><strong>type</strong>：返回内容格式，xml, html, script, json, text, _default。</li>
</ul>
<hr>
<ul>
<li><strong>tips</strong>：</li>
</ul>
<h5 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h5><ul>
<li><strong>jq_ajax.html</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ajax--get请求</span></span><br><span class="line">$(<span class="string">&quot;#getBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.get(<span class="string">&quot;/15_json_ajax_i18n/ajaxServletaction=jQueryAjax&quot;</span>,<span class="string">&quot;action=jQueryGet&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            alert(data);</span><br><span class="line">        &#125;,<span class="string">&quot;json&quot;</span>);		</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ajax--post请求</span></span><br><span class="line">$(<span class="string">&quot;#postBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  	</span><br><span class="line">    $.post(<span class="string">&quot;/15_json_ajax_i18n/ajaxServletaction=jQueryAjax&quot;</span>,<span class="string">&quot;action=jQueryPost&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        alert(data);			</span><br><span class="line">    &#125;,<span class="string">&quot;json&quot;</span>);			</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="getJSON"><a href="#getJSON" class="headerlink" title="$.getJSON()"></a>$.getJSON()</h4><p>通过 HTTP <strong>GET</strong> 请求载入 JSON 数据，即在<code>$.get()</code>方法基础上减少一个参数(type=json)</p>
<h5 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h5><p>将所有参数值<strong>按序直接传入</strong></p>
<h5 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h5><ul>
<li><strong>url</strong>：待载入页面的URL地址</li>
<li><strong>data</strong>：请求参数，字符串或<code>&#123;key:value&#125;</code>方式发送参数</li>
<li><strong>callback</strong>：载入成功时回调函数</li>
</ul>
<h5 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h5><p><strong>jq_ajax.html</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ajax--getJson请求</span></span><br><span class="line">$(<span class="string">&quot;#getJSONBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.getJSON(<span class="string">&quot;/15_json_ajax_i18n/ajaxServletaction=jQueryAjax&quot;</span>,<span class="string">&quot;action=jQueryGetJSON&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        alert(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="serialize"><a href="#serialize" class="headerlink" title="$.serialize()"></a>$.serialize()</h4><p>将表单中的所有表单项数据序列化，序列化后的格式化为：<code>name=value&amp;name=value...</code></p>
<hr>
<p>tips：serialize()的结果直接作为请求参数时，需要注意是否有缺少连字符<code>$</code>或分隔符<code>?</code></p>
<h5 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h5><ul>
<li>准备表单form：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form01&quot;</span> &gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        下拉单选：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;single&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Single&quot;</span>&gt;</span>Single<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Single2&quot;</span>&gt;</span>Single2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        下拉多选：</span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;multiple&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;multiple&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Multiple&quot;</span>&gt;</span>Multiple<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Multiple2&quot;</span>&gt;</span>Multiple2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Multiple3&quot;</span>&gt;</span>Multiple3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        复选：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;check&quot;</span> <span class="attr">value</span>=<span class="string">&quot;check1&quot;</span>/&gt;</span> check1</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;check&quot;</span> <span class="attr">value</span>=<span class="string">&quot;check2&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span> check2<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        单选：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;radio1&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span> radio1</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;radio2&quot;</span>/&gt;</span> radio2<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>			</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交--serialize()<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>执行serialize()方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#submit&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 把参数序列化</span></span><br><span class="line">    <span class="keyword">var</span> serializeData = $(<span class="string">&quot;#form01&quot;</span>).serialize();</span><br><span class="line">    alert(serializeData);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>操作表单</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210603110508.png"
                     
                ></p>
<h2 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h2><h3 id="用户名校验判断"><a href="#用户名校验判断" class="headerlink" title="用户名校验判断"></a>用户名校验判断</h3><h4 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/%E7%94%A8%E6%88%B7%E5%90%8D%E6%A0%A1%E9%AA%8Cajax.png"
                     
                ></p>
<h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><ul>
<li>前端页面：添加元素失去焦点函数blur，发送Ajax请求，处理请求响应</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户名是否已存在异步检测</span></span><br><span class="line">$(<span class="string">&quot;#username&quot;</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//绑定失去焦点事件</span></span><br><span class="line">    <span class="comment">//1、获取用户输入的用户名</span></span><br><span class="line">    <span class="keyword">var</span> username = <span class="built_in">this</span>.value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、发送ajax请求</span></span><br><span class="line">    $.getJSON(<span class="string">&quot;userServlet?action=ajaxExistsUserName&quot;</span>,<span class="string">&quot;username=&quot;</span> + username,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//console.log(data);</span></span><br><span class="line">        <span class="keyword">if</span>(data.existUsername)&#123;</span><br><span class="line">            $(<span class="string">&quot;.errorMsg&quot;</span>).text(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="string">&quot;.errorMsg&quot;</span>).text(<span class="string">&quot;用户名可用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>后端代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//响应ajax请求，判断用户名是否存在</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">ajaxExistsUserName</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException, SQLException </span>&#123;</span><br><span class="line">    <span class="comment">//1、获取ajax请求参数</span></span><br><span class="line">    String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="comment">//2、调用service层判断用户名是否存在</span></span><br><span class="line">    <span class="keyword">boolean</span> existUsername = service.existsUsername(username);</span><br><span class="line">    <span class="comment">//3、对应单一响应数据，封装成map后以json格式发回(方便前端处理)</span></span><br><span class="line">    Map&lt;String,Boolean&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    resultMap.put(<span class="string">&quot;existUsername&quot;</span>,existUsername);</span><br><span class="line">    <span class="comment">//4、转换为json格式</span></span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    String json = gson.toJson(resultMap);</span><br><span class="line">    <span class="comment">//5、发回给浏览器</span></span><br><span class="line">    resp.getWriter().write(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="i18n国际化"><a href="#i18n国际化" class="headerlink" title="i18n国际化"></a>i18n国际化</h1><h2 id="基本概念-9"><a href="#基本概念-9" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li>国际化（Internationalization）指的是同一个网站可以支持多种不同的语言，以方便不同国家，不同语种的用户访问。 </li>
<li>关于国际化我们想到的最简单的方案就是为不同的国家创建不同的网站，比如苹果公司，他的英文官网是： <a class="link"   target="_blank" rel="noopener" href="http://www.apple.com/" >http://www.apple.com<i class="fas fa-external-link-alt"></i></a> 而中国官网是 <a class="link"   target="_blank" rel="noopener" href="http://www.apple.com/cn" >http://www.apple.com/cn<i class="fas fa-external-link-alt"></i></a> </li>
<li>苹果公司这种方案并不适合全部公司，而我们希望相同的一个网站，而不同人访问的时候可以根据用户所在的区域显示 不同的语言文字，而网站的布局样式等不发生改变。</li>
<li>于是就有了我们说的国际化，国际化总的来说就是同一个网站不同国家的人来访问可以显示出不同的语言。但实际上这种需求并不强烈，一般真的有国际化需求的公司，主流采用的依然是苹果公司的那种方案，为不同的国家创建不同的页 面。所以国际化的内容我们了解一下即可。</li>
<li>国际化的英文 Internationalization，但是由于拼写过长，老外想了一个简单的写法叫做 I18N，代表的是 Internationalization 这个单词，以 I 开头，以 N 结尾，而中间是 18 个字母，所以简写为 I18N。以后我们说 I18N 和国际化是一个意思。</li>
</ul>
<h2 id="三要素"><a href="#三要素" class="headerlink" title="三要素"></a>三要素</h2><p>Java原生的国际化操围绕着三个要素</p>
<ul>
<li><strong>Locale</strong>：描述不同的时区、位置及其语言类</li>
<li><strong>Properties属性配置文件</strong>：存储某个国家的语言映射数据，一个文件一个国家</li>
<li><strong>ResourceBundle</strong>：整合Locale及其语言配置文件，获取不同国家语言信息</li>
</ul>
<hr>
<p>Locale与ResourceBundle由JDK提供</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210603153631.png"
                     
                ></p>
<h3 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h3><p>Locale是JDK提供的描述程序允许所在地区的时区、位置、语言信息的类</p>
<ul>
<li>获取当前操作系统的locale对象</li>
<li>打印所有可用的locale信息</li>
<li>通过常量获取指定国家的local对象</li>
</ul>
<hr>
<ul>
<li>示例代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取当前操作系统的locale对象</span></span><br><span class="line">    Locale locale = Locale.getDefault();</span><br><span class="line">    System.out.println(<span class="string">&quot;当前系统的locale = &quot;</span> + locale);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取指定常量的locale对象</span></span><br><span class="line">    Locale china = Locale.CHINA;</span><br><span class="line">    Locale us = Locale.US;</span><br><span class="line">    System.out.println(<span class="string">&quot;china = &quot;</span> + china);</span><br><span class="line">    System.out.println(<span class="string">&quot;us = &quot;</span> + us);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印所有可用的locale信息</span></span><br><span class="line">    <span class="keyword">for</span> (Locale availableLocale : Locale.getAvailableLocales()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;availableLocale = &quot;</span> + availableLocale);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>国家化中的properties属性配置文件是<strong>有规范和要求</strong>的：</p>
<ul>
<li><p>一个国际化配置文件存储一个国家的语言映射数据</p>
</li>
<li><p>文件命名要求：<strong>baseName_locale.properties</strong></p>
<ul>
<li><strong>baseName</strong>：自定义的字符串，作为ResourceBundle的一个传入参数</li>
<li><strong>locale</strong>：Localer对象打印出来的信息，如 zh_CN、en_US等</li>
</ul>
<hr>
<ul>
<li>例如：baseName设置为i18n时，中文的配置文件命名为：i18n_zh_CN.properties，英文配置文件命名为：i18n_en_US.properties</li>
</ul>
</li>
</ul>
<h3 id="ResourceBundle"><a href="#ResourceBundle" class="headerlink" title="ResourceBundle"></a>ResourceBundle</h3><p>ResourceBundle类由JDK提供，用于整合所有语言配置文件，自动通过不同locale对象匹配到不同配置文件，并提供方法以key-value方式获取配置文件的内容。</p>
<ul>
<li>读取配置文件：<ul>
<li><code>ResourceBundle.getBundle(String baseName,Locale locale)</code></li>
</ul>
</li>
<li>以键值对的方式获取配置文件中的数据：<ul>
<li><code>bundle.getString(String key)</code></li>
</ul>
</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><h4 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><p>在IDE的src根目录下创建语言配置properties文件，在IDEA中，同一类的i18n会被自动归类为”Resource Bundle ‘i18n’“虚拟目录下。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yihangdeng/blogImage/raw/master/img/20210603160456.png"
                     
                ></p>
<h4 id="获取指定locale下的数据"><a href="#获取指定locale下的数据" class="headerlink" title="获取指定locale下的数据"></a>获取指定locale下的数据</h4><p>通过ResourceBundle加载并获取指定locale下的数据，若存在中文乱码上网找解决方案</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Locale locale = Locale.US;</span><br><span class="line">    ResourceBundle bundle = ResourceBundle.getBundle(<span class="string">&quot;i18n&quot;</span>,locale);</span><br><span class="line">    String username = bundle.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    String password = bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    String sex = bundle.getString(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;username = &quot;</span> + username);</span><br><span class="line">    System.out.println(<span class="string">&quot;password = &quot;</span> + password);</span><br><span class="line">    System.out.println(<span class="string">&quot;sex = &quot;</span> + sex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Web页面应用"><a href="#Web页面应用" class="headerlink" title="Web页面应用"></a>Web页面应用</h2><ul>
<li>i18n.jsp：国际化前</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">	pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;pragma&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Expires&quot;</span> content=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;a href=&quot;&quot;&gt;中文&lt;/a&gt;|</span><br><span class="line">	&lt;a href=&quot;&quot;&gt;english&lt;/a&gt;</span><br><span class="line">	&lt;center&gt;</span><br><span class="line">		&lt;h1&gt;注册&lt;/h1&gt;</span><br><span class="line">		&lt;table&gt;</span><br><span class="line">		&lt;form&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input name=&quot;username&quot; type=&quot;text&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;密码&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;password&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;性别&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;radio&quot; /&gt;男&lt;input type=&quot;radio&quot; /&gt;女&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;邮箱&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td colspan=<span class="string">&quot;2&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">				&lt;input type=<span class="string">&quot;reset&quot;</span> value=<span class="string">&quot;重置&quot;</span> /&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">				&lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/table&gt;</span><br><span class="line">		&lt;br /&gt; &lt;br /&gt; &lt;br /&gt; &lt;br /&gt;</span><br><span class="line">	&lt;/center&gt;</span><br><span class="line">	国际化测试：</span><br><span class="line">	&lt;br /&gt; <span class="number">1</span>、访问页面，通过浏览器设置，请求头信息确定国际化语言。</span><br><span class="line">	&lt;br /&gt; <span class="number">2</span>、通过左上角，手动切换语言</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="JSP方式"><a href="#JSP方式" class="headerlink" title="JSP方式"></a>JSP方式</h4><ul>
<li>i18n.jsp：国际化后</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Locale&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.ResourceBundle&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">		 pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;pragma&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Expires&quot;</span> content=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		Locale locale = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//1、先尝试从用户提交的参数中获取指定的地区</span></span><br><span class="line">		String country = request.getParameter(<span class="string">&quot;country&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2、判断用户参数所指定的locale对象</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="string">&quot;cn&quot;</span>.equals(country)) &#123;</span><br><span class="line">			locale = Locale.CHINA;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;usa&quot;</span>.equals(country)) &#123;</span><br><span class="line">			locale = Locale.US;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//3、若不存在参数请求(如首次加载)</span></span><br><span class="line">			<span class="comment">//则使用当前HTTP请求头中的Locale信息（语言）</span></span><br><span class="line">			locale = request.getLocale();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		System.out.println(locale);</span><br><span class="line">		<span class="comment">//4、获取读取包（根据 指定的baseName和Locale读取 语言信息）</span></span><br><span class="line">		ResourceBundle i18n = ResourceBundle.getBundle(<span class="string">&quot;i18n&quot;</span>, locale);</span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;!-- 通过超链接方式让用户自行选择 --&gt;</span><br><span class="line">	&lt;!-- 带国家请求参数，发回到本jsp页面提供判断--&gt;</span><br><span class="line">	&lt;a href=&quot;i18n.jsp?country=cn&quot;&gt;中文&lt;/a&gt;|</span><br><span class="line">	&lt;a href=&quot;i18n.jsp?country=usa&quot;&gt;english&lt;/a&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 国际化在于所有文本信息均通过ResourceBundle获取 --&gt;</span><br><span class="line">	&lt;center&gt;</span><br><span class="line">		&lt;h1&gt;&lt;%=i18n.getString(&quot;regist&quot;)%&gt;&lt;/h1&gt;</span><br><span class="line">		&lt;table&gt;</span><br><span class="line">		&lt;form&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;%=i18n.getString(&quot;username&quot;)%&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input name=&quot;username&quot; type=&quot;text&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;%=i18n.getString(&quot;password&quot;)%&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;password&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;%=i18n.getString(&quot;sex&quot;)%&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;input type=<span class="string">&quot;radio&quot;</span> /&gt;&lt;%=i18n.getString(<span class="string">&quot;boy&quot;</span>)%&gt;</span><br><span class="line">					&lt;input type=<span class="string">&quot;radio&quot;</span> /&gt;&lt;%=i18n.getString(<span class="string">&quot;girl&quot;</span>)%&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;%=i18n.getString(&quot;email&quot;)%&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td colspan=<span class="string">&quot;2&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">				&lt;input type=<span class="string">&quot;reset&quot;</span> value=<span class="string">&quot;&lt;%=i18n.getString(&quot;</span>reset<span class="string">&quot;)%&gt;&quot;</span> /&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">				&lt;input type=&quot;submit&quot; value=&quot;&lt;%=i18n.getString(&quot;submit&quot;)%&gt;&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/table&gt;</span><br><span class="line">		&lt;br /&gt; &lt;br /&gt; &lt;br /&gt; &lt;br /&gt;</span><br><span class="line">	&lt;/center&gt;</span><br><span class="line">	国际化测试：</span><br><span class="line">	&lt;br /&gt; <span class="number">1</span>、访问页面，通过浏览器设置，请求头信息确定国际化语言。</span><br><span class="line">	&lt;br /&gt; <span class="number">2</span>、通过左上角，手动切换语言</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="JSTL方式"><a href="#JSTL方式" class="headerlink" title="JSTL方式"></a>JSTL方式</h4><p>从从上诉JSP实现方式可知，在web页面上操作国际化主要三个参数：</p>
<ol>
<li>设置Locale信息</li>
<li>设置baseName</li>
<li>使用ResourceBundle输出国际化信息</li>
</ol>
<hr>
<ul>
<li>使用JSTL实现页面国际化前需要先引入fmt标签库，在JSP页面首行添加<ul>
<li><code>&lt;%@ taglib prefix=&quot;fmt&quot; uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; %&gt;</code></li>
</ul>
</li>
<li>JSTL标签实现页面国际化</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;fmt&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">	pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;pragma&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Expires&quot;</span> content=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;%--<span class="number">1</span> 使用标签设置Locale信息--%&gt;</span><br><span class="line">	&lt;fmt:setLocale value=<span class="string">&quot;$&#123;param.locale&#125;&quot;</span> /&gt;</span><br><span class="line">	&lt;%--<span class="number">2</span> 使用标签设置baseName--%&gt;</span><br><span class="line">	&lt;fmt:setBundle basename=<span class="string">&quot;i18n&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;a href=&quot;i18n_fmt.jsp?locale=zh_CN&quot;&gt;中文&lt;/a&gt;|</span><br><span class="line">	&lt;a href=&quot;i18n_fmt.jsp?locale=en_US&quot;&gt;english&lt;/a&gt;</span><br><span class="line">	&lt;center&gt;</span><br><span class="line">		&lt;h1&gt;&lt;fmt:message key=&quot;regist&quot; /&gt;&lt;/h1&gt;</span><br><span class="line">		&lt;table&gt;</span><br><span class="line">		&lt;form&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;fmt:message key=&quot;username&quot; /&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input name=&quot;username&quot; type=&quot;text&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;fmt:message key=&quot;password&quot; /&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;password&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;fmt:message key=&quot;sex&quot; /&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;input type=<span class="string">&quot;radio&quot;</span> /&gt;&lt;fmt:message key=<span class="string">&quot;boy&quot;</span> /&gt;</span><br><span class="line">					&lt;input type=<span class="string">&quot;radio&quot;</span> /&gt;&lt;fmt:message key=<span class="string">&quot;girl&quot;</span> /&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;&lt;fmt:message key=&quot;email&quot; /&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td colspan=<span class="string">&quot;2&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">				&lt;input type=<span class="string">&quot;reset&quot;</span> value=<span class="string">&quot;&lt;fmt:message key=&quot;</span>reset<span class="string">&quot; /&gt;&quot;</span> /&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">				&lt;input type=&quot;submit&quot; value=&quot;&lt;fmt:message key=&quot;submit&quot; /&gt;&quot; /&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/table&gt;</span><br><span class="line">		&lt;br /&gt; &lt;br /&gt; &lt;br /&gt; &lt;br /&gt;</span><br><span class="line">	&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>SH</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：原生Web技术方案</li>
        <li>Post author：yhd</li>
        <li>Create time：2021-06-03 10:31:32</li>
        <li>
            Post link：https://keep.xpoet.cn/2021/06/03/原生Web技术方案/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/06/03/JavaWeb%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">JavaWeb编程技术</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/05/24/Java%E8%AF%AD%E8%A8%80PV%E6%93%8D%E4%BD%9C%E5%88%9D%E4%BD%BF%E7%94%A8/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Java语言PV操作初使用</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">yhd</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MVC%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text">MVC模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%85%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="nav-number">1.2.</span> <span class="nav-text">包命名规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E7%BC%96%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="nav-number">1.3.</span> <span class="nav-text">后端编码流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E5%BA%93%E5%BB%BA%E8%A1%A8"><span class="nav-number">1.3.1.</span> <span class="nav-text">建库建表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JavaBean"><span class="nav-number">1.3.2.</span> <span class="nav-text">JavaBean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="nav-number">1.3.3.</span> <span class="nav-text">测试类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DAO%E7%BC%96%E5%86%99"><span class="nav-number">1.3.4.</span> <span class="nav-text">DAO编写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#properties"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">.properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JdbcUtils"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">JdbcUtils</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BaseDao"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">BaseDao</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96DAO"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">定制化DAO</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="nav-number">1.3.5.</span> <span class="nav-text">Service业务层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="nav-number">1.3.6.</span> <span class="nav-text">视图控制层</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1Servlet"><span class="nav-number">1.3.6.1.</span> <span class="nav-text">业务Servlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BaseServlet"><span class="nav-number">1.3.6.2.</span> <span class="nav-text">BaseServlet</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8C%BA%E5%88%86%E4%BF%A1%E6%81%AF%E7%9A%84%E4%BC%A0%E9%80%92"><span class="nav-number">1.3.6.2.1.</span> <span class="nav-text">区分信息的传递</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E6%94%AF%E6%96%B9%E6%A1%88"><span class="nav-number">1.3.6.2.2.</span> <span class="nav-text">分支方案</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E6%96%B9%E6%A1%88"><span class="nav-number">1.3.6.2.3.</span> <span class="nav-text">反射方案</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BaseServlet-1"><span class="nav-number">1.3.6.2.4.</span> <span class="nav-text">BaseServlet</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%9B%9E%E6%98%BE"><span class="nav-number">1.3.6.3.</span> <span class="nav-text">数据回显</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BeanUtils"><span class="nav-number">1.3.6.4.</span> <span class="nav-text">BeanUtils</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#BeanUtils%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">1.3.6.4.1.</span> <span class="nav-text">BeanUtils基本使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WebUtils%E5%B0%81%E8%A3%85"><span class="nav-number">1.3.6.4.2.</span> <span class="nav-text">WebUtils封装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BeanUtils%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">1.3.6.4.3.</span> <span class="nav-text">BeanUtils源码分析</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="nav-number">1.4.</span> <span class="nav-text">前端相关操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web%E8%B7%AF%E5%BE%84%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">2.</span> <span class="nav-text">Web路径见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E8%B7%B3%E8%BD%AC%E9%94%99%E4%B9%B1"><span class="nav-number">2.1.</span> <span class="nav-text">相对路径跳转错乱</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E9%A9%B1%E5%8A%A8"><span class="nav-number">2.1.1.</span> <span class="nav-text">场景驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#base%E6%A0%87%E7%AD%BE%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.2.</span> <span class="nav-text">base标签介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">2.1.3.</span> <span class="nav-text">示例代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#base%E6%A0%87%E7%AD%BE%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">base标签示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">动态服务器资源路径</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E9%97%AE%E9%A2%98"><span class="nav-number">3.</span> <span class="nav-text">数据传送问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91%E9%97%AE%E9%A2%98"><span class="nav-number">3.1.</span> <span class="nav-text">请求与重定向问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="nav-number">3.2.</span> <span class="nav-text">数据传送域问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">3.2.1.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E6%95%B0%E6%8D%AE%E5%9F%9F"><span class="nav-number">3.2.2.</span> <span class="nav-text">常用功能数据域</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E9%97%AE%E9%A2%98"><span class="nav-number">3.3.</span> <span class="nav-text">数据获取问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="nav-number">3.3.1.</span> <span class="nav-text">首页数据获取</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%881%EF%BC%9Ajsp%E8%B7%B3%E6%9D%BF"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">方案1：jsp跳板</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4"><span class="nav-number">4.</span> <span class="nav-text">表单重复提交</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">4.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E5%88%B7%E6%96%B0%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4"><span class="nav-number">4.2.</span> <span class="nav-text">请求转发刷新重复提交</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E5%A4%8D%E7%8E%B0"><span class="nav-number">4.2.2.</span> <span class="nav-text">场景复现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.3.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4"><span class="nav-number">4.3.</span> <span class="nav-text">网络延迟重复提交</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-2"><span class="nav-number">4.3.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E6%9C%BA%E5%88%B6"><span class="nav-number">4.3.2.</span> <span class="nav-text">响应机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="nav-number">4.3.2.2.</span> <span class="nav-text">浏览器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="nav-number">4.3.3.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">4.3.3.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Session%E6%96%B9%E6%A1%88"><span class="nav-number">4.3.3.2.</span> <span class="nav-text">Session方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E9%AA%8C%E8%AF%81%E7%A0%81%E6%96%B9%E6%A1%88"><span class="nav-number">4.3.3.3.</span> <span class="nav-text">合并验证码方案</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Kaptcha"><span class="nav-number">4.3.3.3.1.</span> <span class="nav-text">Kaptcha</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="nav-number">4.3.3.3.2.</span> <span class="nav-text">使用步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%B7%E6%96%B0%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">4.3.3.3.3.</span> <span class="nav-text">刷新验证码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaScript%E6%96%B9%E6%A1%88"><span class="nav-number">4.3.3.4.</span> <span class="nav-text">JavaScript方案</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9E%E9%80%80%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4"><span class="nav-number">4.4.</span> <span class="nav-text">回退重复提交</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2"><span class="nav-number">4.4.1.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">4.5.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8C%E4%B8%80%E8%A1%A8%E5%8D%95%E4%B8%8D%E5%90%8C%E8%AF%B7%E6%B1%82"><span class="nav-number">5.</span> <span class="nav-text">同一表单不同请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="nav-number">5.1.</span> <span class="nav-text">场景说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-3"><span class="nav-number">5.2.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%81%9A%E6%A0%87%E8%AF%86"><span class="nav-number">5.2.1.</span> <span class="nav-text">增加请求参数做标识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E4%B8%9A%E5%8A%A1URL%E6%83%85%E5%86%B5"><span class="nav-number">5.2.2.</span> <span class="nav-text">判断不同业务URL情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E4%B8%9A%E5%8A%A1%E7%9A%84%E9%9A%90%E8%97%8F%E5%9F%9F%E6%83%85%E5%86%B5"><span class="nav-number">5.2.3.</span> <span class="nav-text">判断不同业务的隐藏域情况</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E6%8A%80%E6%9C%AF"><span class="nav-number">6.</span> <span class="nav-text">分页技术</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-3"><span class="nav-number">6.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">6.2.</span> <span class="nav-text">分页的分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E8%AE%BE%E8%AE%A1"><span class="nav-number">6.3.</span> <span class="nav-text">后端设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.3.1.</span> <span class="nav-text">分页模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%AE%E9%A1%B6%E5%90%91%E4%B8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.3.2.</span> <span class="nav-text">置顶向下实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet%E5%B1%82"><span class="nav-number">6.3.3.</span> <span class="nav-text">Servlet层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service%E5%B1%82"><span class="nav-number">6.3.4.</span> <span class="nav-text">Service层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dao%E5%B1%82"><span class="nav-number">6.3.5.</span> <span class="nav-text">dao层</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1"><span class="nav-number">6.4.</span> <span class="nav-text">前端设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B1%80%E4%BB%A3%E7%A0%81"><span class="nav-number">6.4.1.</span> <span class="nav-text">布局代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A6%96%E5%B0%BE%E4%B8%8E%E4%B8%8A%E4%B8%8B%E9%A1%B5"><span class="nav-number">6.4.2.</span> <span class="nav-text">首尾与上下页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%B3%E8%BD%AC%E9%A1%B5"><span class="nav-number">6.4.3.</span> <span class="nav-text">跳转页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8C%83%E5%9B%B4%E9%A1%B5"><span class="nav-number">6.4.4.</span> <span class="nav-text">范围页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82"><span class="nav-number">6.4.4.1.</span> <span class="nav-text">功能需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90"><span class="nav-number">6.4.4.2.</span> <span class="nav-text">情况分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E5%88%86%E9%A1%B5%E8%B0%83%E6%95%B4"><span class="nav-number">6.5.</span> <span class="nav-text">增删改分页调整</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%9A%84%E6%8A%BD%E5%8F%96"><span class="nav-number">6.6.</span> <span class="nav-text">代码的抽取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5"><span class="nav-number">6.7.</span> <span class="nav-text">区间查询分页</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">7.</span> <span class="nav-text">验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Kaptcha-1"><span class="nav-number">7.1.</span> <span class="nav-text">Kaptcha</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4-1"><span class="nav-number">7.2.</span> <span class="nav-text">使用步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B7%E6%96%B0%E9%AA%8C%E8%AF%81%E7%A0%81-1"><span class="nav-number">7.3.</span> <span class="nav-text">刷新验证码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-number">8.</span> <span class="nav-text">权限管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="nav-number">9.</span> <span class="nav-text">事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-4"><span class="nav-number">9.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1"><span class="nav-number">9.2.</span> <span class="nav-text">事务管理设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1"><span class="nav-number">9.2.1.</span> <span class="nav-text">手动管理事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E4%B8%80%E8%BF%9E%E6%8E%A5%E5%AF%B9%E8%B1%A1"><span class="nav-number">9.2.2.</span> <span class="nav-text">同一连接对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E4%BC%A0%E9%80%92"><span class="nav-number">9.2.3.</span> <span class="nav-text">异常传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B6%E5%B1%82%E6%8D%95%E8%8E%B7"><span class="nav-number">9.2.4.</span> <span class="nav-text">顶层捕获</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#service%E5%B1%82%E6%8D%95%E8%8E%B7"><span class="nav-number">9.2.4.1.</span> <span class="nav-text">service层捕获</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Filet%E5%B1%82%E6%8D%95%E8%8E%B7"><span class="nav-number">9.2.4.2.</span> <span class="nav-text">Filet层捕获</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.3.</span> <span class="nav-text">事务管理实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="nav-number">9.3.1.</span> <span class="nav-text">连接管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E4%BC%A0%E9%80%92-1"><span class="nav-number">9.3.2.</span> <span class="nav-text">异常传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filter%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8"><span class="nav-number">9.3.3.</span> <span class="nav-text">Filter捕获异常</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tomcat%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E9%A1%B5"><span class="nav-number">9.3.4.</span> <span class="nav-text">Tomcat错误信息页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4-2"><span class="nav-number">9.3.4.1.</span> <span class="nav-text">使用步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E9%A1%B5%E9%9D%A2"><span class="nav-number">9.3.4.2.</span> <span class="nav-text">创建错误信息页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="nav-number">9.3.4.3.</span> <span class="nav-text">配置错误页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E6%8A%A5%E5%BC%82%E5%B8%B8"><span class="nav-number">9.3.4.4.</span> <span class="nav-text">上报异常</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C"><span class="nav-number">9.3.4.5.</span> <span class="nav-text">最终效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ThreadLocal"><span class="nav-number">9.4.</span> <span class="nav-text">ThreadLocal</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-5"><span class="nav-number">9.4.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">9.4.2.</span> <span class="nav-text">模拟应用场景</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">10.</span> <span class="nav-text">常用工具类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%A6%E9%BB%98%E8%AE%A4%E5%80%BC%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%95%B4%E5%9E%8B"><span class="nav-number">10.1.</span> <span class="nav-text">带默认值字符串转整型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF"><span class="nav-number">10.1.1.</span> <span class="nav-text">优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">10.1.2.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">10.1.3.</span> <span class="nav-text">源代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E8%AF%8D%E6%B1%87"><span class="nav-number">11.</span> <span class="nav-text">命名词汇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%8A%A8%E8%AF%8D"><span class="nav-number">11.1.</span> <span class="nav-text">常用动词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%8B%E8%AF%8D"><span class="nav-number">11.2.</span> <span class="nav-text">常用介词</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E8%AF%B7%E6%B1%82%E6%96%B9%E6%A1%88"><span class="nav-number">12.</span> <span class="nav-text">前端请求方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#location-href"><span class="nav-number">12.1.</span> <span class="nav-text">location.href</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%B5%E5%95%86Web%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="nav-number">13.</span> <span class="nav-text">电商Web功能模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="nav-number">13.1.</span> <span class="nav-text">购物车</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="nav-number">13.1.1.</span> <span class="nav-text">基本功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B"><span class="nav-number">13.1.2.</span> <span class="nav-text">对象模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%8A%80%E6%9C%AF"><span class="nav-number">13.1.3.</span> <span class="nav-text">实现技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Sessions%E6%96%B9%E6%A1%88"><span class="nav-number">13.1.3.1.</span> <span class="nav-text">Sessions方案</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9"><span class="nav-number">13.1.3.1.1.</span> <span class="nav-text">添加购物</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81%E9%A1%B9"><span class="nav-number">13.1.3.1.2.</span> <span class="nav-text">删除商品项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="nav-number">13.1.3.1.3.</span> <span class="nav-text">修改购物车</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E6%B7%BB%E5%8A%A0%E5%9B%9E%E6%98%BE"><span class="nav-number">13.1.3.1.4.</span> <span class="nav-text">最后添加回显</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Servlet"><span class="nav-number">13.1.3.1.5.</span> <span class="nav-text">Servlet</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A2%E5%8D%95"><span class="nav-number">13.2.</span> <span class="nav-text">订单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD-1"><span class="nav-number">13.2.1.</span> <span class="nav-text">基本功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B-1"><span class="nav-number">13.2.2.</span> <span class="nav-text">对象模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E8%AE%A2%E5%8D%95"><span class="nav-number">13.2.2.1.</span> <span class="nav-text">生成订单</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="nav-number">14.</span> <span class="nav-text">前后端分离</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-6"><span class="nav-number">14.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON"><span class="nav-number">14.2.</span> <span class="nav-text">JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON%E6%A6%82%E5%BF%B5"><span class="nav-number">14.2.1.</span> <span class="nav-text">JSON概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%AE%9A%E4%B9%89"><span class="nav-number">14.2.2.</span> <span class="nav-text">格式定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">14.2.3.</span> <span class="nav-text">反序列化与反序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-7"><span class="nav-number">14.2.3.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaScript"><span class="nav-number">14.2.3.2.</span> <span class="nav-text">JavaScript</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">14.2.3.2.1.</span> <span class="nav-text">序列化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">14.2.3.2.2.</span> <span class="nav-text">反序列化</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Java"><span class="nav-number">14.2.3.3.</span> <span class="nav-text">Java</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JavaBean-1"><span class="nav-number">14.2.3.3.1.</span> <span class="nav-text">JavaBean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#List"><span class="nav-number">14.2.3.3.2.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Map"><span class="nav-number">14.2.3.3.3.</span> <span class="nav-text">Map</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AJAX"><span class="nav-number">14.3.</span> <span class="nav-text">AJAX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-8"><span class="nav-number">14.3.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%94%9FAJAX"><span class="nav-number">14.3.2.</span> <span class="nav-text">原生AJAX</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">14.3.2.1.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#API"><span class="nav-number">14.3.2.2.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#XMLHtppRequest%E5%AF%B9%E8%B1%A1"><span class="nav-number">14.3.2.2.1.</span> <span class="nav-text">XMLHtppRequest对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#open"><span class="nav-number">14.3.2.2.2.</span> <span class="nav-text">open()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#onreadystatechange%E4%BA%8B%E4%BB%B6"><span class="nav-number">14.3.2.2.3.</span> <span class="nav-text">onreadystatechange事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XHR%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="nav-number">14.3.2.2.4.</span> <span class="nav-text">XHR响应数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#send"><span class="nav-number">14.3.2.2.5.</span> <span class="nav-text">send()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5"><span class="nav-number">14.3.3.</span> <span class="nav-text">同步与异步</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="nav-number">14.3.3.1.</span> <span class="nav-text">同步测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="nav-number">14.3.3.2.</span> <span class="nav-text">异步测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">14.3.3.3.</span> <span class="nav-text">异步的优势</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jQuery-AJAX"><span class="nav-number">14.3.4.</span> <span class="nav-text">jQuery-AJAX</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">14.3.4.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ajax"><span class="nav-number">14.3.4.2.</span> <span class="nav-text">$.ajax()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">14.3.4.2.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">14.3.4.2.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="nav-number">14.3.4.2.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-%E4%B8%8E-post"><span class="nav-number">14.3.4.3.</span> <span class="nav-text">$.get() 与 $.post()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="nav-number">14.3.4.3.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-1"><span class="nav-number">14.3.4.3.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="nav-number">14.3.4.3.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getJSON"><span class="nav-number">14.3.4.4.</span> <span class="nav-text">$.getJSON()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="nav-number">14.3.4.4.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-2"><span class="nav-number">14.3.4.4.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-4"><span class="nav-number">14.3.4.4.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serialize"><span class="nav-number">14.3.4.5.</span> <span class="nav-text">$.serialize()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-5"><span class="nav-number">14.3.4.5.1.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">14.4.</span> <span class="nav-text">应用实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%90%8D%E6%A0%A1%E9%AA%8C%E5%88%A4%E6%96%AD"><span class="nav-number">14.4.1.</span> <span class="nav-text">用户名校验判断</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91"><span class="nav-number">14.4.1.1.</span> <span class="nav-text">实现逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="nav-number">14.4.1.2.</span> <span class="nav-text">示例代码</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#i18n%E5%9B%BD%E9%99%85%E5%8C%96"><span class="nav-number">15.</span> <span class="nav-text">i18n国际化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-9"><span class="nav-number">15.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E8%A6%81%E7%B4%A0"><span class="nav-number">15.2.</span> <span class="nav-text">三要素</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Locale"><span class="nav-number">15.2.1.</span> <span class="nav-text">Locale</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">15.2.2.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ResourceBundle"><span class="nav-number">15.2.3.</span> <span class="nav-text">ResourceBundle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B"><span class="nav-number">15.2.4.</span> <span class="nav-text">实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">15.2.4.1.</span> <span class="nav-text">创建配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9Alocale%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">15.2.4.2.</span> <span class="nav-text">获取指定locale下的数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8"><span class="nav-number">15.3.</span> <span class="nav-text">Web页面应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP%E6%96%B9%E5%BC%8F"><span class="nav-number">15.3.0.1.</span> <span class="nav-text">JSP方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSTL%E6%96%B9%E5%BC%8F"><span class="nav-number">15.3.0.2.</span> <span class="nav-text">JSTL方式</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
